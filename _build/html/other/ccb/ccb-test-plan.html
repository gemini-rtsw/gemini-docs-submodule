

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1 Introduction &mdash; Gemini Documentation 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Code Tests" href="../../code/code-index.html" />
    <link rel="prev" title="Hello, world." href="../HelloWorld.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Gemini Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Community Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://epics-controls.org">EPICS Website</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs.epics-controls.org">EPICS Documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Quick Start Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../quick-start/quick-start.html">Quick Start Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">PDFs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pdfs/pdfs-index.html">PDF Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Wiki Docs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../wiki/wiki-index.html">Wiki Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Other Docs:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../other-index.html">Other Tests</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../HelloWorld.html">Hello World</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1 Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#component-requirements">2 Component Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-plan">3 Test Plan</a></li>
<li class="toctree-l2"><a class="reference external" href="`CCB Test Plan (Linked) &lt;https://docs.google.com/document/d/1riqBByUvcI34ubQWQzHFLtfkV3DXafrONYEkJmi0Z6k/&gt;`_">`CCB Test Plan (Linked) &lt;https://docs.google.com/document/d/1riqBByUvcI34ubQWQzHFLtfkV3DXafrONYEkJmi0Z6k/&gt;`_</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Code:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code/code-index.html">Code Tests</a></li>
</ul>
<p class="caption"><span class="caption-text">Gemini HowTo's:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/RTEMSInstall.html">Installing RTEMS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/EPICSInstall.html">Installing EPICS Base on the ADE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../howtos/ADEInstall.html">Installing ADE Build Tools</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Gemini Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../other-index.html">Other Tests</a> &raquo;</li>
        
      <li>1 Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/other/ccb/ccb-test-plan.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>Real-time Upgrade Common Code Base</p>
<p>Functional Requirements and Test Plan</p>
<p>Matt Rippa</p>
<p>Document Version 1.0</p>
<p>March 2016</p>
<p>References</p>
<p>[1] <a class="reference external" href="https://wiki-ext.aps.anl.gov/epics/index.php/RRM_3-14">EPICS Record Reference
Manual</a></p>
<p>[2] <a class="reference external" href="https://drive.google.com/open?id=0B4C51TY6UtsQc1lfOUdUdVk3SUk">EPICS Application Developer’s
Guide</a></p>
<p>[3] <a class="reference external" href="http://www.microsemi.com/document-portal/doc_view/133468-bc635vme-user-s-guide">Bancomm635VME User’s
Guide</a></p>
<p>[4] <a class="reference external" href="https://drive.google.com/a/gemini.edu/file/d/0B4C51TY6UtsQUkk5Szk3NkU1dTQ/view?usp=sharing">Xycom-240 Digital
I/O</a></p>
<p>[5] <a class="reference external" href="https://drive.google.com/a/gemini.edu/file/d/0B4C51TY6UtsQenNNWndvd3QyVGc/view?usp=sharing">Xycom-566 Analog
Input</a></p>
<p>[6] <a class="reference external" href="https://drive.google.com/a/gemini.edu/file/d/0B4C51TY6UtsQMFRUMVFpa0hBNFk/view?usp=sharing">PMAC User
Manual</a></p>
<p>[7] <a class="reference external" href="https://drive.google.com/a/gemini.edu/file/d/0B4C51TY6UtsQb1NibjdERVVHS0k/view?usp=sharing">PMAC Software Reference
Manual</a></p>
<p>[8] <a class="reference external" href="https://drive.google.com/a/gemini.edu/file/d/0B4C51TY6UtsQUlVkaHR2Tm9xQjQ/view?usp=sharing">PMAC Hardware Reference
Manual</a></p>
<p>[9] <a class="reference external" href="https://drive.google.com/a/gemini.edu/file/d/0B4C51TY6UtsQdkdxb0Z1WkJZUG8/view?usp=sharing">PMAC Dual-Ported
Ram</a></p>
<p>[10] <a class="reference external" href="https://drive.google.com/a/gemini.edu/file/d/0B4C51TY6UtsQc2Z2bl9PUEpVUGs/view?usp=sharing">PMAC Quick Reference
Guide</a></p>
<p>[11] VMIC VME 5588 Reflective Memory</p>
<div class="section" id="introduction">
<h1>1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>The Real-time Upgrade Project involves upgrading the operating system,
CPU board support packages and related VME board drivers for telescope
facility systems. The Common Code-Base (CCB) elements are primitive
software components which are used to design and implement the telescope
facility systems such as the Telescope, Mount and Primary Control
Systems.</p>
<p>In most cases the CCB elements have undergone significant refactoring to
be compatible with the EPICS Operating System Independent (OSI)
libraries. As such, the requirements and testing planned for each CCB
component is reviewed here in this document.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Section 2 of this document describes the common code base</dt>
<dd>requirements for basic functionality of each system.</dd>
</dl>
</li>
<li>Section 3 of this document describes the test plan for each document.</li>
</ul>
</div>
<div class="section" id="component-requirements">
<h1>2 Component Requirements<a class="headerlink" href="#component-requirements" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ioc-stats-aka-deviocstats">
<h2>2.1 IOC-Stats (aka devIocStats)<a class="headerlink" href="#ioc-stats-aka-deviocstats" title="Permalink to this headline">¶</a></h2>
<p>IOC-Stats is an EPICS community library providing common system
information such as CPU load, memory consumption and other resources
such as file handles. As this is the replacement library for the vxworks
based VxStats, the requirements are that each system can include the
IOC-Stats library into the build and load the database and records at
startup.</p>
<div class="section" id="specific-requirements-for-iocstats-at-gemini">
<h3>2.1.1 Specific Requirements for iocStats at Gemini<a class="headerlink" href="#specific-requirements-for-iocstats-at-gemini" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-101-01-largest-free-memory-block">
<h4>2.1.1.1 REQ-101-01 Largest free memory block<a class="headerlink" href="#req-101-01-largest-free-memory-block" title="Permalink to this headline">¶</a></h4>
<p>The IOC shall report the size of largest free block.</p>
</div>
<div class="section" id="req-101-02-cpu-usage">
<h4>2.1.1.2 REQ-101-02 CPU Usage<a class="headerlink" href="#req-101-02-cpu-usage" title="Permalink to this headline">¶</a></h4>
<p>The IOC shall report the estimated percent CPU usage by the tasks.</p>
</div>
<div class="section" id="req-101-03-suspended-tasks">
<h4>2.1.1.3 REQ-101-03 Suspended Tasks<a class="headerlink" href="#req-101-03-suspended-tasks" title="Permalink to this headline">¶</a></h4>
<p>The IOC shall report the number of suspended tasks</p>
</div>
<div class="section" id="req-101-04-file-descriptors">
<h4>2.1.1.4 REQ-101-04 File Descriptors<a class="headerlink" href="#req-101-04-file-descriptors" title="Permalink to this headline">¶</a></h4>
<p>The IOC shall report the number of file descriptors currently in use</p>
</div>
<div class="section" id="req-101-05-ca-clients">
<h4>2.1.1.5 REQ-101-05 CA Clients<a class="headerlink" href="#req-101-05-ca-clients" title="Permalink to this headline">¶</a></h4>
<p>The IOC shall report the number of current CA clients</p>
</div>
<div class="section" id="req-101-06-ca-connections">
<h4>2.1.1.6 REQ-101-06 CA connections<a class="headerlink" href="#req-101-06-ca-connections" title="Permalink to this headline">¶</a></h4>
<p>The IOC shall report the number of current CA connections</p>
</div>
<div class="section" id="req-101-07-number-of-records">
<h4>2.1.1.7 REQ-101-07 Number of Records<a class="headerlink" href="#req-101-07-number-of-records" title="Permalink to this headline">¶</a></h4>
<p>The IOC shall report the number of records on the IOC</p>
</div>
<div class="section" id="req-101-08-restart-control">
<h4>2.1.1.8 REQ-101-08 Restart control<a class="headerlink" href="#req-101-08-restart-control" title="Permalink to this headline">¶</a></h4>
<p>The IOC shall provide the utility of rebooting itself by processing a
Subroutine Record with the SNAM= rebootProc.</p>
<p>This is provided by the $(ioc):SysReset record in the iocStats module.</p>
</div>
</div>
<div class="section" id="snapshot-of-epics-ioc-stats-running-on-rtems">
<h3>2.1.2 Snapshot of EPICS IOC-Stats running on RTEMS<a class="headerlink" href="#snapshot-of-epics-ioc-stats-running-on-rtems" title="Permalink to this headline">¶</a></h3>
<p>This looks out of context as-is… move to the IOC-Stats introduction.</p>
<p><a class="reference internal" href="other/ccb/./media/media/image1.jpg"><img alt="ioc_stats_rtems.jpg" src="other/ccb/./media/media/image1.jpg" style="width: 3.35417in; height: 5.74449in;" /></a></p>
<p>See the <a class="reference external" href="http://www.slac.stanford.edu/grp/ssrl/spear/epics/site/devIocStats/">iocStats
website</a>
for full history and documentation.</p>
</div>
</div>
<div class="section" id="sequencer-and-state-notation-code-aka-sncseq">
<h2>2.2 Sequencer and State Notation Code (aka SNCSEQ)<a class="headerlink" href="#sequencer-and-state-notation-code-aka-sncseq" title="Permalink to this headline">¶</a></h2>
<p>The Sequencer is a community library providing a compiler for the State
Notation Language (SNC). The Sequencer is executed at runtime to load
State Sets. The user manual and package history can be found at
<a class="reference external" href="http://www-csr.bessy.de/control/SoftDist/sequencer/index.html">http://www-csr.bessy.de/control/SoftDist/sequencer/index.html</a></p>
<div class="section" id="gemini-specific-requirements-for-the-sequencer-and-snc">
<h3>2.2.1 Gemini Specific Requirements for the Sequencer and SNC<a class="headerlink" href="#gemini-specific-requirements-for-the-sequencer-and-snc" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-102-01-sequencer-demo-program">
<h4>2.2.1.1 REQ-102-01 Sequencer Demo Program<a class="headerlink" href="#req-102-01-sequencer-demo-program" title="Permalink to this headline">¶</a></h4>
<p>An IOC shall be capable of running the demo.st sequencer program
provided in the <a class="reference external" href="#epics-test-harness-1">test harness</a>. This program
ramps an epics analog input value from 0 to 10 volts and back to 0 volts
before repeating the ramp. When the voltage goes above a certain high
limit (say 5.5 volts), a different epics record (call it a light bulb)
changes state from a 0 to 1. The process repeats and as the ramp voltage
continues to hit 10 volts and reverse, the light bulb record turns back
to a 0 when the voltage drop below a lower limit (say 5.0 volts).</p>
</div>
<div class="section" id="req-102-02-legacy-state-notation-code">
<h4>2.2.1.2 REQ-102-02 Legacy State Notation Code<a class="headerlink" href="#req-102-02-legacy-state-notation-code" title="Permalink to this headline">¶</a></h4>
<p>All legacy state notation code shall be capable of being compiled and
running with the currently selected versions of SNCSEQ.</p>
</div>
</div>
</div>
<div class="section" id="gemini-records-geminirec">
<h2>2.3 Gemini Records (geminiRec)<a class="headerlink" href="#gemini-records-geminirec" title="Permalink to this headline">¶</a></h2>
<p>The geminiRec libraries provide the implementation for EPICS records
used exclusively at Gemini.</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="32%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Records Type</th>
<th class="head">Description</th>
<th class="head">Used By</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>genSubRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>applyRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>cadRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>carRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>sirRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>cmdTimeoutRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>loadRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>lutinRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>lutoutRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>statusRecord</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<div class="section" id="specific-requirements-for-geminirec-support">
<h3>2.3.1 Specific Requirements for geminiRec support<a class="headerlink" href="#specific-requirements-for-geminirec-support" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-103-01-gensubrecord">
<h4>2.3.1.1 REQ-103-01 genSubRecord<a class="headerlink" href="#req-103-01-gensubrecord" title="Permalink to this headline">¶</a></h4>
<p>The genSubRecord shall support all legacy genSub records at Gemini.</p>
</div>
<div class="section" id="req-103-02-applyrecord">
<h4>2.3.1.2 REQ-103-02 applyRecord<a class="headerlink" href="#req-103-02-applyrecord" title="Permalink to this headline">¶</a></h4>
<p>The applyRecord shall support all legacy apply records at Gemini.</p>
</div>
<div class="section" id="req-103-03-cadrecord">
<h4>2.3.1.3 REQ-103-03 cadRecord<a class="headerlink" href="#req-103-03-cadrecord" title="Permalink to this headline">¶</a></h4>
<p>The cadRecord shall support all legacy CAD records at Gemini.</p>
</div>
<div class="section" id="req-103-04-carrecord">
<h4>2.3.1.4 REQ-103-04 carRecord<a class="headerlink" href="#req-103-04-carrecord" title="Permalink to this headline">¶</a></h4>
<p>The carRecord shall support all legacy CAR records at Gemini.</p>
</div>
<div class="section" id="req-103-05-sirrecord">
<h4>2.3.1.5 REQ-103-05 sirRecord<a class="headerlink" href="#req-103-05-sirrecord" title="Permalink to this headline">¶</a></h4>
<p>The sirRecord shall support all legacy SIR records at Gemini.</p>
</div>
<div class="section" id="req-103-06-cmdtimeoutrecord">
<h4>2.3.1.6 REQ-103-06 cmdTimeoutRecord<a class="headerlink" href="#req-103-06-cmdtimeoutrecord" title="Permalink to this headline">¶</a></h4>
<p>The cmdTimeoutRecord shall support all legacy cmdTimeout records at
Gemini.</p>
</div>
<div class="section" id="req-103-07-loadrecord">
<h4>2.3.1.7 REQ-103-07 loadRecord<a class="headerlink" href="#req-103-07-loadrecord" title="Permalink to this headline">¶</a></h4>
<p>The loadRecord shall support all legacy load records at Gemini.</p>
</div>
<div class="section" id="req-103-08-lutinrecord">
<h4>2.3.1.8 REQ-103-08 lutinRecord<a class="headerlink" href="#req-103-08-lutinrecord" title="Permalink to this headline">¶</a></h4>
<p>The lutinRecord shall support all legacy lutin records at Gemini.</p>
</div>
<div class="section" id="req-103-09-lutoutrecord">
<h4>2.3.1.9 REQ-103-09 lutoutRecord<a class="headerlink" href="#req-103-09-lutoutrecord" title="Permalink to this headline">¶</a></h4>
<p>The lutoutRecord shall support all legacy lutout records at Gemini.</p>
</div>
<div class="section" id="req-103-10-statusrecord">
<h4>2.3.1.10 REQ-103-10 statusRecord<a class="headerlink" href="#req-103-10-statusrecord" title="Permalink to this headline">¶</a></h4>
<p>The statusRecord shall support all legacy status records at Gemini.</p>
</div>
</div>
</div>
<div class="section" id="pvload">
<h2>2.4 pvload<a class="headerlink" href="#pvload" title="Permalink to this headline">¶</a></h2>
<p>The Process Variable Load support library is a vendor supported library.</p>
<div class="section" id="specific-requirements-for-pvload-at-gemini">
<h3>2.4.1 Specific Requirements for pvload at Gemini<a class="headerlink" href="#specific-requirements-for-pvload-at-gemini" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-104-01-identity-record">
<h4>2.4.1.1 REQ-104-01 Identity Record<a class="headerlink" href="#req-104-01-identity-record" title="Permalink to this headline">¶</a></h4>
<p>All IOC’s shall advertise their software release version in an EPICS
stringin record named, “&lt;ioc_name&gt;:identity”. The value of the identity
record shall be equal to the release number in the production directory,
i.e., “/gem_sw/prod/&lt;EPICS_RELEASE&gt;/ioc/&lt;ioc_name&gt;/&lt;release_number&gt;”,
and reflected in the &lt;ioc_name&gt;App/config/identity.pv pvload file.</p>
</div>
<div class="section" id="req-104-02-legacy-pvload-files">
<h4>2.4.1.2 REQ-104-02 Legacy pvload files<a class="headerlink" href="#req-104-02-legacy-pvload-files" title="Permalink to this headline">¶</a></h4>
<p>Legacy pvload files shall be processed at boot time with no errors and
function in the same manner as legacy systems.</p>
</div>
</div>
</div>
<div class="section" id="bancomm">
<h2>2.5 Bancomm<a class="headerlink" href="#bancomm" title="Permalink to this headline">¶</a></h2>
<p>The bancomm support library provides both driver and device support for
EPICS. The driver layer gives read and write access to the 635/637 board
registers whereas the device layer implements epics record specific
implementation. Since this driver was porting for OSI compatibility, a
thorough set of functional testing will be carried out.</p>
<div class="section" id="database-definition-file-bancomm-dbd">
<h3>2.5.1 Database Definition File (bancomm.dbd)<a class="headerlink" href="#database-definition-file-bancomm-dbd" title="Permalink to this headline">¶</a></h3>
<p>The Bancomm database definition file defines the EPICS device and driver
requirements.</p>
<blockquote>
<div><p>variable( altIntCounter, int )</p>
<p>variable( bcIntCounter, int )</p>
<p>device(ai, VME_IO, devAiBc635, “Bancomm 635”)</p>
<p>device(ao, VME_IO, devAoBc635, “Bancomm 635”)</p>
<p>device(stringin, VME_IO, devSiBc635, “Bancomm 635”)</p>
<p>device(stringout, VME_IO, devSoBc635, “Bancomm 635”)</p>
<p>driver(drvBc635)</p>
</div></blockquote>
</div>
<div class="section" id="device-support-requirements">
<h3>2.5.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements" title="Permalink to this headline">¶</a></h3>
<p>The following device support routines are required for the Bancomm
635/637 board.</p>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>devAiBc635 – Provide Analog Input support for VME_IO including Scan</dt>
<dd>I/O Interrupt support. Calls
<a class="reference external" href="#kix.rrnoni7xhdye">bcIntEnable()</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devAoBc635 – Provide Analog Output support for VME_IO Passive</dt>
<dd>Scanning only.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devSiBc635 – Provide String Input support for VME_IO including Scan</dt>
<dd>I/O Interrupt support. Calls
<a class="reference external" href="#kix.rrnoni7xhdye">bcIntEnable()</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devSoBc635 – Provide String Output support for VME_IO Passive</dt>
<dd>scanning only.</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="driver-support-requirements">
<h3>2.5.3 Driver Support Requirements<a class="headerlink" href="#driver-support-requirements" title="Permalink to this headline">¶</a></h3>
<p>The bancomm 635/637 driver provides low-level access to the boards time
registers to acquire the current time as provided by either GPS or NTP.
The driver shall provide the following routines for access to external
support libraries such as timelib.:</p>
<blockquote>
<div><p>extern void BCconfigure(const int, const int, const int, const int,
const int);</p>
<p>extern int <a class="reference external" href="#kix.rrnoni7xhdye">bc635IntEnable</a>(const unsigned
short, const char *);</p>
<p>extern int bc635_read(double *);</p>
<p>extern int bc635_write(const unsigned short, const double);</p>
<p>extern void bcIntConnect(void (<a href="#id1"><span class="problematic" id="id2">*</span></a>isrproc)(const int n));</p>
<p>extern void bcIntDisconnect(void);</p>
<p>extern int bcSendTfp(char *);</p>
<p>extern void bcSetRTC(void);</p>
<p>extern int bcSetEpoch (const int);</p>
<p>extern int bcRegsToTime (double *, unsigned char *);</p>
<p>extern int bc635_report (int);</p>
<p>extern int bc635_init (void);</p>
<p>extern int bcTestCard( void );</p>
<p>extern int bcGetGpsLeap( void );</p>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Used By</strong></th>
<th class="head"><strong>Meaning</strong></th>
<th class="head"><strong>Return
value</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>BCconfigure</td>
<td><p class="first">Timelib:</p>
<p class="last">t
imeClockInit()</p>
</td>
<td>Configure the
Bancomm time
interface.
Define startup
configuration
options for
the Bancomm
time card to
be called
direct from
the RTEMS
shell or
startup file
before
iocInit. (In
practice, this
is called by
ti
meClockInit(),
which is
called in the
startup file
before
iocInit).</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>bc635IntEnable</td>
<td><p class="first">Drv635:
BCconfigure()</p>
<p>Dev635:</p>
<p>initRecordAi()</p>
<p class="last">initRecordSi()</p>
</td>
<td>Enable
interrupts on
the Bancomm
635 card.</td>
<td>OK,ERROR</td>
</tr>
<tr class="row-even"><td>bc635_read</td>
<td><p class="first">Timelib</p>
<p class="last">timeInit()</p>
</td>
<td>Read time –
Read the
current time
registers and
return the
time as the
number of
seconds (type
double value).</td>
<td>OK,ERROR</td>
</tr>
<tr class="row-odd"><td>bc635_write</td>
<td><p class="first">Dev635:</p>
<p class="last">write_ao(),
write_so()</p>
</td>
<td><ul class="first simple">
<li>Set time</li>
</ul>
<p>coincidence
strobe – For
signal number
3 (set TOD
interrupt)
write out to
the Bancomm as
follows :</p>
<p class="last">Set Time Of
Day for time
coincidence
interrupt.
Input value is
time for the
interrupt
(seconds since
midnight).</p>
</td>
<td>OK,ERROR if
not signal 3</td>
</tr>
<tr class="row-even"><td>bcIntConnect</td>
<td>Not used</td>
<td>Register a
user defined
interrupt
service
routine to be
called on
every Bancomm
periodic
interrupt.</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>b
cIntDisconnect</td>
<td>Not used</td>
<td>Disconnects a
previously
defined user
interrupt
routine for
handling
Bancomm
periodic
interrupts.</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>bcSendTfp</td>
<td><p class="first">Drv635:</p>
<p class="last">EPICS Device
Support
“init()” call.</p>
</td>
<td><p class="first">Configure
635/637 for
specific modes
(i.e., Master,
Slave,
LeapSeconds
(on|off), or
bcoffset
control)</p>
<p class="last">Send a string
to the bc635
output FIFO by
writing
successive
bytes to the
fifo address.
This routine
delimits the
supplied
string with
&lt;SOH&gt;…&lt;ETB&gt;.
The Bancomm
ACK register
is set to 0x95
to cause TFP
to take
action, then
wait for TFP
acknowledge
bit set
(0x01).</p>
</td>
<td>OK, or ERROR
on timeout.</td>
</tr>
<tr class="row-odd"><td>bcSetRTC</td>
<td>Not used</td>
<td>Set
Battery-backed
clock –Load
the Bancomm
real-time
clock (RTC)
using the
current NTP
time</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>bcSetEpoch</td>
<td><p class="first">Drv635:</p>
<p class="last">Only used
internally</p>
</td>
<td>Set epoch year
– calculate
the start of
year epoch
(wrt 1970)
using mktime,
given year.
Set the value
in the global
var
bcYearEpoch.</td>
<td><p class="first">OK</p>
<p class="last">Needs
Protection
from ERROR</p>
</td>
</tr>
<tr class="row-odd"><td>bcRegsToTime</td>
<td><p class="first">Drv635:</p>
<p class="last">Only used
internally</p>
</td>
<td><ul class="first simple">
<li>Convert bc</li>
</ul>
<p>Time or Event
regs to time
– Takes a mem
copy of the
EVENT or TIME
regs and
returns the
time as the
number of
seconds (type
double value).</p>
<p>* RETURNS:</p>
<p class="last">OK or errors
(no Bancomm or
Bancomm status
bit field)</p>
</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>bc635_report</td>
<td><p class="first">Drv635:</p>
<p class="last">EPICS Device
Support
“report()”
call.</p>
</td>
<td><ul class="first simple">
<li>Report</li>
</ul>
<p class="last">Bancomm
635/637
status. This
is called from
the use of
dbior drvBc635
(i
nterest_level)
.</p>
</td>
<td>OK</td>
</tr>
<tr class="row-odd"><td>bc635_init</td>
<td>EPICS iocInit</td>
<td><ul class="first simple">
<li>EPICS DRIVER</li>
</ul>
<p class="last">INIT
–Initialize
bc635/637 –
called from
iocInit</p>
</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>bcTestCard</td>
<td>Drv635</td>
<td>EPICS iocInit
- EPICS DRIVER
INIT
–Initialize
bc635/637 –
called from
iocInit</td>
<td>OK if card
present, ERROR
if absent</td>
</tr>
<tr class="row-odd"><td>bcGetGpsLeap</td>
<td>Drv635:
bc635_init()</td>
<td><ul class="first simple">
<li>Return the</li>
</ul>
<p>current value
of GPS leap
seconds.</p>
<p class="last">The current
value of GPS
leap seconds
is obtained
from a Bancomm
637 card by
sending an O2
packet request
to the TFP.
The value
returned is
zero on a
bc635
(non-GPS)
card.</p>
</td>
<td>Integer number
of seconds.</td>
</tr>
</tbody>
</table>
<p>Further, the driver shall register itself with the epics generalTime
libraries adding the Bancomm driver to the list of available Time
Providers.</p>
</div>
<div class="section" id="osi-specific-challenges">
<h3>2.5.4 OSI Specific Challenges<a class="headerlink" href="#osi-specific-challenges" title="Permalink to this headline">¶</a></h3>
<p>The Bancomm board is required to stop and start the operating system
clock and provide it’s own tick pulse. See
<a class="reference external" href="#fts0i87foetw">timeClockInit()</a> for the description of changing the
system clock tick during startup scripts for different systems. Eg., the
MCS sets the tick resolution to 80 ticks per second, and the WFS’s and
SCS set the tick resolution to 200 ticks per second. The OSI layer of
epics base does not implement all VxWorks calls. We found that
controlling the system clock (as required by the Bancomm driver) needed
to use operating system dependent calls.</p>
</div>
<div class="section" id="epicsgeneraltime">
<h3>2.5.5 epicsGeneralTime<a class="headerlink" href="#epicsgeneraltime" title="Permalink to this headline">¶</a></h3>
<p>The generalTime framework provides a mechanism for several time
providers to be present within the system. There</p>
<p>are two types of provider, one type for the current time and one type
for providing Time Event times. Each time</p>
<p>provider has a priority, and installed providers are queried in priority
order whenever a time is requested, until one</p>
<p>returns successfully. Thus there is a fallback from higher priority
providers (smaller value of priority) to lower priority</p>
<p>providers (larger value of priority) if the higher priority ones fail.
Each architecture has a “last resort” provider,</p>
<p>installed at priority 999, usually based on the system clock, which is
used in the absence of any other provider.</p>
<p>Targets running vxWorks and RTEMS have an NTP provider installed at
priority 100.</p>
<p>The Bancomm driver will register itself as the highest priority time
provider with priority 20. See specific requirements below.</p>
</div>
<div class="section" id="bancomm-board-jumper-and-mode-configuration">
<h3>2.5.6 Bancomm Board Jumper and Mode Configuration<a class="headerlink" href="#bancomm-board-jumper-and-mode-configuration" title="Permalink to this headline">¶</a></h3>
<p>The jumper locations for the Rev. A through Rev. F TFP versions are
shown in Figure 2-2. The Rev. G and up along with the P100004 version
jumpers are shown in Figure 2-3. The jumper blocks are not drawn to
scale in order to make the numbers more visible. It may be helpful to
refer to the schematic diagrams to obtain a clearer idea of the function
of each jumper option.</p>
<ul class="simple">
<li>JP1</li>
</ul>
<blockquote>
<div>With the jumper in the 1-2 position the TFP is configured to use DC
level shift input timecode. In the 3-4 or open position the TFP is
configured to use modulated timecode.</div></blockquote>
<ul class="simple">
<li>JP2 (GPS Option)</li>
</ul>
<blockquote>
<div>In the 1-2 position the TFP is configured to use a single ended 1pps
GPS input. In the 3-4 position the TFP is configured to use a
differential 1pps GPS input.</div></blockquote>
<ul class="simple">
<li>JP3 (GPS Option)</li>
</ul>
<blockquote>
<div>In the 1-2 position the TFP is configured to use the ACUTIME Smart
Antenna or SV-6 as the GPS sensor. In the 3-4 position the TFP is
configured to use the TANS as the GPS sensor. The ACUTIME, SV-6, and
TANS are GPS sensor options that are available from Datum, Inc. This
jumper is not present on the P100004 model boards.</div></blockquote>
<ul class="simple">
<li>JP4</li>
</ul>
<blockquote>
<div>The jumpers in the JP4 group are designed to be moved as a pair.
Positions 3-4 and 5-6 define one configuration, and positions 1-2 and
7-8 define a second configuration. In the default configuration the
TFP is configured with an auxiliary RS-422 output. In the second
configuration the TFP is configured ina daisy-chain mode (the RS-422
input is jumpered to the RS-422 output). This jumper set is intended
to be used in a digital synchronization mode. At the present time
this mode has not been implemented. This jumper is not present on the
P100004 model boards.</div></blockquote>
<ul class="simple">
<li>JP5</li>
</ul>
<blockquote>
<div>In the 1-2 position this jumper places a “100Ω” load between the
RS-422 input lines. In the 3-4 position the “100Ω” load is bypassed.
When the TFP is the terminal device on an RS-422 daisy chain the load
should be used. When the TFP is not at the end of the chain the load
should be omitted.</div></blockquote>
<ul class="simple">
<li>JP6</li>
</ul>
<blockquote>
<div>In the 1-2 position this jumper places GROUND on P2 pin C12. In the
2-3 position the 1, 5, 10MHz clock is driven out of P2 pin C12. On
the model P100004 boards, this jumper is implemented as a 2x2 pin
block. A shunt on pins 2 and 4 enables the 10MHz output on P2 pin
C12. A shunt on pins 1 and 2 disables the output by grounding P2 pin
C12.</div></blockquote>
<p>Operational Jumper Settings for GPS Locking on 637</p>
<p>==
==</p>
<p>Operational Jumper Settings for GPS Locking on 635</p>
<p>==
==</p>
</div>
<div class="section" id="eeprom-version-requirements">
<h3>2.5.7 EEPROM Version Requirements<a class="headerlink" href="#eeprom-version-requirements" title="Permalink to this headline">¶</a></h3>
<p>For successful use of the 637 boards Post May 3rd, 2015, the EEPROM must
be upgrade to version XXXX.</p>
</div>
<div class="section" id="specific-requirements">
<h3>2.5.8 Specific Requirements<a class="headerlink" href="#specific-requirements" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-105-01-initialize">
<h4>2.5.8.1 REQ-105-01 Initialize<a class="headerlink" href="#req-105-01-initialize" title="Permalink to this headline">¶</a></h4>
<p>The Bancomm support library shall be capable of executing the
bc635_init() routine without error by calling iocInit().</p>
</div>
<div class="section" id="req-105-02-epics-report">
<h4>2.5.8.2 REQ-105-02 EPICS Report<a class="headerlink" href="#req-105-02-epics-report" title="Permalink to this headline">¶</a></h4>
<p>The EPICS routine dbior drvBc635( &lt;interest_level&gt;) shall display the
state of all data channels respective for that card. See
<a class="reference external" href="#8mo1uwbcs4cn">bc635_report</a>.</p>
</div>
<div class="section" id="req-105-03-analog-input-record-support-scan-i-o-interrupt">
<h4>2.5.8.3 REQ-105-03 Analog Input Record Support (Scan I/O Interrupt)<a class="headerlink" href="#req-105-03-analog-input-record-support-scan-i-o-interrupt" title="Permalink to this headline">¶</a></h4>
<p>The Bancomm support library shall be capable of initializing and
processing an EPICS Analog Input record with its DTYP set to drvBc635
and Scan I/O Interrupt support.</p>
</div>
<div class="section" id="req-105-04-analog-output-record-support">
<h4>2.5.8.4 REQ-105-04 Analog Output Record Support<a class="headerlink" href="#req-105-04-analog-output-record-support" title="Permalink to this headline">¶</a></h4>
<p>The Bancomm support library shall be capable of initializing and
processing an EPICS Analog Output record with its DTYP set to drvBc635.</p>
</div>
<div class="section" id="req-105-05-string-input-record-support-scan-i-o-interrupt">
<h4>2.5.8.5 REQ-105-05 String Input Record Support (Scan I/O Interrupt)<a class="headerlink" href="#req-105-05-string-input-record-support-scan-i-o-interrupt" title="Permalink to this headline">¶</a></h4>
<p>The Bancomm support library shall be capable of initializing and
processing an EPICS String Input record with its DTYP set to drvBc635
and Scan I/O Interrupt support.</p>
</div>
<div class="section" id="req-105-06-string-output-record-support">
<h4>2.5.8.6 REQ-105-06 String Output Record Support<a class="headerlink" href="#req-105-06-string-output-record-support" title="Permalink to this headline">¶</a></h4>
<p>The Bancomm support library shall be capable of initializing and
processing an EPICS String Output support with its DTYP set to drvBc635.</p>
</div>
<div class="section" id="req-105-06-epicsgeneraltime-time-provider">
<h4>2.5.8.7 REQ-105-06 epicsGeneralTime Time Provider<a class="headerlink" href="#req-105-06-epicsgeneraltime-time-provider" title="Permalink to this headline">¶</a></h4>
<p>The Bancomm driver shall register itself with the epicsGeneralTime
framework as the highest time provider. This shall be evident at any
time by calling <a class="reference external" href="#9s27o4jsqqhh">generalTimeReport()</a> on the IOC.</p>
</div>
</div>
</div>
<div class="section" id="timelib">
<h2>2.6 Timelib<a class="headerlink" href="#timelib" title="Permalink to this headline">¶</a></h2>
<p>The timelib interfaces with the Bancomm driver and the EPICS generalTime
library to provide specific time products such as TAI timestamps and
dates to facility telescope systems.</p>
<div class="section" id="specific-requirements-1">
<span id="id3"></span><h3>2.6.1 Specific Requirements<a class="headerlink" href="#specific-requirements-1" title="Permalink to this headline">¶</a></h3>
<p>The timelib requirements are very extensive and it is not practical (at
this writing) to itemize every function here. Further, this would yield
a low return on the investment. The timelib itself has not been
refactored for OSI system calls. All the timelib calls are standard C
calls and don’t invoke RTOS utilities such as semaphores, message queues
and threads. However, there are two key functions which will be tested
against. The timeNow() returns the raw time from the Gemini TimeBus (the
Bancomm) and the <a class="reference external" href="#fts0i87foetw">timeClockInit()</a> is used to
initialize the timelib with the Bancomm and EPICS at startup.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="27%" />
<col width="27%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Usedby</strong></th>
<th class="head"><strong>Meaning</strong></th>
<th class="head"><strong>Returns</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>timeNow()</td>
<td>All telescope
systems</td>
<td><ul class="first simple">
<li><dl class="first docutils">
<dt>Read the</dt>
<dd>current
raw time</dd>
</dl>
</li>
<li>Returned:</li>
</ul>
<blockquote class="last">
<div>(SI seconds
since TAI
1970 January
1.0)</div></blockquote>
</td>
<td>OK</td>
</tr>
<tr class="row-odd"><td>timeClockInit()</td>
<td>All telescope
systems</td>
<td><ul class="first last simple">
<li><dl class="first docutils">
<dt>Initialise</dt>
<dd>the clock
used by
the
Gemini
time
system</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>This routine</dt>
<dd>must be
called
prior to
starting
EPICS.</dd>
</dl>
</li>
</ul>
</td>
<td>OK</td>
</tr>
</tbody>
</table>
<div class="section" id="req-106-01-timenow">
<h4>2.6.1.1 REQ-106-01 timeNow<a class="headerlink" href="#req-106-01-timenow" title="Permalink to this headline">¶</a></h4>
<p>The timelib shall return TAI time provided with a call to timeNow().</p>
</div>
<div class="section" id="req-106-02-timeclockinit">
<h4>2.6.1.2 REQ-106-02 timeClockInit<a class="headerlink" href="#req-106-02-timeclockinit" title="Permalink to this headline">¶</a></h4>
<p>The timelib shall initialize and configure the Bancomm board with a call
to <a class="reference external" href="#fts0i87foetw">timeClockInit()</a>. This routine is essential to the
correct startup of the Gemini time system. It must be called prior to
the startup of EPICS since it calls BCconfigure() . Since EPICS is not
running when this routine is called it uses private memory to store
whether the time system is to be simulated and whether this IOC is the
time bus master. These stored values can be used later by EPICS code.
The master flag is set to 1 if the IOC in which this code is running is
to be the time bus master i.e. it has a bc637 card installed. The
simulate flag is set to 1 if time is to be simulated i.e time is to be
driven by an onboard real time clock rather than a Bancomm card.</p>
</div>
</div>
</div>
<div class="section" id="slalib">
<h2>2.7 Slalib<a class="headerlink" href="#slalib" title="Permalink to this headline">¶</a></h2>
<p>The slalib requirements are very extensive and it is not practical (at
this writing) to itemize every function here. Further, this would yield
a low return on the investment. The slalib itself has not been
refactored for OSI system calls. All the slalib calls are standard C
calls and don’t invoke RTOS utilities such as semaphores, message queues
and threads.</p>
<div class="section" id="specific-requirements-2">
<span id="id4"></span><h3>2.7.1 Specific Requirements<a class="headerlink" href="#specific-requirements-2" title="Permalink to this headline">¶</a></h3>
<p>Although there are no EPICS OSI specific requirements, the following
requirements are defined for compatibility with the build environment
and systems depending on slalib.</p>
<div class="section" id="req-107-01-slalib-ade-compatibility">
<h4>2.7.1.1 REQ-107-01 Slalib ADE Compatibility<a class="headerlink" href="#req-107-01-slalib-ade-compatibility" title="Permalink to this headline">¶</a></h4>
<p>The slalib library shall be compatible with the Application Development
Environment (ADE ), and build without errors or warnings.</p>
</div>
<div class="section" id="req-107-02-slalib-available-for-linking">
<h4>2.7.1.2 REQ-107-02 Slalib Available for Linking<a class="headerlink" href="#req-107-02-slalib-available-for-linking" title="Permalink to this headline">¶</a></h4>
<p>The slalib library shall be available for linking and testing with other
CCB components.</p>
</div>
</div>
</div>
<div class="section" id="astlib">
<h2>2.8 Astlib<a class="headerlink" href="#astlib" title="Permalink to this headline">¶</a></h2>
<p>The Astlib provides astrometric math functions to the telescope systems.
The astlib requirements are very extensive and it is not practical (at
this writing) to itemize every function here. Further, this would yield
a low return on the investment. The astlib itself has not been
refactored for OSI system calls. All the astlib calls are standard C
calls and don’t invoke RTOS utilities such as semaphores, message queues
and threads.</p>
<div class="section" id="specific-requirements-3">
<span id="id5"></span><h3>2.8.1 Specific Requirements<a class="headerlink" href="#specific-requirements-3" title="Permalink to this headline">¶</a></h3>
<p>Although there are no EPICS OSI specific requirements, the following
requirements are defined for compatibility with the build environment
and system and systems depending on astlib.</p>
<div class="section" id="req-108-01-astlib-ade-compatibility">
<h4>2.8.1.1 REQ-108-01 Astlib ADE Compatibility<a class="headerlink" href="#req-108-01-astlib-ade-compatibility" title="Permalink to this headline">¶</a></h4>
<p>The astlib library shall be compatible with the Application Development
Environment (ADE ), and build without errors or warnings.</p>
</div>
<div class="section" id="req-108-02-astlib-available-for-linking">
<h4>2.8.1.2 REQ-108-02 Astlib Available for Linking<a class="headerlink" href="#req-108-02-astlib-available-for-linking" title="Permalink to this headline">¶</a></h4>
<p>The astlib library shall be available for linking and testing with other
CCB components.</p>
</div>
</div>
</div>
<div class="section" id="asyn">
<h2>2.9 Asyn<a class="headerlink" href="#asyn" title="Permalink to this headline">¶</a></h2>
<p>The Asyn module is a community support module.</p>
<div class="section" id="specific-requirements-4">
<span id="id6"></span><h3>2.9.1 Specific Requirements<a class="headerlink" href="#specific-requirements-4" title="Permalink to this headline">¶</a></h3>
<p>The following Gemini specific requirements have been defined for the
Asyn library.</p>
<div class="section" id="req-109-01-asyn-ade-compatibility">
<h4>2.9.1.1 REQ-109-01 Asyn ADE Compatibility<a class="headerlink" href="#req-109-01-asyn-ade-compatibility" title="Permalink to this headline">¶</a></h4>
<p>The Asyn library shall be compatible with the Application Development
Environment (ADE ), and and build without errors or warnings.</p>
</div>
<div class="section" id="req-109-01-asyn-available-for-linking">
<h4>2.9.1.2 REQ-109-01 Asyn Available for Linking<a class="headerlink" href="#req-109-01-asyn-available-for-linking" title="Permalink to this headline">¶</a></h4>
<p>The Asyn library shall be available for linking and testing with other
CCB components.</p>
</div>
</div>
</div>
<div class="section" id="streamdevice">
<h2>2.10 StreamDevice<a class="headerlink" href="#streamdevice" title="Permalink to this headline">¶</a></h2>
<p>The StreamDevice module is a community support module.</p>
<div class="section" id="specific-requirements-5">
<span id="id7"></span><h3>2.10.1 Specific Requirements<a class="headerlink" href="#specific-requirements-5" title="Permalink to this headline">¶</a></h3>
<p>The following Gemini specific requirements have been defined for the
Stream Device library.</p>
<div class="section" id="req-110-01-stream-device-ade-compatibility">
<h4>2.10.1.1 REQ-110-01 Stream Device ADE Compatibility<a class="headerlink" href="#req-110-01-stream-device-ade-compatibility" title="Permalink to this headline">¶</a></h4>
<p>The Stream Device library shall be compatible with the Application
Development Environment (ADE ), and build without errors or warnings.</p>
</div>
<div class="section" id="req-110-01-stream-device-available-for-linking">
<h4>2.10.1.2 REQ-110-01 Stream Device Available for Linking<a class="headerlink" href="#req-110-01-stream-device-available-for-linking" title="Permalink to this headline">¶</a></h4>
<p>The Stream Device library shall be available for linking and testing
with other CCB components.</p>
</div>
</div>
</div>
<div class="section" id="xycom-240">
<h2>2.11 Xycom-240<a class="headerlink" href="#xycom-240" title="Permalink to this headline">¶</a></h2>
<p>The Xycom-240 board provides digital Input/Output to the EPICS device
layer. The driver support code</p>
<div class="section" id="database-definition-file-xy240-dbd">
<h3>2.11.1 Database Definition File (xy240.dbd)<a class="headerlink" href="#database-definition-file-xy240-dbd" title="Permalink to this headline">¶</a></h3>
<p>device(bi,VME_IO, devBiXy240,”XYCOM-240”)</p>
<p>device(bo,VME_IO, devBoXy240,”XYCOM-240”)</p>
<p>device(mbbi,VME_IO, devMbbiXy240,”XYCOM-240”)</p>
<p>device(mbbo,VME_IO, devMbboXy240,”XYCOM-240”)</p>
<p>driver(drvXy240)</p>
<p>registrar(drvXy240RegisterCommands)</p>
</div>
<div class="section" id="device-support-requirements-1">
<span id="id8"></span><h3>2.11.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements-1" title="Permalink to this headline">¶</a></h3>
<p>The following device support routines are required for the Xycom-240
board.</p>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>devBiXy240 – Provide binary input support using VMEIO for EPICS</dt>
<dd>records with Interrupt I/O scanning.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devBoXy240 –Provide binary output support using VMEIO for EPICS</dt>
<dd>records with Passive scanning.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devMbbiXy240 –Provide multi-bit binary input support using VMEIO for</dt>
<dd>EPICS records with Interrupt I/O scanning.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devMbboXy240 –Provide multi-bit binary output support using VMEIO</dt>
<dd>for EPICS records with Passive scanning.</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="driver-support-requirements-1">
<span id="id9"></span><h3>2.11.3 Driver Support Requirements<a class="headerlink" href="#driver-support-requirements-1" title="Permalink to this headline">¶</a></h3>
<p>The Xycom 240 driver provides access to configure and control the
digital input and output of the Xycom 240 board. The EPICS device
support requires the following routines.</p>
<p>long <a class="reference external" href="#xzk5k3gvyl81">xy240_init()</a>;</p>
<p>long <a class="reference external" href="#gdxmvykxu38i">xy240_getioscanpvt</a>(short card, IOSCANPVT
*scanpvt);</p>
<p>long <a class="reference external" href="#f81n9yfdojo1">xy240_bi_driver</a>(short card, epicsUInt32 mask,
epicsUInt32 *prval);</p>
<p>long <a class="reference external" href="#1kp9y58juwsp">xy240_bo_read</a>(short card, epicsUInt32 mask,
epicsUInt32 *prval);</p>
<p>long <a class="reference external" href="#yqbi6rd2unr0">xy240_bo_driver</a>(short card, epicsUInt32 val,
epicsUInt32 mask);</p>
<p>long <a class="reference external" href="#gpn1f63hw5id">xy240_io_report</a>(int level);</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="27%" />
<col width="27%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Usedby</strong></th>
<th class="head"><strong>Meaning</strong></th>
<th class="head"><strong>Returns</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>xy240_init</td>
<td>EPICS iocInit()</td>
<td><ul class="first last">
<li><dl class="first docutils">
<dt>Initialize</dt>
<dd><p class="first last">the
XYCOM-240
on the
VME bus.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Turn Front</dt>
<dd><p class="first last">panel LED
green on,
red off</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Clear</dt>
<dd><p class="first last">interrupt
input
register
latch</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure</dt>
<dd><p class="first last">JK1
(ports
0-3) as
input</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure</dt>
<dd><p class="first last">JK2
(ports
4-7) as
output</p>
</dd>
</dl>
</li>
<li><p class="first">Start</p>
<blockquote>
<div><dl class="docutils">
<dt>epicsThread</dt>
<dd><p class="first last">for
dio_scan
routine</p>
</dd>
</dl>
</div></blockquote>
</li>
</ul>
</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>xy2
40_getioscanpvt</td>
<td><p class="first">devXy240:
bi_ioinfo()</p>
<p class="last">mbbi_ioinfo()</p>
</td>
<td>Implement Scan
I/O Interrupt
support for
binary input
and multibit
binary input
records.</td>
<td><p class="first">OK,</p>
<p class="last">ERROR</p>
</td>
</tr>
<tr class="row-even"><td>xy240_bi_driver</td>
<td><p class="first">devXy240:</p>
<p class="last">read_bi(),
read_mbbi()</p>
</td>
<td>Interface to
read the binary
input registers
of the 240
board.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>xy240_bo_read</td>
<td><p class="first">devXy240:</p>
<p>init_bo(),
init_mbbo(),</p>
<p class="last">write_mbbo()</p>
</td>
<td>Interface to
read the state
of the binary
output
registers of
the 240 board.</td>
<td><p class="first">OK,</p>
<p class="last">ERROR</p>
</td>
</tr>
<tr class="row-even"><td>xy240_bo_driver</td>
<td><p class="first">devXy240:</p>
<p>write_bo(),</p>
<p class="last">write_mbbo()</p>
</td>
<td>Interface to
write to the
binary output
registers of
the 240 board.</td>
<td><p class="first">OK,</p>
<p class="last">ERROR</p>
</td>
</tr>
<tr class="row-odd"><td>xy240_io_report</td>
<td>EPICS dbior()</td>
<td>Report to show
the state of
all 8 data
ports of data
240 board</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>drvXy240Config</td>
<td>EPICS IOC Shell</td>
<td>Optional
configure
function to be
called before
iocInit() for
using any valid
base address.</td>
<td>OK, ERROR</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="specific-requirements-6">
<span id="id10"></span><h3>2.11.4 Specific Requirements<a class="headerlink" href="#specific-requirements-6" title="Permalink to this headline">¶</a></h3>
<div class="section" id="signal-to-port-mapping">
<h4>2.11.4.1 Signal to Port Mapping<a class="headerlink" href="#signal-to-port-mapping" title="Permalink to this headline">¶</a></h4>
<p>The XYCOM 240 board provides VME bus systems with 80 channels of
TTL-level input or output. The EPICS implementation uses a VMEIO
protocol to map Signals to Ports. This driver specifically maps the
first 4 ports (0,1,2 and 3) as inputs and the last 4 ports (4, 5, 6 and
7) as output. The following VMEIO Signal to XYCOM-240 port mapping is
defined.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>VMEIO
S
ignal</strong></th>
<th class="head"><ul class="first simple">
<li></li>
</ul>
<p class="last"><em>Port*</em></p>
</th>
<th class="head"><ul class="first simple">
<li></li>
</ul>
<p class="last"><em>Jack*</em></p>
</th>
<th class="head"><strong>Data
Pins</strong></th>
<th class="head"><p class="first"><strong>Inte
rrupt</strong></p>
<p class="last"><strong>Input
Pin</strong></p>
</th>
<th class="head"><strong>Flag
Output
Pin</strong></th>
<th class="head"><p class="first"><strong>G
round</strong></p>
<ul class="simple">
<li></li>
</ul>
<p class="last"><em>Pins*</em></p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>I
nputs</strong></td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>S24 to
S31</td>
<td>0</td>
<td>JK1</td>
<td>1 to 8</td>
<td>9</td>
<td>10</td>
<td>11, 12</td>
</tr>
<tr class="row-even"><td>S16 to
S23</td>
<td>1</td>
<td>JK1</td>
<td>13 to
20</td>
<td>21</td>
<td>22</td>
<td>23, 24</td>
</tr>
<tr class="row-odd"><td>S8 to
S15</td>
<td>2</td>
<td>JK1</td>
<td>25 to
32</td>
<td>33</td>
<td>34</td>
<td>35, 36</td>
</tr>
<tr class="row-even"><td>S0 to
S7</td>
<td>3</td>
<td>JK1</td>
<td>37 to
44</td>
<td>45</td>
<td>46</td>
<td>47, 48,
49, 50</td>
</tr>
<tr class="row-odd"><td><strong>Ou
tputs</strong></td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>S24 to
S31</td>
<td>4</td>
<td>JK2</td>
<td>1 to 8</td>
<td>9</td>
<td>10</td>
<td>11, 12</td>
</tr>
<tr class="row-odd"><td>S16 to
S23</td>
<td>5</td>
<td>JK2</td>
<td>13 to
20</td>
<td>21</td>
<td>22</td>
<td>23, 24</td>
</tr>
<tr class="row-even"><td>S8 to
S15</td>
<td>6</td>
<td>JK2</td>
<td>25 to
32</td>
<td>33</td>
<td>34</td>
<td>35,36</td>
</tr>
<tr class="row-odd"><td>S0 to
S7</td>
<td>7</td>
<td>JK2</td>
<td>37 to
44</td>
<td>45</td>
<td>46</td>
<td>47, 48,
49, 50</td>
</tr>
</tbody>
</table>
<p>The VMEIO specification is defined in the EPICS Application Developer’s
Guide and the EPICS Record Reference Manual. The EPICS fields INP and
OUT shall specify the format <strong>#C&lt;n&gt; S&lt;k&gt;</strong> , where <em>n</em> is the XYCOM
Card Number in the system and <em>k</em> is the Signal number as defined above
from 0 to 31.</p>
</div>
<div class="section" id="req-111-01-xycom-240-initialize">
<h4>2.11.4.2 REQ-111-01 XYCOM-240 Initialize<a class="headerlink" href="#req-111-01-xycom-240-initialize" title="Permalink to this headline">¶</a></h4>
<p>The XYCOM 240 support library shall be capable of executing the
<a class="reference external" href="#xzk5k3gvyl81">xy240_init()</a> routine without error by calling
iocInit().</p>
</div>
<div class="section" id="req-111-02-xycom-240-epics-report">
<h4>2.11.4.3 REQ-111-02 XYCOM-240 EPICS Report<a class="headerlink" href="#req-111-02-xycom-240-epics-report" title="Permalink to this headline">¶</a></h4>
<p>The EPICS routine dbior drvXycom240( &lt;interest_level&gt;) shall display the
state of all data channels respective for that card. See
<a class="reference external" href="#gpn1f63hw5id">xy240_io_report</a>.</p>
</div>
<div class="section" id="req-111-03-xycom-240-binary-output-record-support">
<h4>2.11.4.4 REQ-111-03 XYCOM-240 Binary Output Record Support<a class="headerlink" href="#req-111-03-xycom-240-binary-output-record-support" title="Permalink to this headline">¶</a></h4>
<p>The XYCOM 240 support library shall be capable of initializing and
processing an EPICS binary output record with its DTYP field set to
‘XYCOM-240’. Writing a 1 or 0 to the VAL field of this record will
result in the respective output bit being set or reset on the XYCOM 240.
The respective output shall be defined by the output signals S0 through
S31 as defined in <a class="reference external" href="#111md58bbqio">2.2.4.1 Signal to Port Mapping</a>.</p>
<p>There shall be no errors reported during the processing of the record.</p>
</div>
<div class="section" id="req-111-04-xycom-240-binary-input-record-support">
<h4>2.11.4.5 REQ-111-04 XYCOM-240 Binary Input Record Support<a class="headerlink" href="#req-111-04-xycom-240-binary-input-record-support" title="Permalink to this headline">¶</a></h4>
<p>The XYCOM 240 support library shall be capable of initializing and
processing an EPICS binary input record with its DTYP field set to
‘XYCOM-240’. Reading the VAL field of this record shall show the state
of the input bit on the XYCOM 240. The respective input shall be defined
by the input signals S0 through S31 as defined in <a class="reference external" href="#111md58bbqio">2.2.4.1 Signal to
Port Mapping</a>.</p>
<p>There shall be no errors reported during the processing of this record.</p>
</div>
<div class="section" id="req-111-05-xycom-240-multibit-binary-input-support">
<h4>2.11.4.6 REQ-111-05 XYCOM-240 Multibit Binary Input Support<a class="headerlink" href="#req-111-05-xycom-240-multibit-binary-input-support" title="Permalink to this headline">¶</a></h4>
<p>The XYCOM 240 support library shall be capable of initializing and
processing an EPICS multibit binary input (MBBI) record with its DTYP
field set to ‘XYCOM-240’. Reading the VAL field of this record shall
show the state of up to 4 input bits on the XYCOM 240. The respective
input shall be defined by the input signals S0 through S31 as defined in
<a class="reference external" href="#111md58bbqio">2.2.4.1 Signal to Port Mapping</a>. The number of input
bits is defined by the NOBT field of the record.</p>
<p>For example, if INP is defined as “#C0 S24”, and NOBT is defined as 4,
the MBBI record shall equal the state of <a class="reference external" href="#2zb6z33yfo6u">Port 0</a> pins
1 to 4. The 4 bits yield the 16 possible states of the MBBI record.</p>
</div>
<div class="section" id="req-111-06-xycom-240-multibit-binary-output-support">
<h4>2.11.4.7 REQ-111-06 XYCOM-240 Multibit Binary Output Support<a class="headerlink" href="#req-111-06-xycom-240-multibit-binary-output-support" title="Permalink to this headline">¶</a></h4>
<p>The XYCOM 240 support library shall be capable of initializing and
processing an EPICS multibit binary output record (MBBO) with its DTYP
field set to ‘XYCOM-240’. Writing to the VAL field of this record shall
configure up to 4 output bits on the XYCOM 240. The respective output
shall be defined by the output signals S0 through S31 as defined in
<a class="reference external" href="#111md58bbqio">2.2.4.1 Signal to Port Mapping</a>. The number of output
bits is defined by the NOBT field of the record.</p>
<p>For example, if OUT is defined as “#C0 S24”, and NOBT is defined as 4,
the MBBO record shall equal the state of <a class="reference external" href="#qnqr6bxvypgv">Port 4</a> pins
37 to 40. The 4 bits yield the 16 possible states of the MBBO record.</p>
</div>
<div class="section" id="req-111-07-xycom-240-binary-input-support-interrupt-scanning">
<h4>2.11.4.8 REQ-111-07 XYCOM-240 Binary Input Support (Interrupt Scanning)<a class="headerlink" href="#req-111-07-xycom-240-binary-input-support-interrupt-scanning" title="Permalink to this headline">¶</a></h4>
<p>This is the same as
<a class="reference external" href="#req-111-04-xycom-240-binary-input-record-support">REQ-111-04</a> with
the inclusion of supporting interrupt scanning. The SCAN field of the
record shall support Interrupt I/O.</p>
</div>
<div class="section" id="req-111-08-xycom-240-multibit-binary-input-support-interrupt-scanning">
<h4>2.11.4.9 REQ-111-08 XYCOM-240 Multibit Binary Input Support (Interrupt Scanning)<a class="headerlink" href="#req-111-08-xycom-240-multibit-binary-input-support-interrupt-scanning" title="Permalink to this headline">¶</a></h4>
<p>This is the same as
<a class="reference external" href="#req-111-05-xycom-240-multibit-binary-input-support">REQ-111-05</a>
with the inclusion of supporting interrupt scanning. The SCAN field of
the record shall support Interrupt I/O.</p>
</div>
</div>
</div>
<div class="section" id="xycom-566">
<h2>2.12 Xycom-566<a class="headerlink" href="#xycom-566" title="Permalink to this headline">¶</a></h2>
<p>The Xycom-566 board provides 16 differential analog input channels to
the EPICS device layer. The device and driver support code implement
three modes: Single-Ended, Differential Scanned mode and Differential
Latched. In practice at Gemini, only differential scanned mode is used.</p>
<div class="section" id="database-definition-file-xy566-dbd">
<h3>2.12.1 Database Definition File (xy566.dbd)<a class="headerlink" href="#database-definition-file-xy566-dbd" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>device(ai,VME_IO, devAiXy566Se,”XYCOM-566 SE Scanned”)</p>
<p>device(ai,VME_IO, devAiXy566Di,”XYCOM-566 Dif Scanned”)</p>
<p>device(ai,VME_IO, devAiXy566DiL,”XYCOM-566 Dif Latched”)</p>
<p>device(waveform,VME_IO, devWfXy566Sc,”XYCOM-566 Single Channel”)</p>
<p>driver(drvXy566)</p>
<p>registrar(xy566RegisterCommands)</p>
</div></blockquote>
</div>
<div class="section" id="device-support-requirements-2">
<span id="id11"></span><h3>2.12.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements-2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="linear-conversions-provided-by-the-xycom-566-device-support">
<h4>2.12.2.1 Linear Conversions provided by the Xycom 566 device support<a class="headerlink" href="#linear-conversions-provided-by-the-xycom-566-device-support" title="Permalink to this headline">¶</a></h4>
<p>Users must define EGUF and EGUL for the max and min engineering units
that the card can measure. The driver will use those values to figure
out ESLO (the slope) and EOFF (the offset). Record support then
multiples the raw value by ESLO, then adds EOFF to get the VAL in
engineering units. See the EPICS Record Reference Manual for more of
those details.</p>
</div>
<div class="section" id="differential-scanned-mode-at-initialization">
<h4>2.12.2.2 Differential Scanned Mode at Initialization<a class="headerlink" href="#differential-scanned-mode-at-initialization" title="Permalink to this headline">¶</a></h4>
<p>The driver at Gemini is initialized with the following register
configurations.</p>
<div class="section" id="xy566-settings">
<h5>2.12.2.2.1 XY566 Settings<a class="headerlink" href="#xy566-settings" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="35%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Register</strong></th>
<th class="head"><strong>Register Value</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Reset the counter
interrupt</td>
<td>CSR</td>
<td>0x8000</td>
</tr>
<tr class="row-odd"><td>Reset the sequence
interrupt</td>
<td>CSR</td>
<td>0x2000</td>
</tr>
<tr class="row-even"><td>Reset the trigger
clock interrupt</td>
<td>CSR</td>
<td>0x0800</td>
</tr>
<tr class="row-odd"><td>enable the sequence
controller</td>
<td>CSR</td>
<td>0x0100</td>
</tr>
<tr class="row-even"><td>Read values into
first 32 words on
each read</td>
<td>CSR</td>
<td>0x0040</td>
</tr>
<tr class="row-odd"><td>Read in sequential
mode</td>
<td>CSR (bit 0x0020 == 0)</td>
<td>0x0000</td>
</tr>
<tr class="row-even"><td>Leds green-on red-off</td>
<td>CSR</td>
<td>0x0003</td>
</tr>
<tr class="row-odd"><td>Latch the first bunch
of data, then start
continuous scan mode.</td>
<td>SOFT_START</td>
<td>0x00</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="amd-9513a-system-timing-controller-settings">
<h5>2.12.2.2.2 AMD 9513A System Timing Controller Settings<a class="headerlink" href="#amd-9513a-system-timing-controller-settings" title="Permalink to this headline">¶</a></h5>
<p>Successive writes into the STC Control and Data Registers are made to
configure the A/D conversion modes and timing characteristics of the
Xycom-566. The initialize routine will always make the same
configuration with the driver designed as-is. See the following table
and the Am9513A Manual for programming details.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Register</strong></th>
<th class="head"><strong>AMD 9513A
RegisterValue</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Initialize the
Am9513 on the Xycom
566</strong></td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Master Reset</td>
<td>STC Control</td>
<td>0xffff</td>
</tr>
<tr class="row-even"><td>Disarm all counters</td>
<td>STC Control</td>
<td>0xff5f</td>
</tr>
<tr class="row-odd"><td>16-bit mode</td>
<td>STC Control</td>
<td>0xffef</td>
</tr>
<tr class="row-even"><td><strong>Master Mode
Register Setup</strong></td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Select Master Mode
Register</td>
<td>STC Control</td>
<td>0xff17</td>
</tr>
<tr class="row-even"><td>16 bit, divide by 4</td>
<td>STC Data</td>
<td>0x2200</td>
</tr>
<tr class="row-odd"><td><strong>Counter 2 is used
to set the time
between sequences</strong></td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Select Counter 2</td>
<td>STC Control</td>
<td>0xff02</td>
</tr>
<tr class="row-odd"><td>Counter 2 TC Toggle
Mode</td>
<td>STC Data</td>
<td>0x0b02</td>
</tr>
<tr class="row-even"><td>Counter 2 TC Output
High</td>
<td>STC Control</td>
<td>0xffea</td>
</tr>
<tr class="row-odd"><td><strong>Counter 4 is used
as time between
sequence elements</strong></td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Select Counter 4</td>
<td>STC Control</td>
<td>0xff04</td>
</tr>
<tr class="row-odd"><td>Counter 4 TC Toggle
Mode</td>
<td>STC Data</td>
<td>0x0b02</td>
</tr>
<tr class="row-even"><td>Counter 4 TC Output
High</td>
<td>STC Control</td>
<td>0xffec</td>
</tr>
<tr class="row-odd"><td><strong>Counter 5 is used
as an event
counter</strong></td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Select Counter 5</td>
<td>STC Control</td>
<td>0xff05</td>
</tr>
<tr class="row-odd"><td>Counter 5 TC Toggle
Mode</td>
<td>STC Data</td>
<td>0x0b02</td>
</tr>
<tr class="row-even"><td>Counter 5 TC Output
High</td>
<td>STC Control</td>
<td>0xffed</td>
</tr>
<tr class="row-odd"><td><strong>Set time between
sequences</strong></td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Select Counter 4
(again)</td>
<td>STC Control</td>
<td>0xff04</td>
</tr>
<tr class="row-odd"><td>See 9513A manual</td>
<td>STC Data (unknown
setting)</td>
<td>0x9525</td>
</tr>
<tr class="row-even"><td>Downcount value</td>
<td>STC DATA</td>
<td>0x0014</td>
</tr>
<tr class="row-odd"><td>Load and Arm Counter
4</td>
<td>STC Control</td>
<td>0xff68</td>
</tr>
<tr class="row-even"><td>Select Counter 5
(again)</td>
<td>STC Control</td>
<td>0xff05</td>
</tr>
<tr class="row-odd"><td>See 9513A manual</td>
<td>STC Data (unknown
setting)</td>
<td>0x97ad</td>
</tr>
<tr class="row-even"><td>Downcount value</td>
<td>STC Data</td>
<td>0x0100</td>
</tr>
<tr class="row-odd"><td>Load and Arm Counter
5</td>
<td>STC Control</td>
<td>0xff70</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="driver-support-requirements-2">
<span id="id12"></span><h3>2.12.3 Driver Support Requirements<a class="headerlink" href="#driver-support-requirements-2" title="Permalink to this headline">¶</a></h3>
<p>The Xycom-566 driver provides access to configure and control the analog
input of the Xycom 566 board. The EPICS device support requires the
following routines.</p>
<p>long xy566_init (void);</p>
<p>long xy566_report(int level);</p>
<p>int ai_xy566_getioscanpvt(unsigned short card, IOSCANPVT *scanpvt);</p>
<p>int ai_xy566_driver (short card, short chan, unsigned int type, unsigned
short *prval );</p>
<p>int xy566_driver (unsigned short slot, void (<a href="#id13"><span class="problematic" id="id14">*</span></a>pcbroutine)(void *), void
*parg );</p>
<p>void xy566_set_gain(int card, int val);</p>
<p>int xy566SEConfig (unsigned int ncards, unsigned int nchannels, unsigned
int base, unsigned int memory);</p>
<p>int xy566DIConfig (unsigned int ncards, unsigned int nchannels, unsigned
int base, unsigned int memory);</p>
<p>int xy566DILConfig(unsigned int ncards, unsigned int nchannels, unsigned
int base, unsigned int memory);</p>
<p>int xy566WFConfig (unsigned int ncards, unsigned int nchannels, unsigned
int base, unsigned int memory,</p>
<blockquote>
<div>unsigned int armaddr, unsigned int vector);</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Usedby</strong></th>
<th class="head"><strong>Meaning</strong></th>
<th class="head"><strong>Returns</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>xy566_init</td>
<td>EPICS
iocInit()</td>
<td><ul class="first last">
<li><dl class="first docutils">
<dt>Allocate</dt>
<dd><blockquote class="first">
<div><p>memory
for
xy566</p>
</div></blockquote>
<p class="last">registers</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Allocate</dt>
<dd><p class="first last">memory
for Data
RAM</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>reset the</dt>
<dd><p class="first last">Xycom
566
board</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>initialize</dt>
<dd><p class="first last">the
Am9513
chip on
the
Xycom566</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Reset the</dt>
<dd><blockquote class="first">
<div><p>counter,
sequence
and
trigger
clock</p>
</div></blockquote>
<p class="last">interrupts</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Enable the</dt>
<dd><blockquote class="first">
<div><p>sequence</p>
</div></blockquote>
<p class="last">controller</p>
</dd>
</dl>
</li>
</ul>
</td>
<td>OK</td>
</tr>
<tr class="row-odd"><td>ai_xy56
6_getioscanpvt</td>
<td>d
evAiXy566DiL.c</td>
<td>Configure
interrupts and
callback for
I/O Interrupt
scanning.</td>
<td>OK</td>
</tr>
<tr class="row-even"><td>a
i_xy566_driver</td>
<td><p class="first">devAiXy566Di.c</p>
<p>d
evAiXy566DiL.c</p>
<p class="last">devAiXy566Se.c</p>
</td>
<td>Configure the
card and read
the raw data
from 566 RAM.</td>
<td>OK, -1 Card
Range, -2
Channel Range,
-3 Mode not
supported.</td>
</tr>
<tr class="row-odd"><td>xy566_driver</td>
<td>devWfXy566.c</td>
<td>Configure and
arm a waveform
built from raw
data in 566
RAM.</td>
<td>OK, -1 No
card, -2
Callback
already in
use.</td>
</tr>
<tr class="row-even"><td>xy566_report</td>
<td>EPICS dbior()</td>
<td>Report to show
the state of
all channels.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>xy566_set_gain</td>
<td>IOC Shell at
startup</td>
<td>This has to be
called BEFORE
any of the the
Configure
routines below
are called for
each card.
Valid values
are 1,2,5,10.</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>xy566SEConfig</td>
<td>Single Ended
Mode</td>
<td>Configure use
of the 566 for
Single Ended
mode. Call
BEFORE
iocInit().</td>
<td>OK</td>
</tr>
<tr class="row-odd"><td>xy566DIConfig</td>
<td>Differential
Mode</td>
<td>Configure use
of the 566 for
Differential
mode. Call
BEFORE
iocInit().</td>
<td>OK</td>
</tr>
<tr class="row-even"><td>xy566DILConfig</td>
<td>Differential
Latched</td>
<td>Configure use
of the 566 for
Differential
Latched mode.
Call BEFORE
iocInit().</td>
<td>OK</td>
</tr>
<tr class="row-odd"><td>xy566WFConfig</td>
<td>WaveForm
Support</td>
<td>Configure use
of the 566 for
Waveform mode.
Call BEFORE
iocInit().</td>
<td>OK</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="specific-requirements-7">
<span id="id15"></span><h3>2.12.4 Specific Requirements<a class="headerlink" href="#specific-requirements-7" title="Permalink to this headline">¶</a></h3>
<div class="section" id="vmeio-signal-pinout">
<h4>2.12.4.1 VMEIO Signal Pinout<a class="headerlink" href="#vmeio-signal-pinout" title="Permalink to this headline">¶</a></h4>
<p>The Xycom-566 board provides the VME bus with 32-Single ended or 16
differential channels of analog input. The EPICS implementation uses a
VMEIO protocol to map Signals to channels. The following VMEIO Signal to
Xycom-566 pinouts are defined.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="35%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>JK1</strong></th>
<th class="head"><strong>Single Ended</strong></th>
<th class="head"><strong>Differential</strong></th>
</tr>
<tr class="row-even"><th class="head"><strong>Front panel pin</strong></th>
<th class="head"><strong>VMEIO Signal</strong></th>
<th class="head"><strong>VMEIO Signal</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>1</td>
<td>0</td>
<td>0 LO</td>
</tr>
<tr class="row-even"><td>2</td>
<td>8</td>
<td>0 HI</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-even"><td>4</td>
<td>9</td>
<td>1 HI</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>1</td>
<td>1 LO</td>
</tr>
<tr class="row-even"><td>6</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-odd"><td>7</td>
<td>2</td>
<td>2 LO</td>
</tr>
<tr class="row-even"><td>8</td>
<td>10</td>
<td>2 HI</td>
</tr>
<tr class="row-odd"><td>9</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-even"><td>10</td>
<td>11</td>
<td>3 HI</td>
</tr>
<tr class="row-odd"><td>11</td>
<td>3</td>
<td>3 LO</td>
</tr>
<tr class="row-even"><td>12</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-odd"><td>13</td>
<td>4</td>
<td>4 LO</td>
</tr>
<tr class="row-even"><td>14</td>
<td>12</td>
<td>4 HI</td>
</tr>
<tr class="row-odd"><td>15</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-even"><td>16</td>
<td>5</td>
<td>5 HI</td>
</tr>
<tr class="row-odd"><td>17</td>
<td>13</td>
<td>5 LO</td>
</tr>
<tr class="row-even"><td>18</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-odd"><td>19</td>
<td>6</td>
<td>6 LO</td>
</tr>
<tr class="row-even"><td>20</td>
<td>14</td>
<td>6 HI</td>
</tr>
<tr class="row-odd"><td>21</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-even"><td>22</td>
<td>15</td>
<td>7 HI</td>
</tr>
<tr class="row-odd"><td>23</td>
<td>7</td>
<td>7 LO</td>
</tr>
<tr class="row-even"><td>24</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-odd"><td>25</td>
<td>16</td>
<td>8 LO</td>
</tr>
<tr class="row-even"><td>26</td>
<td>24</td>
<td>8 HI</td>
</tr>
<tr class="row-odd"><td>27</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-even"><td>28</td>
<td>25</td>
<td>9 HI</td>
</tr>
<tr class="row-odd"><td>29</td>
<td>17</td>
<td>9 LO</td>
</tr>
<tr class="row-even"><td>30</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-odd"><td>31</td>
<td>18</td>
<td>10 LO</td>
</tr>
<tr class="row-even"><td>32</td>
<td>26</td>
<td>10 HI</td>
</tr>
<tr class="row-odd"><td>33</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-even"><td>34</td>
<td>27</td>
<td>11 HI</td>
</tr>
<tr class="row-odd"><td>35</td>
<td>19</td>
<td>11 LO</td>
</tr>
<tr class="row-even"><td>36</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-odd"><td>37</td>
<td>20</td>
<td>12 LO</td>
</tr>
<tr class="row-even"><td>38</td>
<td>28</td>
<td>12 HI</td>
</tr>
<tr class="row-odd"><td>39</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-even"><td>40</td>
<td>29</td>
<td>12 HI</td>
</tr>
<tr class="row-odd"><td>41</td>
<td>21</td>
<td>12 LO</td>
</tr>
<tr class="row-even"><td>42</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-odd"><td>43</td>
<td>22</td>
<td>14 LO</td>
</tr>
<tr class="row-even"><td>44</td>
<td>30</td>
<td>14 HI</td>
</tr>
<tr class="row-odd"><td>45</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-even"><td>46</td>
<td>31</td>
<td>15 HI</td>
</tr>
<tr class="row-odd"><td>47</td>
<td>23</td>
<td>15 LO</td>
</tr>
<tr class="row-even"><td>48</td>
<td>GND</td>
<td>GND</td>
</tr>
<tr class="row-odd"><td>49</td>
<td>GDN (Ext. trigger, PDI)</td>
<td>GDN (Ext. trigger, PDI)</td>
</tr>
<tr class="row-even"><td>50</td>
<td>Ext. Trigger</td>
<td>Ext. Trigger</td>
</tr>
</tbody>
</table>
<p>The VMEIO specification is defined in the EPICS Application Developer’s
Guide and the EPICS Record Reference Manual. The EPICS field INP shall
specify the format <strong>#C&lt;n&gt; S&lt;k&gt;</strong> , where <em>n</em> is the Xycom Card Number
in the system and <em>k</em> is the Signal number as defined above from 0 to
31. See <a class="reference external" href="#test-setup-and-prerequisites-10">3.13.1 Test Setup and
Prerequisites</a> .</p>
</div>
<div class="section" id="req-112-01-initialize">
<h4>2.12.4.2 REQ-112-01 Initialize<a class="headerlink" href="#req-112-01-initialize" title="Permalink to this headline">¶</a></h4>
<p>The Xycom-566 support library shall be capable of executing the
<a class="reference external" href="#q70cgd44ilou">xy566_init()</a> routine without error by calling
iocInit().</p>
</div>
<div class="section" id="req-112-02-epics-report">
<h4>2.12.4.3 REQ-112-02 EPICS Report<a class="headerlink" href="#req-112-02-epics-report" title="Permalink to this headline">¶</a></h4>
<p>The EPICS routine dbior drvXy566( &lt;interest_level&gt;) shall display the
state of all data channels respective for that card. See
<a class="reference external" href="#234l2buazs8q">xy566_report</a>.</p>
</div>
<div class="section" id="req-112-03-xy566diconfig">
<h4>2.12.4.4 REQ-112-03 xy566DIConfig<a class="headerlink" href="#req-112-03-xy566diconfig" title="Permalink to this headline">¶</a></h4>
<p>The Xycom-566 driver shall provide a configure routine to be called on
the iocShell at startup. The configure routine xy566DIConfig() will set
the base address of the board and the data address of the memory
consistent with the configuration of the 566 board.</p>
</div>
<div class="section" id="req-112-04-analog-input-record-support">
<h4>2.12.4.5 REQ-112-04 Analog Input Record Support<a class="headerlink" href="#req-112-04-analog-input-record-support" title="Permalink to this headline">¶</a></h4>
<p>The Xycom-566 driver shall be capable of initializing and processing an
EPICS analog input record with its DTYP field set to ‘XYCOM-566 Dif
Scanned’. Reading the VAL field of this record shall show the state of
the input channel on the XYCOM 566.</p>
<p>The respective input shall be defined by the input signals S0 through
S31 as defined in 2.2.4.1 Signal to Port Mapping.</p>
</div>
<div class="section" id="req-112-05-gain-control">
<h4>2.12.4.6 REQ-112-05 Gain Control<a class="headerlink" href="#req-112-05-gain-control" title="Permalink to this headline">¶</a></h4>
<p>The Xycom-566 uses a 32-element on-board Gain RAM to store a gain factor
for each analog input channel. One of three gain ranges is selected via
jumper option at the time the module is installed (See the <a class="reference external" href="https://drive.google.com/open?id=0B4C51TY6UtsQenNNWndvd3QyVGc">Xycom-556
Manual Section
2.7.5</a>).</p>
<p>Regardless of which gain range jumper is set on the board, the Xycom-566
driver shall provide a function available to the IOC shell to set the
gain factor. The legacy driver is currently designed to set all analog
channels on the board to the same gain factor. See
<a class="reference external" href="#yh3nl2t6iaii">xy566_set_gain()</a>. This function must be called prior
to iocInit().</p>
<p>The Gain is user programmable in the startup script by calling
xy566_set_gain(cardnumber, gain_entry ) , where cardnumber is the number
of the 566 board starting at zero and gain_entry is the element number
of the four available gain levels (0 - 3). With Jumper J7 set for gain
range X1, the levels are (1, 2, 5, 10) respectively. This means that the
MCS tachometers have unity gain and the motor currents have a gain of 2
as shown in the <a class="reference external" href="https://drive.google.com/open?id=11SiQmNp9DEFfp89ijOznZefrOQr9GnBmJq9qmW9DxLs">MCS System
Note</a>
regarding the Xycom 566.</p>
</div>
<div class="section" id="req-112-06-xy566seconfig">
<h4>2.12.4.7 REQ-112-06 xy566SEConfig<a class="headerlink" href="#req-112-06-xy566seconfig" title="Permalink to this headline">¶</a></h4>
<p>The Xycom-566 driver shall provide a configure routine for <strong>Single
Ended</strong> operation to be called on the iocShell at startup. The configure
routine xy566SEConfig() will set the base address of the board and the
data address of the memory consistent with the configuration of the 566
board.</p>
</div>
<div class="section" id="req-112-07-xy566dilconfig">
<h4>2.12.4.8 REQ-112-07 xy566DILConfig<a class="headerlink" href="#req-112-07-xy566dilconfig" title="Permalink to this headline">¶</a></h4>
<p>The Xycom-566 driver shall provide a configure routine for
<strong>Differential Input Latched</strong> operation to be called on the iocShell at
startup. The configure routine xy566DILConfig() will set the base
address of the board and the data address of the memory consistent with
the configuration of the 566 board.</p>
</div>
<div class="section" id="req-112-08-xy566wfconfig">
<h4><strong>2.12.4.9 REQ-112-08 xy566WFConfig</strong><a class="headerlink" href="#req-112-08-xy566wfconfig" title="Permalink to this headline">¶</a></h4>
<p>The Xycom-566 driver shall provide a configure routine for <strong>Wave Form</strong>
operation to be called on the iocShell at startup. The configure routine
xy566WFConfig() will set the base address of the board and the data
address of the memory consistent with the configuration of the 566
board.</p>
</div>
<div class="section" id="req-112-09-xycom-566-two-card-support">
<h4>2.12.4.10 REQ-112-09 XYCOM-566 Two Card Support<a class="headerlink" href="#req-112-09-xycom-566-two-card-support" title="Permalink to this headline">¶</a></h4>
<p>The driver shall support two (2) cards. All requirements REQ-112-01
through REQ-112-08 shall be supported on either of two XYCOM-566 cards.
EPICS input and output channels shall be specified as Card 0 or 1 and
Signals 0 through 49. The schematic design tools such as TDCT shall
specify the input or output links as “#C&lt;0|1&gt;பS&lt;0…49&gt;”.</p>
</div>
</div>
</div>
<div class="section" id="pmac">
<h2>2.13 PMAC<a class="headerlink" href="#pmac" title="Permalink to this headline">¶</a></h2>
<p>The Delta Tau Data Systems, Inc. Programmable Multi-Axis Controller
(PMAC) is a family of high performance servo motion controllers capable
of commanding up to eight axes of motion simultaneously with a high
level of sophistication. Motorola’s DSP56001 is the CPU for PMAC, and it
handles all the calculations for all eight axes.</p>
<p>PMAC is configured for a particular application by choice of the
hardware set (through options and accessories), configuration of
parameters, and the writing of motion and PLC programs. Each PMAC
possesses firmware capable of controlling eight axes. The eight axes can
be associated all together for completely coordinated motion; each axis
can be put in its own coordinate system for eight completely independent
operations; any intermediate arrangement of axes into coordinate systems
is also possible.</p>
<p>The PMAC CPU communicates with the axes through specially designed
custom gate array ICs, referred to as DSPGATES. Each of these ICs can
handle four analog output channels, four encoders as input, and four
analog-derived inputs from accessory boards. One PMAC can utilize from
one to four of these gate array ICs, so specifying the hardware
configuration amounts to counting the numbers and types of inputs and
outputs. Up to 16 PMAC modules ay be ganged together with complete
synchronization, for a total of 128 axes.</p>
<div class="section" id="database-definition-file-pmacdev-dbd">
<h3>2.13.1 Database Definition File (pmacDev.dbd)<a class="headerlink" href="#database-definition-file-pmacdev-dbd" title="Permalink to this headline">¶</a></h3>
<p>device(ai,VME_IO,devPmacMbxAi,”PMAC-VME ASCII”)</p>
<p>device(ai,VME_IO,devPmacRamAi,”PMAC-VME DPRAM”)</p>
<p>device(ao,VME_IO,devPmacMbxAo,”PMAC-VME ASCII”)</p>
<p>device(ao,VME_IO,devPmacRamAo,”PMAC-VME DPRAM”)</p>
<p>device(bi,VME_IO,devPmacMbxBi,”PMAC-VME ASCII”)</p>
<p>device(bi,VME_IO,devPmacRamBi,”PMAC-VME DPRAM”)</p>
<p>device(bo,VME_IO,devPmacMbxBo,”PMAC-VME ASCII”)</p>
<p>device(bo,VME_IO,devPmacRamBo,”PMAC-VME DPRAM”)</p>
<p>device(event,VME_IO,devPmacRamEvent,”PMAC-VME DPRAM”)</p>
<p>device(longin,VME_IO,devPmacMbxLi,”PMAC-VME ASCII”)</p>
<p>device(longin,VME_IO,devPmacRamLi,”PMAC-VME DPRAM”)</p>
<p>device(longout,VME_IO,devPmacMbxLo,”PMAC-VME ASCII”)</p>
<p>device(longout,VME_IO,devPmacRamLo,”PMAC-VME DPRAM”)</p>
<p>device(mbbi,VME_IO,devPmacMbxMbbi,”PMAC-VME ASCII”)</p>
<p>device(mbbi,VME_IO,devPmacRamMbbi,”PMAC-VME DPRAM”)</p>
<p>device(mbbo,VME_IO,devPmacMbxMbbo,”PMAC-VME ASCII”)</p>
<p>device(mbbo,VME_IO,devPmacRamMbbo,”PMAC-VME DPRAM”)</p>
<p>device(stringin,VME_IO,devPmacMbxSi,”PMAC-VME ASCII”)</p>
<p>device(stringout,VME_IO,devPmacMbxSo,”PMAC-VME ASCII”)</p>
<p>device(load,VME_IO,devPmacMbxLoad,”PMAC-VME ASCII”)</p>
<p>device(status,VME_IO,devPmacMbxStatus,”PMAC-VME ASCII”)</p>
<p>device(status,VME_IO,devPmacRamStatus,”PMAC-VME DPRAM”)</p>
</div>
<div class="section" id="device-support-requirements-3">
<span id="id16"></span><h3>2.13.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements-3" title="Permalink to this headline">¶</a></h3>
<p>The following device support routines are required for the PMAC:</p>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>devPmacMbxAi – Provide Analog Input support for the PMAC Mailbox</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamAi – ProvideAnalog Input support for the PMAC DPRam</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxAo – Provide Analog Output support for the PMAC Mailbox</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamAo – Provide Analog Output support for the PMAC DPRam</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxBi – Provide Binary Input support for the PMAC Mailbox</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamBi – Provide Binary Input support for the PMAC DPRam</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxBo – Provide Binary Output support for the PMAC Mailbox</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamBo – Provide Binary Output support for the PMAC DPRam</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamEvent – Provide Event records support for the PMAC DPRam</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxLi – Provide Longin device support for the PMAC Mailbox</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamLi – Provide Longin device support for the PMAC DPRam</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxLo – Provide Longout device support for the PMAC Mailbox</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamLo – Provide Longout device support for the PMAC DPRam</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxMbbi – Provide Multibit Binary Input device support for</dt>
<dd>the PMAC Mailbox access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamMbbi – Provide Multibit Binary Input device support for</dt>
<dd>the PMAC DPRam access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxMbbo – Provide Multibit Binary Output device support for</dt>
<dd>the PMAC Mailbox access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamMbbo – Provide Multibit Binary Output device support for</dt>
<dd>the PMAC DPRam access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxSi – Provide Stringin record device support for the PMAC</dt>
<dd>Mailbox access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxSo – Provide Stringout record device support for the PMAC</dt>
<dd>Mailbox access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxLoad – Provide Load record device support for the PMAC</dt>
<dd>Mailbox access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacMbxStatus – Provide Status record device support for the</dt>
<dd>PMAC Mailbox access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devPmacRamStatus – Provide Status record device support for the</dt>
<dd>PMAC DPRam access.</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="driver-support-requirements-3">
<span id="id17"></span><h3>2.13.3 Driver Support Requirements<a class="headerlink" href="#driver-support-requirements-3" title="Permalink to this headline">¶</a></h3>
<p>The following driver functions are the key tasks running on a loaded
PMAC driver and represent all aspects of the required functionality at
Gemini. These tasks are structured into two type of support: Mailbox
communications and Dual Port Ram communications. Dual Port memory has
several different regions with different data types. Further, the PMAC
has internal scan clocks making certain types of DPRam available at
different phases of the processing cycle. For this reason, there are
several different EPICS Scan Threads dealing with the different DPRam
types.</p>
<p>long pmacConfig(int cardNumber, unsigned long addrBase, unsigned long
addrDpram,</p>
<blockquote>
<div>unsigned int irqVector, unsigned int irqLevel);</div></blockquote>
<p>PMAC_LOCAL long drvPmac_report(int level);</p>
<p>PMAC_LOCAL long drvPmac_init(void);</p>
<p>PMAC_LOCAL long drvPmacStartup(void);</p>
<p>void drvPmacMbxScan (PMAC_MBX_IO * pMbxIo);</p>
<p>void drvPmacFldScan (PMAC_MBX_IO * pMbxIo);</p>
<p>PMAC_LOCAL long drvPmacRamGetData(PMAC_RAM_IO *);</p>
<p>PMAC_LOCAL long drvPmacRamPutData(PMAC_RAM_IO *);</p>
<p>long drvPmacDpramRequest(short, short, char *, void (*)(), void *,
PMAC_RAM_IO **, int);</p>
<p>EPICSTHREADFUNC drvPmacMbxTask(PMAC_CARD *pCard);</p>
<p>EPICSTHREADFUNC drvPmacSvoTask(void *);</p>
<p>EPICSTHREADFUNC drvPmacBkgTask(void *);</p>
<p>EPICSTHREADFUNC drvPmacVarTask(void *);</p>
<p>EPICSTHREADFUNC drvPmacOpnTask(void *);</p>
<p>EPICSTHREADFUNC drvPmacAscTask(void *);</p>
<p>EPICSTHREADFUNC drvPmacFldTask(void *);</p>
<p>long drvPmacSvoRead(int);</p>
<p>long drvPmacBkgRead(int);</p>
<p>long drvPmacVarRead(int);</p>
<p>long drvPmacOpnRead(int);</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="27%" />
<col width="27%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Usedby</strong></th>
<th class="head"><strong>Meaning</strong></th>
<th class="head"><strong>Returns</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>pmacConfig</td>
<td>IOC Shell
Startup</td>
<td><p class="first">Configure VME
for PMAC with:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>cardNumber</dt>
<dd>in the
crate</dd>
</dl>
</li>
<li>addrBase</li>
<li>addrDpram,</li>
<li>irqVector</li>
<li>irqLevel</li>
</ul>
<p>All Values Must
Agree with</p>
<p>X:$0783 -
X:$078C</p>
<p>Example for 2
cards:</p>
<p>pmacConfig(0,
0x7FA000,
0x700000, 0xa1,
6)</p>
<p class="last">pmacConfig(1,
0x7FA200,
0x704000, 0xa5,
6)</p>
</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>drvPmac_report</td>
<td>IOC Shell</td>
<td>Register
function with
EPICS dbior().
Report shows
the state of
all initialized
PMAC boards and
their
configuration.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>drvPmac_init</td>
<td>EPICS iocInit()</td>
<td>Calls
pmacVmeInit().
Initializes
PMAC-VME
Hardware
Configuration</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>drvPmacStartup</td>
<td><p class="first">devPmacMbx.c:</p>
<p>de
vPmacMbx_init()</p>
<p>devPmacRam.c:</p>
<p class="last">de
vPmacRam_init()</p>
</td>
<td>Startup the
PMAC driver by
initializing
all scan
threads.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>drvPmacMbxScan</td>
<td><p class="first">devPmacMbx.c:
r/w</p>
<p>devP
macMbxAi_read()</p>
<p>devP
macMbxBi_read()</p>
<p>devP
macMbxLi_read()</p>
<p>devPma
cMbxMbbi_read()</p>
<p>devPmacM
bxStatus_read()</p>
<p>devPm
acMbxAo_write()</p>
<p>devPm
acMbxBo_write()</p>
<p>devPm
acMbxLo_write()</p>
<p>devPmac
MbxMbbo_write()</p>
<p>devP
macMbxSi_read()</p>
<p class="last">devPm
acMbxSo_write()</p>
</td>
<td><p class="first">Put PMAC MBX
request on
ASCII
communications
queue. The
queue is
implemented
with an
ep
icsRingPointer.
So we push the
data with
epicsRingPoin
terPush(&amp;data),
then release
the Scan
Mailbox
semaphore by
calling
epicsEventS
igal(mbxSemID).</p>
<p class="last">See <a class="reference external" href="#mailbox-thread">2.13.5.1
Mailbox
Thread</a></p>
</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>drvPmacFldScan</td>
<td><p class="first">devPmacMbx.c:</p>
<p>Load record</p>
<p class="last">devPma
cMbxLoad_proc()</p>
</td>
<td><p class="first">The Load record
adds the file
request on to
the scanFld
queue. The
corresponding
tak parses and
sends new PMAC
programs to the
board.</p>
<p>Implements PMAC
Load Record
support by
setting up the
pRec-&gt;dnv and
pRec-&gt;upv with
the command and
response
respectively.
In this case
the command is
the filename to
download to the
PMAC.</p>
<p class="last">See <a class="reference external" href="#file-download-thread">2.13.5.3
File Download
Thr
ead</a></p>
</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>dr
vPmacRamGetData</td>
<td><p class="first">drvPmac.c:</p>
<p>d
rvPmacVarRead()</p>
<p>d
rvPmacBkgRead()</p>
<p class="last">d
rvPmacSvoRead()</p>
</td>
<td>Read data from
PMAC DPRAM</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>dr
vPmacRamPutData</td>
<td><p class="first">devPmacRam.c:
r/w</p>
<p>devPm
acRamAo_write()</p>
<p>devPm
acRamBo_write()</p>
<p>devPm
acRamLo_write()</p>
<p>devPmac
RamMbbo_write()</p>
<p>devP
macRamSi_read()</p>
<p class="last">devPm
acRamSo_write()</p>
</td>
<td>Write data to
PMAC DPRAM</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>drvP
macDpramRequest</td>
<td><p class="first">devPmacRam.c:</p>
<p>devP
macRamAi_init()</p>
<p>devP
macRamBi_init()</p>
<p>devPmac
RamEvent_init()</p>
<p>devP
macRamLi_init()</p>
<p>devP
macRamLi_init()</p>
<p>devPmacR
amStatus_init()</p>
<p>devP
macRamAo_init()</p>
<p>devP
macRamBo_init()</p>
<p>devP
macRamLo_init()</p>
<p class="last">devPma
cRamMbbo_init()</p>
</td>
<td>Add PMAC DPRAM
address to scan
list</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>drvPmacSvoRead</td>
<td>drvPmacSvoTask</td>
<td><p class="first">Read Servo
Fixed Buffer
data</p>
<p class="last">See <a class="reference external" href="#servo-data-reporting-scan-thread">2.13.5.2.1
Servo Fixed
Data Scan
Thread</a></p>
</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>drvPmacBkgRead</td>
<td>drvPmacBkgTask</td>
<td><p class="first">Read Background
Fixed Data
Buffer</p>
<p class="last">See <a class="reference external" href="#background-fixed-data-reporting-scan-thread">2.13.5.2.2
Background
Fixed Data Scan
Thread</a></p>
</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>drvPmacVarRead</td>
<td>drvPmacVarTask</td>
<td><p class="first">Read Background
Variable Data
Buffer</p>
<p class="last">See <a class="reference external" href="#background-variable-data-reporting-scan-thread">2.13.5.2.3
Backgroung
Variable Data
Scan
Thread</a></p>
</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>drvPmacOpnRead</td>
<td>drvPmacOpnTask</td>
<td><p class="first">Read
Dual-Ported Ram
from the Open
area</p>
<p class="last">See <a href="#id410"><span class="problematic" id="id411">`2.13.5.2.4
Open Area of
Dual Ported Ram
Scan
Thread &lt;
#open-area-of-d
ual-ported-ram-
scan-thread&gt;`__</span></a></p>
</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="vme-interrupts-request-vector-and-handlers">
<h3>2.13.4 VME Interrupts Request Vector and Handlers<a class="headerlink" href="#vme-interrupts-request-vector-and-handlers" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="29%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Vector base from
pmacConfig()</th>
<th class="head">Handler</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>baseIrqVector -1</td>
<td>pmacMbxReceiptISR</td>
<td>ISR for mailbox
receipt acknowledge</td>
</tr>
<tr class="row-odd"><td>baseIrqVector</td>
<td>pmacMbxReadmeISR</td>
<td>ISR for mailbox
message arrival</td>
</tr>
<tr class="row-even"><td>baseIrqVector +1</td>
<td>pmacAscInISR</td>
<td>ISR for ASCII
Host-Input Buffer
Ready</td>
</tr>
<tr class="row-odd"><td>baseIrqVector +2</td>
<td>pmacGatBufferISR</td>
<td>ISR for DPRAM Data
Gathering Buffer</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pmac-data-scan-threads">
<h3>2.13.5 PMAC Data Scan Threads<a class="headerlink" href="#pmac-data-scan-threads" title="Permalink to this headline">¶</a></h3>
<p>The PMAC driver has dedicated threads running to scan for updates to the
Mailbox to the Dual-Ported Ram..</p>
<div class="section" id="mailbox-thread">
<h4>2.13.5.1 Mailbox Thread<a class="headerlink" href="#mailbox-thread" title="Permalink to this headline">¶</a></h4>
<p>The Mailbox scan thread manages all mailbox requests from EPICS records.
If any of the mailbox related records (listed above in
<a class="reference external" href="#46vp227yje8g">drvPmacMbxScan()</a> section) process, this causes the
drvPmacMbxScan() thread to run. The Mailbox Request is then added to the
mailbox queue and processed on the VME backplane.</p>
</div>
<div class="section" id="dual-port-memory-automatic-functions">
<h4>2.13.5.2 Dual Port Memory Automatic Functions<a class="headerlink" href="#dual-port-memory-automatic-functions" title="Permalink to this headline">¶</a></h4>
<p>The mapping of memory addresses between the host computer on one side,
and PMAC’s address space on the other side, is quite simple. Using this
memory is a matter of matching the addresses on both sides. To PMAC,
DPRAM simply appears as extra memory in the range $D000 to $DFFF, which
can be thought of as 4K of double (48-bit) words or 8K of single
(24-bit) words, in both X and Y memory (remember, X and Y memory in PMAC
are 24-bit locations.).</p>
<p>PMAC provides many facilities for using the dual-ported RAM (DPRAM) to
pass information back and forth between the host computer and PMAC.
These facilities are comprised of the following functions:</p>
<ul class="simple">
<li>DPRAM Control Panel Function (Host to PMAC) DP-Ram Range $D000- $D008</li>
<li>DPRAM Servo Data Reporting Function (PMAC to Host) DP-Ram Range $D009-</li>
</ul>
<p>$D089</p>
<ul class="simple">
<li>DPRAM Background Fixed Data Reporting Function (PMAC to Host) DP-Ram</li>
</ul>
<p>Range $D08A- $D18A</p>
<ul class="simple">
<li>DPRAM Background Variable Data Reporting Function (PMAC to Host)</li>
</ul>
<p>DP-Ram Range $D200-$DFFF</p>
<ul class="simple">
<li>DPRAM ASCII Communications Buffer (Bi-directional) DP-Ram Range</li>
</ul>
<p>$D200-$DFFF</p>
<ul class="simple">
<li>DPRAM Binary Rotary Program Buffer (Host to PMAC) DP-Ram Range</li>
</ul>
<p>$D200-$DFFF</p>
<ul class="simple">
<li>DPRAM Data Gathering Buffer (PMAC to Host – already existing) DP-Ram</li>
</ul>
<p>Range $D200-$DFFF</p>
<ul class="simple">
<li>DPRAM &lt;CONTROL-W&gt; ASCII Command Function (Host to PMAC – superseded</li>
</ul>
<p>by DPRAM</p>
<p>ASCII Communications)</p>
<p>In addition to these automatic functions, the user is free to access
otherwise unused registers in the DPRAM through the use of M-variables
on the PMAC side, and through pointer variables on the host side, for
sending data either way between the host and PMAC.</p>
<div class="section" id="servo-data-reporting-scan-thread">
<h5>2.13.5.2.1 Servo Data Reporting Scan Thread<a class="headerlink" href="#servo-data-reporting-scan-thread" title="Permalink to this headline">¶</a></h5>
<p>PMAC can provide key motor servo data to the DPRAM where it can be
accessed easily and quickly by the host computer. PMAC copies data from
key motor registers into fixed registers in the DPRAM. The copying is
attempted every I19 servo cycles, and is done for motors 1 through <em>n</em>,
where <em>n</em> is determined by variable I59. Setting I48 to 1 and issuing
the GATHER command enables this feature.</p>
<p>The Servo Fixed Data Area of Dual Port Ram is scanned for data every 100
ms with a priority of 45.</p>
</div>
<div class="section" id="background-fixed-data-reporting-scan-thread">
<h5>2.13.5.2.2 Background Fixed Data Reporting Scan Thread<a class="headerlink" href="#background-fixed-data-reporting-scan-thread" title="Permalink to this headline">¶</a></h5>
<p>PMAC can provide information of interest of the host computer through
the DPRAM as a background task. This feature is enabled if I49=1. If
this feature is enabled, each time PMAC executes its housekeeping tasks
in background, which it does between each scan of each PLC program, it
will update the buffer in DPRAM if the host has read the previous
contents of the buffer. The information in this buffer is data in PMAC
that is updated less often than once per servo cycle.</p>
<p>The Backgroung Fixed Data Area of Dual Port Ram is scanned for data
every 50 ms with a priority of 44.</p>
</div>
<div class="section" id="background-variable-data-reporting-scan-thread">
<h5>2.13.5.2.3 Background Variable Data Reporting Scan Thread<a class="headerlink" href="#background-variable-data-reporting-scan-thread" title="Permalink to this headline">¶</a></h5>
<p>The Background Variable Data Read Buffer allows the user to have up to
128 user-specified PMAC</p>
<p>registers copied into DPRAM during the background cycle. This function
is controlled by I55. The buffer</p>
<p>has two modes of operation, single user and multi-user. The default mode
is the single user mode. It is</p>
<p>active when bit 8 of the control word (Y:$D1FA) is set to zero.
Multi-user mode is active when bit 8 of</p>
<p>the control word (Y:$D1FA) is set to one.</p>
<p>The Background Variable Data Area of Dual Port Ram is scanned for data
every 50 ms with a priority of 44.</p>
</div>
<div class="section" id="open-area-of-dual-ported-ram-scan-thread">
<h5>2.13.5.2.4 Open Area of Dual Ported Ram Scan Thread<a class="headerlink" href="#open-area-of-dual-ported-ram-scan-thread" title="Permalink to this headline">¶</a></h5>
<p>The open area for dual port ram is in the range $DF00 through $DFFF. The
Open Area of Dual Port Ram is scanned for data every 25 ms with a
priority of 43. An EPICS input record with DTYP=PMAC-VME DPRAM whose
hardware input specifies a DPRAM address in the Open Area utilizes this
thread for I/O Interrupt scanning. This thread can be tested by
verifying proper operation of such a record with SCAN=I/O Intr.</p>
</div>
</div>
<div class="section" id="file-download-thread">
<h4>2.13.5.3 File Download Thread<a class="headerlink" href="#file-download-thread" title="Permalink to this headline">¶</a></h4>
<p>This is used for the EPICS Load record to download new files to the
PMAC. The File I/O is managed with a semaphore and queue. This
functionality is currently unused at Gemini.</p>
</div>
<div class="section" id="dpram-gather-reader-write-threads">
<h4>2.13.5.4 DPRAM Gather Reader/Write Threads<a class="headerlink" href="#dpram-gather-reader-write-threads" title="Permalink to this headline">¶</a></h4>
<p>PMAC’s data gathering function can create a rotary buffer in DPRAM, so
that the host computer can pick up the data as it is being gathered.
This function was implemented before V1.14, and is described in the
User’s Manual for PMAC. The data-gathering buffer in DPRAM must start at
address $D200. The Data Gathering functions are currently unused at
Gemini</p>
<p>The Gather Read and Write tasks are synchronized with semaphores
scanGatReadSem and scanGetWriteSem. The read task controls the master
process calling epicsThreadSleep() every 20 ms.</p>
</div>
</div>
<div class="section" id="specific-requirements-8">
<span id="id18"></span><h3>2.13.6 Specific Requirements<a class="headerlink" href="#specific-requirements-8" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-113-01-initialize">
<h4>2.13.6.1 REQ-113-01 Initialize<a class="headerlink" href="#req-113-01-initialize" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of executing the
<a class="reference external" href="#nxjktyxxeqn4">drvPmac_init()</a> routine without error by calling</p>
<p>iocInit().</p>
</div>
<div class="section" id="req-113-02-epics-report">
<h4>2.13.6.2 REQ-113-02 EPICS Report<a class="headerlink" href="#req-113-02-epics-report" title="Permalink to this headline">¶</a></h4>
<p>The EPICS routine dbior drvPmac &lt;interest_level&gt; shall display the state
of all data channels respective for each initialized card. See
<a class="reference external" href="#hwpksar39c5t">drvPmac_report()</a>.</p>
</div>
<div class="section" id="req-113-03-analog-input-record-support-for-pmac-vme-ascii">
<h4>2.13.6.3 REQ-113-03 Analog Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-03-analog-input-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS analog input record with its DTYP field set to PMAC-VME ASCII.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-04-analog-output-record-support-for-pmac-vme-ascii">
<h4>2.13.6.4 REQ-113-04 Analog Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-04-analog-output-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS analog output record with its DTYP field set to PMAC-VME ASCII.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-05-binary-input-record-support-for-pmac-vme-ascii">
<h4>2.13.6.5 REQ-113-05 Binary Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-05-binary-input-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS binary input record with its DTYP field set to PMAC-VME ASCII.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-06-binary-output-record-support-for-pmac-vme-ascii">
<h4>2.13.6.6 REQ-113-06 Binary Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-06-binary-output-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS binary output record with its DTYP field set to PMAC-VME ASCII.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-07-long-input-record-support-for-pmac-vme-ascii">
<h4>2.13.6.7 REQ-113-07 Long Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-07-long-input-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS long input record with its DTYP field set to PMAC-VME ASCII.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-08-long-output-record-support-for-pmac-vme-ascii">
<h4>2.13.6.8 REQ-113-08 Long Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-08-long-output-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS long output record with its DTYP field set to PMAC-VME ASCII.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-09-multibit-binary-input-record-support-for-pmac-vme-ascii">
<h4>2.13.6.9 REQ-113-09 Multibit Binary Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-09-multibit-binary-input-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS mbbi record with its DTYP field set to PMAC-VME ASCII. This is
not used at Gemini.</p>
</div>
<div class="section" id="req-113-10-multibit-binary-output-record-support-for-pmac-vme-ascii">
<h4>2.13.6.10 REQ-113-10 Multibit Binary Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-10-multibit-binary-output-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS mbbo record with its DTYP field set to PMAC-VME ASCII. This is
not used at Gemini.</p>
</div>
<div class="section" id="req-113-11-string-input-record-support-for-pmac-vme-ascii">
<h4>2.13.6.11 REQ-113-11 String Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-11-string-input-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS string input record with its DTYP field set to PMAC-VME ASCII.</p>
</div>
<div class="section" id="req-113-12-string-output-record-support-for-pmac-vme-ascii">
<h4>2.13.6.12 REQ-113-12 String Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-12-string-output-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS string output record with its DTYP field set to PMAC-VME ASCII.</p>
</div>
<div class="section" id="req-113-13-load-record-support-for-pmac-vme-ascii">
<h4>2.13.6.13 REQ-113-13 Load Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-13-load-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS load record with its DTYP field set to PMAC-VME ASCII. This is
currently not in use at Gemini.</p>
</div>
<div class="section" id="req-113-14-status-record-support-for-pmac-vme-ascii">
<h4>2.13.6.14 REQ-113-14 Status Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-14-status-record-support-for-pmac-vme-ascii" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS status record with its DTYP field set to PMAC-VME ASCII. This
is not used at Gemini.</p>
</div>
<div class="section" id="req-113-15-analog-input-record-support-for-pmac-vme-dpram">
<h4>2.13.6.15 REQ-113-15 Analog Input Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-15-analog-input-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS analog input record with its DTYP field set to PMAC-VME DPRAM.</p>
</div>
<div class="section" id="req-113-16-analog-output-record-support-for-pmac-vme-dpram">
<h4>2.13.6.16 REQ-113-16 Analog Output Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-16-analog-output-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS analog output record with its DTYP field set to PMAC-VME DPRAM.</p>
</div>
<div class="section" id="req-113-17-binary-input-record-support-for-pmac-vme-dpram">
<h4>2.13.6.17 REQ-113-17 Binary Input Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-17-binary-input-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS binary input record with its DTYP field set to PMAC-VME DPRAM.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-18-binary-output-record-support-for-pmac-vme-dpram">
<h4>2.13.6.18 REQ-113-18 Binary Output Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-18-binary-output-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS binary output record with its DTYP field set to PMAC-VME DPRAM.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-19-event-record-support-for-pmac-vme-dpram">
<h4>2.13.6.19 REQ-113-19 Event Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-19-event-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS event record with its DTYP field set to PMAC-VME DPRAM. This is
not used at Gemini.</p>
</div>
<div class="section" id="req-113-20-long-input-record-support-for-pmac-vme-dpram">
<h4>2.13.6.20 REQ-113-20 Long Input Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-20-long-input-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS long input record with its DTYP field set to PMAC-VME DPRAM.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-21-long-output-record-support-for-pmac-vme-dpram">
<h4>2.13.6.21 REQ-113-21 Long Output Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-21-long-output-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS long output record with its DTYP field set to PMAC-VME DPRAM.
This is not used at Gemini.</p>
</div>
<div class="section" id="req-113-22-multibit-binary-input-record-support-for-pmac-vme-dpram">
<h4>2.13.6.22 REQ-113-22 Multibit Binary Input Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-22-multibit-binary-input-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS mbbi record with its DTYP field set to PMAC-VME DPRAM. This is
not used at Gemini.</p>
</div>
<div class="section" id="req-113-23-multibit-binary-output-record-support-for-pmac-vme-dpram">
<h4>2.13.6.23 REQ-113-23 Multibit Binary Output Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-23-multibit-binary-output-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS mbbo record with its DTYP field set to PMAC-VME DPRAM. This is
not used at Gemini.</p>
</div>
<div class="section" id="req-113-24-status-record-support-for-pmac-vme-dpram">
<h4>2.13.6.24 REQ-113-24 Status Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-24-status-record-support-for-pmac-vme-dpram" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of initializing and processing
an EPICS status record with its DTYP field set to PMAC-VME DPRAM.</p>
</div>
<div class="section" id="req-113-25-two-card-support">
<h4>2.13.6.25 REQ-113-25 Two Card Support<a class="headerlink" href="#req-113-25-two-card-support" title="Permalink to this headline">¶</a></h4>
<p>The PMAC support library shall be capable of configuring and
initializing two VME PMAC boards. All scan tasks shall be running and
not suspended after iocInit() completes. Each PMAC task running shall
have the respective card number appended to the name of the task.</p>
</div>
<div class="section" id="req-113-26-continuous-data-stream-one-card">
<h4>2.13.6.26 REQ-113-26 Continuous Data Stream One card<a class="headerlink" href="#req-113-26-continuous-data-stream-one-card" title="Permalink to this headline">¶</a></h4>
<p>A continuous sequence of floating point numbers shall be capable of
passing from EPICS records into dual ported memory filling a PMAC
internal ring buffer. (This needs more definition – what function of
the driver implements this?)</p>
</div>
<div class="section" id="req-113-27-two-continuous-data-streams-two-cards">
<h4>2.13.6.27 REQ-113-27 Two Continuous Data Streams Two cards<a class="headerlink" href="#req-113-27-two-continuous-data-streams-two-cards" title="Permalink to this headline">¶</a></h4>
<p>Two continuous sequences of floating point numbers shall be capable of
passing from two EPICS records into dual ported memory filling a PMAC
internal ring buffer on two different PMAC boards on the same VME crate.</p>
</div>
<div class="section" id="req-113-28-servo-fixed-data-thread">
<h4>2.13.6.28 REQ-113-28 Servo Fixed Data Thread<a class="headerlink" href="#req-113-28-servo-fixed-data-thread" title="Permalink to this headline">¶</a></h4>
<p>Data values deposited into the Servo Fixed Data area of DPRAM shall be
processed without error.</p>
</div>
<div class="section" id="req-113-29-background-fixed-data-thread">
<h4>2.13.6.29 REQ-113-29 Background Fixed Data Thread<a class="headerlink" href="#req-113-29-background-fixed-data-thread" title="Permalink to this headline">¶</a></h4>
<p>Data values deposited into the Background Fixed Data area of DPRAM shall
be processed without error.</p>
</div>
<div class="section" id="req-113-30-background-variable-data-thread">
<h4>2.13.6.30 REQ-113-30 Background Variable Data Thread<a class="headerlink" href="#req-113-30-background-variable-data-thread" title="Permalink to this headline">¶</a></h4>
<p>Data values deposited into the Background Variable Data area of DPRAM
shall be processed without error.</p>
</div>
<div class="section" id="req-113-31-open-variable-data-thread">
<h4>2.13.6.31 REQ-113-31 Open Variable Data Thread<a class="headerlink" href="#req-113-31-open-variable-data-thread" title="Permalink to this headline">¶</a></h4>
<p>Data values deposited into the Open area of DPRAM shall be processed
without error.</p>
</div>
<div class="section" id="req-113-32-file-download-thread">
<h4>2.13.6.32 REQ-113-32 File Download Thread<a class="headerlink" href="#req-113-32-file-download-thread" title="Permalink to this headline">¶</a></h4>
<p>File download data shall be capable of being downloaded to the PMAC
without error. This is currently not in use at Gemini.</p>
</div>
<div class="section" id="req-113-33-gather-data-read-write-threads">
<h4>2.13.6.33 REQ-113-33 Gather Data Read/Write Threads<a class="headerlink" href="#req-113-33-gather-data-read-write-threads" title="Permalink to this headline">¶</a></h4>
<p>The Data Gathering buffer thread shall be processed without error. This
is currently not in use at Gemini.</p>
</div>
</div>
</div>
<div class="section" id="oms-vme44">
<h2>2.14 OMS VME44<a class="headerlink" href="#oms-vme44" title="Permalink to this headline">¶</a></h2>
<p>The VME44 intelligent motor controller can manage 4 axes of motion and
monitor each associated incremental encoder in one slot of a VME bus
computer. It meets the VME C.1 specification for D08(0) slaves and can
be plugged directly into the backplane of these machines. It can manage
coordinated or independent motion of each of the four axes
simultaneously. The controller can also generate constant velocity
profiles with circular interpolation for cutting and machining type
operation.</p>
<p>The VME44 utilizes 68000 microprocessor to control direction of motion,
acceleration, deceleration and velocity of an associated motor. In
response to command from the host computer, the VME44 controller will
calculate the optimum velocity profile to reach the desired destination
in the minimum time while conforming to the programmed velocity and
acceleration parameters.</p>
<p>Commands may be sent to the VME44 by simple I/O commands using virtually
any language on the host VME computer. These controller are easily
programmed with ASCII character string. For a typical motion
requirements of 1,000,000 pulses at 400,000 pulses/sec and an
acceleration of 500,000 pulses /sec2 the following string would be input
from the host computer to the VME44:</p>
<p>VL400000 AC500000 MR1000000 GO</p>
<div class="section" id="database-definition-file-oms44dev-dbd">
<h3>2.14.1 Database Definition File (oms44Dev.dbd)<a class="headerlink" href="#database-definition-file-oms44dev-dbd" title="Permalink to this headline">¶</a></h3>
<p>device(oms44,VME_IO,devOMS44,”OMS 8/44”)</p>
</div>
<div class="section" id="device-support-requirements-4">
<span id="id19"></span><h3>2.14.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements-4" title="Permalink to this headline">¶</a></h3>
<p>The following device support routines are required for the OMS44 motor
controller:</p>
<ol class="arabic simple">
<li>configureDrive: Set motor velocity, acceleration and base velocity</li>
<li>controlMotion: Start, stop or abort a motion</li>
<li>controlPower: Enable or disable the motor power.</li>
<li>devInit: Initialize the device control record support module</li>
<li>devInitRec: Initialize an instance of deviceControl record support</li>
<li>omsScanTask: Monitor device motion</li>
<li>setDelay: Re-process the calling record after a given interval</li>
<li>setPosition: Load the motor position counter with given value</li>
</ol>
</div>
<div class="section" id="driver-support-requirements-4">
<span id="id20"></span><h3>2.14.3 Driver Support Requirements<a class="headerlink" href="#driver-support-requirements-4" title="Permalink to this headline">¶</a></h3>
<p>The following driver functions are the key tasks running on a loaded
OMS44 driver and represent all aspects of the required functionality at
Gemini.</p>
<p>long drvOmsVmeMotorPosition(int card, int axis, long *position, long
*encoder);</p>
<p>long drvOmsVmeMotorState (int card, int axis, int *lowLimit, int
*highLimit,</p>
<blockquote>
<div>int *homeSwitch, int *axisDone);</div></blockquote>
<p>int drvOmsVmeGetCardType (int card);</p>
<p>void drvOmsVmeGetErrorMessage (char *message);</p>
<p>long drvOmsVmeInit();</p>
<p>long drvOmsVmeReadCard (int card, char *buffer, int timeout);</p>
<p>long drvOmsVmeWriteCard (int card, char *buffer);</p>
<p>long drvOmsVmeWriteMotor (int card, int axis, char *buffer);</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="13%" />
<col width="32%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Usedby</th>
<th class="head">Meaning</th>
<th class="head">Returns</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>drvO
msVmeMotorPosition</td>
<td>&#160;</td>
<td><p class="first">Request current
encoder and
position from a
given axes.</p>
<p>Parameters:</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>card: card</dt>
<dd>number to be
queried</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>axis: axis</dt>
<dd>number to be
queried</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>position:</dt>
<dd>current step
position</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>counter:</dt>
<dd>current
encoder
value</dd>
</dl>
</li>
</ul>
</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>d
rvOmsVmeMotorState</td>
<td>&#160;</td>
<td><p class="first">Request current
switch status for
a given axes.</p>
<p>Parameters:</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>card: card to</dt>
<dd>query</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>axis: axis to</dt>
<dd>query</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>lowLimit: state</dt>
<dd>of low limit
switch</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>highLimit:</dt>
<dd>state of
high limit
switch</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>homeSwitch:</dt>
<dd>state of
home switch</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>axisDone: state</dt>
<dd>of axis done
bit</dd>
</dl>
</li>
</ul>
</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>dr
vOmsVmeGetCardType</td>
<td>&#160;</td>
<td><p class="first">Return the OMS
card type.</p>
<p>Parameter:</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>card: card to</dt>
<dd>query</dd>
</dl>
</li>
</ul>
</td>
<td>OK, card type</td>
</tr>
<tr class="row-odd"><td>drvOms
VmeGetErrorMessage</td>
<td>&#160;</td>
<td><p class="first">Recover current
error message.</p>
<p>Parameter:</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>Message: error</dt>
<dd>message</dd>
</dl>
</li>
</ul>
</td>
<td>OK</td>
</tr>
<tr class="row-even"><td>drvOmsVmeInit</td>
<td>&#160;</td>
<td>Locate and
initialize all OMS
Vme boards</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>drvOmsVmeReadCard</td>
<td>&#160;</td>
<td><p class="first">Recover data read
from an OMS VME
card.</p>
<p>Parameters:</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>card: card to</dt>
<dd>read from</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Buffer: string</dt>
<dd>returned by
card</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Timeout:</dt>
<dd>maximum time
to wait for
response
(sys ticks)</dd>
</dl>
</li>
</ul>
</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>drvOmsVmeWriteCard</td>
<td>&#160;</td>
<td><p class="first">Write a message to
an OMS VME card.</p>
<p>Parameters:</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>card: card to</dt>
<dd>read from</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Buffer: string</dt>
<dd>returned by
card</dd>
</dl>
</li>
</ul>
</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>d
rvOmsVmeWriteMotor</td>
<td>&#160;</td>
<td><p class="first">Write a message to
a specific OMS VME
axis.</p>
<p>Parameters:</p>
<ul class="last simple">
<li><dl class="first docutils">
<dt>card: card</dt>
<dd>number to
write to</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>axis: axis on</dt>
<dd>the card to
get the
message</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Buffer: message</dt>
<dd>to be sent
to axis</dd>
</dl>
</li>
</ul>
</td>
<td>OK, ERROR</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="vme-interrupts-request-vector-and-handlers-1">
<span id="id21"></span><h3>2.14.4 VME Interrupts Request Vector and Handlers<a class="headerlink" href="#vme-interrupts-request-vector-and-handlers-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="21%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Vector base from
drvOmsVmeInit()</th>
<th class="head">Handler</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>DRV_OMS_VME_VECTOR</td>
<td>drvOmsVmeIsr</td>
<td>ISR for OMS VME motion
control cards</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="oms44-data-scan-threads">
<h3>2.14.5 OMS44 Data Scan Threads<a class="headerlink" href="#oms44-data-scan-threads" title="Permalink to this headline">¶</a></h3>
<p>The OMS44 driver has dedicated thread (omsScanTask). It runs through the
list of motors that have deviceControl records controlling them and
manages their operation</p>
</div>
<div class="section" id="specific-requirements-9">
<span id="id22"></span><h3>2.14.6 Specific Requirements<a class="headerlink" href="#specific-requirements-9" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-114-01-initialize">
<h4>2.14.6.1 REQ-114-01 Initialize<a class="headerlink" href="#req-114-01-initialize" title="Permalink to this headline">¶</a></h4>
<p>The OMS44 support library shall be capable of executing the
drvOmsVmeInit() routine without error by calling iocInit().</p>
</div>
<div class="section" id="req-114-02-oms44-motor-record-support">
<h4>2.14.6.2 REQ-114-02 OMS44 Motor Record Support<a class="headerlink" href="#req-114-02-oms44-motor-record-support" title="Permalink to this headline">¶</a></h4>
<p>The OMS44 support library shall be capable of initializing and
processing an EPICS Motor record with its DTYP “OMS 8/44”.</p>
</div>
</div>
</div>
<div class="section" id="can-bus">
<h2>2.15 CAN Bus<a class="headerlink" href="#can-bus" title="Permalink to this headline">¶</a></h2>
<p>This section describes the software interface to the TEWS TIP810
Industry-Pack Module for EPICS. This software is an IPAC Module Driver
and uses the services of the drvIpac Industry Pack Driver to interface
to the IPAC Carrier Board.</p>
<p>The software provides an interface to higher level software which, other
than device initialisation, is not specific to the TIP810 but could be
used with a CANbus driver for a different hardware interface. The
interface to the higher level software is provided in two header files:
<em>canBus.h</em> contains all of the generic CANbus definitions and
declarations, while <em>drvTip810.h</em> incorporates the additional
declarations and definitions which are specific to the TIP810 module.
The routines which are specific to the TIP810 or meant for use from the
RTEMS shell are described individually in this section, also the generic
CANbus interface routines are described below.</p>
<p>The TEWS TIP810 IP module contains a Philips pca82c200 stand-alone
CAN-controller chip which performs all of the CANbus interfacing
functions. The interface to this chip is defined in a separate header
file <em>pca82c200.h</em> which declares the register interface structure and
the bit-patterns for the various on-chip registers.</p>
<p>The CAN-controller chip does not contain the necessary interrupt vector
logic required by the IndustryPack interface however, so the TIP810
module implements this in additional logic, including a register to hold
the vector number to be used.</p>
<p>.</p>
<div class="section" id="database-definition-file-devtip810-dbd">
<h3>2.15.1 Database Definition File (devTip810.dbd)<a class="headerlink" href="#database-definition-file-devtip810-dbd" title="Permalink to this headline">¶</a></h3>
<p>device(ai,INST_IO,devAiCan,”CANbus”)</p>
<p>device(ao,INST_IO,devAoCan,”CANbus”)</p>
<p>device(bi,INST_IO,devBiCan,”CANbus”)</p>
<p>device(bo,INST_IO,devBoCan,”CANbus”)</p>
<p>device(mbbi,INST_IO,devMbbiCan,”CANbus”)</p>
<p>device(mbbo,INST_IO,devMbboCan,”CANbus”)</p>
<p>devTip810.dbd:device(bi,INST_IO,devBiTip810,”Tip810”)</p>
<p>device(stringin, INST_IO,devSiWiener,”CANbus”)</p>
<p>device(mbbiDirect,INST_IO,devMbbiDirectCan,”CANbus”)</p>
<p>device(mbboDirect,INST_IO,devMbboDirectCan,”CANbus”)</p>
</div>
<div class="section" id="device-support-requirements-5">
<span id="id23"></span><h3>2.15.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements-5" title="Permalink to this headline">¶</a></h3>
<p>These are the device support provided with the TEWS TIP810 Industry-Pack
CANbus driver under EPICS.</p>
<p>Device Support routines have been provided for the following record
types:</p>
<ul class="simple">
<li>Analogue Records (ai, ao)</li>
<li>Binary Records (bi, bo)</li>
<li>Multi-Bit Binary Records (mbbi, mbbo)</li>
<li>Multi-Bit Binary Direct Records (mbbiDirect, mbboDirect)</li>
</ul>
<p>The device support behaviour for these record types is substantially the
same.</p>
<p>Also available is the ability to check the status of the Tip810 CANbus
interface, using:</p>
<ul class="simple">
<li>Binary Input Records to access the TIP810 module status (bi)</li>
</ul>
<p>The support for this record type is significantly different to the
others</p>
<ol class="arabic simple">
<li>devAiCan – Provide Analog Input support for the CANbus access.</li>
<li>devAoCan – Provide Analog Output support for the CANbus access.</li>
<li>devBiCan – Provide Binary Input support for the CANbus access.</li>
<li>devBoCan – Provide Binary Output support for the CANbus access.</li>
<li><dl class="first docutils">
<dt>devMbbiCan – Provide Multi Bits Binary Input support for the CANbus</dt>
<dd>access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devMbboCan – Provide Multi Bits Binary Output support for the</dt>
<dd>CANbus access.</dd>
</dl>
</li>
<li>devSiWiener – Provide String Input support for the CANbus access.</li>
<li><dl class="first docutils">
<dt>devMbbiDirectCan – Provide Multi Bits Binary Input Direct support</dt>
<dd>for the CANbus access.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>devMbboDirectCan – Provide Multi Bits Binary Output Direct support</dt>
<dd>for the CANbus access.</dd>
</dl>
</li>
<li>devBiTip810 – Provide Binary Input support for the Tip810 access.</li>
</ol>
</div>
<div class="section" id="driver-support-requirements-5">
<span id="id24"></span><h3>2.15.3 Driver Support Requirements<a class="headerlink" href="#driver-support-requirements-5" title="Permalink to this headline">¶</a></h3>
<p>This section describes the software interface to the TEWS TIP810
Industry-Pack Module for EPICS. This software is an IPAC Module Driver
and uses the services of the drvIpac Industry Pack Driver to interface
to the IPAC Carrier Board.</p>
<p>The following routines provided by this driver are described in detail
below:</p>
<p>epicsShareFunc int t810Create(char *busName, int card, int slot, int
irqNum, int busRate);</p>
<p>epicsShareFunc void t810Shutdown(void *dummy);</p>
<p>epicsShareFunc int t810Initialise(void);</p>
<p>epicsShareFunc int t810Report(int page);</p>
<p>epicsShareFunc int t810Status(canBusID_t busID);</p>
<p>int canTest (char *pbusName, canID_t identifier, int rtr, int length,
char *data);</p>
<p>int canOpen (char *busName, canBusID_t *pbusID);</p>
<p>int canIoParse (char *canString, canIo_t *pcanIo);</p>
<p>int canWrite (canBusID_t busID, const canMessage_t *pmessage, int
timeout);</p>
<p>int canMessage (canBusID_t busID, canID_t identifier, canMsgCallback_t
*pcallback, void *pprivate);</p>
<p>int canMsgDelete (canBusID_t busID, canID_t identifier, canMsgCallback_t
*pcallback, void *pprivate);</p>
<p>int canSignal (canBusID_t busID, canSigCallback_t *pcallback, void
*pprivate);</p>
<p>int canBusReset (char *busName);</p>
<p>int canBusStop (char *busName);</p>
<p>int canBusReset (char *busName);</p>
<p>int canRead (canBusID_t busID, canMessage_t *pmessage, double timeout);</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="27%" />
<col width="27%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Usedby</strong></th>
<th class="head"><strong>Meaning</strong></th>
<th class="head"><strong>Returns</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>t810Create</td>
<td>IOC Shell
Startup</td>
<td><p class="first">Configure VME
for IPAC with:</p>
<ul class="last">
<li><dl class="first docutils">
<dt>pbusName:</dt>
<dd><p class="first last">unique
CAN Bus
Id</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>card: IPAC</dt>
<dd><p class="first last">driver
carrier</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>slot: IPAC</dt>
<dd><p class="first last">driver
slot</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>irqNum:</dt>
<dd><p class="first last">Interrupt
vector
number</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>busRate: CAN</dt>
<dd><blockquote class="first">
<div><p>bus rate</p>
</div></blockquote>
<p class="last">Kbits/sec.</p>
</dd>
</dl>
</li>
</ul>
</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>t810Shutdown</td>
<td>&#160;</td>
<td>Shutdown
routine, resets
all devices to
stop
interrupts.</td>
<td>void</td>
</tr>
<tr class="row-even"><td>t810Initialise</td>
<td>&#160;</td>
<td>Initialise
driver and all
registered
hardware.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>t810Report</td>
<td>IOC Shell</td>
<td>Register
function with
EPICS dbior().
Report shows
the state of
all initialized
IPAC boards and
their
configuration.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>t810Status</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>canTest</td>
<td>IOC Shell</td>
<td>Test routine,
sends a single
test message to
the named
CANbus.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>canOpen</td>
<td>&#160;</td>
<td>Return device
pointer for
given CAN bus
name.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>canIoParse</td>
<td>&#160;</td>
<td>Parse a CAN
address string
into a canIo_t
structure</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>canWrite</td>
<td>&#160;</td>
<td>Writes a
message to the
given CANbus</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>canMessage</td>
<td>&#160;</td>
<td>Register CAN
message
call-back</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>canMsgDelete</td>
<td>&#160;</td>
<td>Delete CAN
message
call-back</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>canSignal</td>
<td>&#160;</td>
<td>Register CAN
error signal
call-back</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>canBusReset</td>
<td>IOC Shell</td>
<td>Reset CAN chip
and message and
error counters.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>canBusStop</td>
<td>IOC Shell</td>
<td>Stop CAN
interface.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-even"><td>canBusRestart</td>
<td>IOC Shell</td>
<td>Restart a
stopped CAN
interface.</td>
<td>OK, ERROR</td>
</tr>
<tr class="row-odd"><td>canRead</td>
<td>&#160;</td>
<td>Send Remote
Transmission
Request and
wait for reply.</td>
<td>OK, ERROR</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="vme-interrupts-request-vector-and-handlers-2">
<span id="id25"></span><h3>2.15.4 VME Interrupts Request Vector and Handlers<a class="headerlink" href="#vme-interrupts-request-vector-and-handlers-2" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="12%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Vector base from t810Create()</th>
<th class="head">Handler</th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>baseIrqVector=50</td>
<td>t810ISR</td>
<td>ISR for CAN bus receipt acknowledge</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="specific-requirements-10">
<span id="id26"></span><h3>2.15.5 Specific Requirements<a class="headerlink" href="#specific-requirements-10" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-115-01-initialize">
<h4>2.15.5.1 REQ-115-01 Initialize<a class="headerlink" href="#req-115-01-initialize" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of executing the t810Create
routine without error by calling</p>
<p>iocInit().</p>
</div>
<div class="section" id="req-115-02-epics-report">
<h4>2.15.5.2 REQ-115-02 EPICS Report<a class="headerlink" href="#req-115-02-epics-report" title="Permalink to this headline">¶</a></h4>
<p>The EPICS routine dbior t810Report &lt;interest_level&gt; shall display the
state of all data channels respective for each initialized card.</p>
</div>
<div class="section" id="req-115-03-analog-input-record-support-for-canbus">
<h4>2.15.5.3 REQ-115-03 Analog Input Record Support for CANbus<a class="headerlink" href="#req-115-03-analog-input-record-support-for-canbus" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS analog input record with its DTYP field set to
CANbus.</p>
</div>
<div class="section" id="req-115-04-analog-output-record-support-for-canbus">
<h4>2.15.5.4 REQ-115-04 Analog Output Record Support for CANbus<a class="headerlink" href="#req-115-04-analog-output-record-support-for-canbus" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS analog output record with its DTYP field set to
CANbus.</p>
</div>
<div class="section" id="req-115-05-binary-input-record-support-for-canbus">
<h4>2.15.5.5 REQ-115-05 Binary Input Record Support for CANbus<a class="headerlink" href="#req-115-05-binary-input-record-support-for-canbus" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS binary input record with its DTYP field set to
CANbus.</p>
</div>
<div class="section" id="req-115-06-binary-output-record-support-for-canbus">
<h4>2.15.5.6 REQ-115-06 Binary Output Record Support for CANbus<a class="headerlink" href="#req-115-06-binary-output-record-support-for-canbus" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS binary output record with its DTYP field set to
CANbus.</p>
</div>
<div class="section" id="req-115-07-multibit-binary-input-record-support-for-canbus">
<h4>2.15.5.7 REQ-115-07 Multibit Binary Input Record Support for CANbus<a class="headerlink" href="#req-115-07-multibit-binary-input-record-support-for-canbus" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS mbbi record with its DTYP field set to CANbus.</p>
</div>
<div class="section" id="req-115-08-multibit-binary-output-record-support-for-canbus">
<h4>2.15.5.8 REQ-115-08 Multibit Binary Output Record Support for CANbus<a class="headerlink" href="#req-115-08-multibit-binary-output-record-support-for-canbus" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS mbbo record with its DTYP field set to CANbus.</p>
</div>
<div class="section" id="req-115-09-multibit-binary-input-direct-record-support-for-canbus">
<h4>2.15.5.9 REQ-115-09 Multibit Binary Input Direct Record Support for CANbus<a class="headerlink" href="#req-115-09-multibit-binary-input-direct-record-support-for-canbus" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS mbbi direct record with its DTYP field set to
CANbus.</p>
</div>
<div class="section" id="req-115-10-multibit-binary-output-direct-record-support-for-canbus">
<h4>2.15.5.10 REQ-115-10 Multibit Binary Output Direct Record Support for CANbus<a class="headerlink" href="#req-115-10-multibit-binary-output-direct-record-support-for-canbus" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS mbbo direct record with its DTYP field set to
CANbus.</p>
</div>
<div class="section" id="req-115-11-binary-input-record-support-for-tip810">
<h4>2.15.5.11 REQ-115-11 Binary Input Record Support for Tip810<a class="headerlink" href="#req-115-11-binary-input-record-support-for-tip810" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of initializing and
processing an EPICS binary input record with its DTYP field set to
Tip810.</p>
</div>
<div class="section" id="req-115-12-two-card-support">
<h4>2.15.5.12 REQ-115-12 Two Card Support<a class="headerlink" href="#req-115-12-two-card-support" title="Permalink to this headline">¶</a></h4>
<p>The TIP810 support library shall be capable of configuring and
initializing two tip810 boards. All scan tasks shall be running and not
suspended after iocInit() completes. Each TIP810 task running shall have
the respective card number appended to the name of the task.</p>
</div>
</div>
</div>
<div class="section" id="drvserial">
<h2>2.16 drvSerial<a class="headerlink" href="#drvserial" title="Permalink to this headline">¶</a></h2>
<p>drvSerial is an EPICS driver that can be used to send and receive binary
data through a serial port. The notes on how it is used can be found
<a class="reference external" href="http://swg.wikis-internal.gemini.edu/index.php/DrvSerial_Notes">here</a>.</p>
<div class="section" id="database-definition-file-drvserial-dbd">
<h3>2.16.1 Database Definition File (drvSerial.dbd)<a class="headerlink" href="#database-definition-file-drvserial-dbd" title="Permalink to this headline">¶</a></h3>
<p>driver(drvSerial)</p>
</div>
<div class="section" id="device-support-requirements-6">
<span id="id27"></span><h3>2.16.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements-6" title="Permalink to this headline">¶</a></h3>
<p>No device support is provided by the drvSerial driver.</p>
</div>
<div class="section" id="driver-requirements">
<h3>2.16.3 Driver Requirements<a class="headerlink" href="#driver-requirements" title="Permalink to this headline">¶</a></h3>
<p>The EPICS driver support requires the following routines:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">long drvSerialInit (void);</p>
<p>long drvSerialCreateLink(const char *pName, drvSerialParseInput
*pParser, void *pAppPrivate,</p>
<p>drvSerialLinkId *pId);</p>
<p>long drvSerialAttachLink(const char *pName, drvSerialParseInput
*pParser, void **ppAppPrivate);</p>
<p>long drvSerialSendRequest(drvSerialLinkId id, drvSerialPriority pri,
const drvSerialRequest * pReq) ;</p>
<p>long drvSerialNextResponse(drvSerialLinkId id, drvSerialResponse *
pResponse);</p>
<p class="last">long drvSerialReport(int level);</p>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Usedby</th>
<th class="head">Meaning</th>
<th class="head">Returns</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>drvSerialInit</td>
<td>EPICS
iocInit()</td>
<td><ul class="first last">
<li><dl class="first docutils">
<dt>Create hash</dt>
<dd><blockquote class="first">
<div><p>table
for the
file
name
strings
and</p>
</div></blockquote>
<dl class="last docutils">
<dt>associated</dt>
<dd><p class="first last">MUTEX</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Create an</dt>
<dd><blockquote class="first">
<div><p>EPICS
“bucket”
for,</p>
</div></blockquote>
<p>integers,</p>
<dl class="last docutils">
<dt>pointers,</dt>
<dd><p class="first last">and
strings.</p>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</td>
<td><p class="first">S_drvSerial_OK</p>
<p class="last">S_db_noMemory</p>
</td>
</tr>
<tr class="row-odd"><td>drvSe
rialCreateLink</td>
<td>Device support</td>
<td><ul class="first last simple">
<li><dl class="first docutils">
<dt>Create and</dt>
<dd>open new
serial
link</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Spawn read</dt>
<dd>and
write
tasks</dd>
</dl>
</li>
</ul>
</td>
<td><p class="first">S_drvSerial_OK
S_dr
vSerial_noInit
S_drvS
erial_noParser</p>
<p>S_dr
vSerial_linkIn</p>
<p>S_dev_noMemory</p>
<p class="last">(-1)</p>
</td>
</tr>
<tr class="row-even"><td>drvSe
rialAttachLink</td>
<td>Device support</td>
<td>Attach to
already open
link</td>
<td>S_drvSerial_OK
S_drvS
erial_noParser
S_drvSe
rial_linkInUse
S_drvSeria
l_noneAttached</td>
</tr>
<tr class="row-odd"><td>drvSer
ialSendRequest</td>
<td>Device support</td>
<td>Send data</td>
<td><p class="first">S_drvSerial_OK
S_drvS
erial_linkDown
S_drvSer
ial_invalidArg
S_drvSe
rial_queueFull
S_dev_noMemory</p>
<p class="last">(-1)</p>
</td>
</tr>
<tr class="row-even"><td>drvSeri
alNextResponse</td>
<td>Device support</td>
<td>Receive data</td>
<td><p class="first">S_drvSerial_OK
S_drv
Serial_noEntry</p>
<p class="last">(-1)</p>
</td>
</tr>
<tr class="row-odd"><td>d
rvSerialReport</td>
<td>EPICS dbior()</td>
<td>Report to show
the active
serial queues.</td>
<td>S_drvSerial_OK</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="specific-requirements-11">
<span id="id28"></span><h3>2.16.4 Specific Requirements<a class="headerlink" href="#specific-requirements-11" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-116-01-drvserial-initialize">
<h4>2.16.4.1 REQ-116-01 drvSerial Initialize<a class="headerlink" href="#req-116-01-drvserial-initialize" title="Permalink to this headline">¶</a></h4>
<p>The drvSerial driver shall be capable of executing the drvSerianInit()
routine without error by calling iocInit().</p>
</div>
<div class="section" id="req-116-02-drvserial-attaching-to-an-existing-connection">
<h4>2.16.4.2 REQ-116-02 drvSerial Attaching to an Existing Connection<a class="headerlink" href="#req-116-02-drvserial-attaching-to-an-existing-connection" title="Permalink to this headline">¶</a></h4>
<p>The drvSerial driver shall be able to attach to an already open
connection to a serial port and return no errors. Attaching to a
non-existent connection should return an error.</p>
</div>
<div class="section" id="req-116-03-drvserial-opening-a-new-connection">
<h4>2.16.4.3 REQ-116-03 drvSerial Opening a New Connection<a class="headerlink" href="#req-116-03-drvserial-opening-a-new-connection" title="Permalink to this headline">¶</a></h4>
<p>The drvSerial driver shall be capable of connecting to an existing
serial port and return without errors. Connecting to a non-existent port
should return an error.</p>
</div>
<div class="section" id="req-116-04-drvserial-sending-a-message-request">
<h4>2.16.4.4 REQ-116-04 drvSerial Sending a Message (Request)<a class="headerlink" href="#req-116-04-drvserial-sending-a-message-request" title="Permalink to this headline">¶</a></h4>
<p>The drvSerial driver shall be able to send a message through an open
connection (new or attached) without errors. Sending a message to an
invalid connection shall return an error. The driver send routine shall
not block. Sending more than a 100 messages without other process
removing them from the queue shall return an error.</p>
</div>
<div class="section" id="req-116-05-drvserial-receiving-a-response">
<h4>2.16.4.5 REQ-116-05 drvSerial Receiving a Response<a class="headerlink" href="#req-116-05-drvserial-receiving-a-response" title="Permalink to this headline">¶</a></h4>
<p>The drvSerial driver should be able to receive a response from an open
connection without errors. Trying to receive a response from an invalid
connection should return an error. The driver receiving routine shall
return an error if there are no messages pending in the queue (shall not
block)</p>
</div>
<div class="section" id="req-116-06-drvserial-epics-report">
<h4>2.16.4.6 REQ-116-06 drvSerial EPICS Report<a class="headerlink" href="#req-116-06-drvserial-epics-report" title="Permalink to this headline">¶</a></h4>
<p>The EPICS routine dbior drvSerial( &lt;interest_level&gt;) shall display the
state of all open links. See drvSerialReport().</p>
</div>
</div>
</div>
<div class="section" id="abdf1">
<h2>2.17 AbDf1<a class="headerlink" href="#abdf1" title="Permalink to this headline">¶</a></h2>
<p>The Allen-Bradley PLC-5 Programmable Logic Controllers (PLC) provide a
proven approach for industrial control. PLC-5 processors are high-speed,
single-slot processors used for control and information processing. They
are designed for larger sequential and regulatory control applications
with specialized I/O requirements and/or the need to coordinate with
other processors and devices. Ladder logic, the PLC’s programming
language represents a program by a graphical diagram based on the
circuit diagrams of relay logic hardware. PLC-5 are programmed using a
Windows program called RSLogix5. The PLC communicates using an
asynchronous byte-oriented protocol that is used to communicate with
most Allen Bradley RS232 interface modules, called DF1. It works over
half duplex and full duplex modes of communication. The AbDf1 driver
implements the DF1 protocol and uses uses drvSerial to talk to serial
lines.</p>
<p>Note that the mbbi or mbbo records are supported in the code, but since
they are not used by in the ECS or GIS, they were not included in the
requirements. Also, the support for the ecsMotor record device support
was not included because the goal is to remove this record when the ECS
is ported to use the CCB..</p>
<div class="section" id="database-definition-file-abdf1-dbd">
<h3>2.17.1 Database Definition File (AbDf1.dbd)<a class="headerlink" href="#database-definition-file-abdf1-dbd" title="Permalink to this headline">¶</a></h3>
<p># Allen Bradley DF1 Device Support</p>
<p>device( ai, INST_IO, devAiAbDf1, “AB DF1 serial” )</p>
<p>device( ao, INST_IO, devAoAbDf1, “AB DF1 serial” )</p>
<p>device( bi, INST_IO, devBiAbDf1, “AB DF1 serial” )</p>
<p>device( bo, INST_IO, devBoAbDf1, “AB DF1 serial” )</p>
<p>device( mbbi, INST_IO, devMbbiAbDf1, “AB DF1 serial” )</p>
<p>device( mbbo, INST_IO, devMbboAbDf1, “AB DF1 serial” )</p>
<p># Variables that can be set from the IOC shell</p>
<p>variable(drvAbDf1SrcStationNumber, int)</p>
<p>variable(drvAbDf1DefaultScanPeriod_mS, double)</p>
<p>variable(drvAbDf1Debug, int)</p>
<p>variable(drvAbDf1MaxOutstandingRequest, int)</p>
<p># Allen Bradley Driver Support</p>
<p>driver(drvAbDf1)</p>
<p># register the IOC shell commands</p>
<p>registrar(drvAbDf1CommandsRegister)</p>
</div>
<div class="section" id="device-support-requirements-7">
<span id="id29"></span><h3>2.17.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements-7" title="Permalink to this headline">¶</a></h3>
<p>The following device support routines are required to communicate with
the PLC-5 using analog input, analog output, binary input, binary
output, multi bit binary input, and multi bit binary output records. We
use the generic support routines only:</p>
<ol class="arabic simple">
<li>devAiAbDf1 - Provide analog input support for the DF1 protocol</li>
<li>devAoAbDf1 - Provide analog output support for the DF1 protocol</li>
<li>devBiAbDf1 - Provide binary input support for the DF1 protocol</li>
<li>devBoAbDf1- Provide binary input support for the DF1 protocol</li>
</ol>
</div>
<div class="section" id="driver-support-requirements-6">
<span id="id30"></span><h3>2.17.3 Driver Support Requirements<a class="headerlink" href="#driver-support-requirements-6" title="Permalink to this headline">¶</a></h3>
<p>2.17.3.1 Functions</p>
<p>The following driver functions are called by the device support
routines. Only a subset of them provide aspects of functionality
required at Gemini.</p>
<p>abDf1ElemIO *drvAbDf1NewElemIO (void);</p>
<p>void drvAbDf1InitiateAll(void);</p>
<p>epicsInt32 drvAbDf1SetupIO (const struct link *pLink, abDf1ElemIO
*pDevIO, unsigned *pBitNo);</p>
<p>void drvAbDf1SetupScan (const int cmd, abDf1ElemIO *pElemIO);</p>
<p>epicsInt32 drvAbDf1InitiateWrite (abDf1ElemIO *pDevElemIO)</p>
<p>epicsInt32 drvAbDf1ReadWord (abDf1ElemIO *pDevElemIO, epicsUInt16
*pVal);</p>
<p>epicsInt32 drvAbDf1ReadBitString (abDf1ElemIO *pDevElemIO, epicsUInt16
mask, epicsUInt16 *pVal);</p>
<p>epicsInt32 drvAbDf1ReadReal (abDf1ElemIO *pDevElemIO, float *pVal);</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Usedby</th>
<th class="head">Meaning</th>
<th class="head">Returns</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>drv
AbDf1NewElemIO</td>
<td>Device support
record
i
nitialization.</td>
<td>Allocate and
clear an
element IO
structure.
Driver embeds
the element IO
structure
within a
larger driver
specific
structure.</td>
<td><p class="first">Structure
pointer</p>
<p class="last">NULL</p>
</td>
</tr>
<tr class="row-odd"><td>drvAb
Df1InitiateAll</td>
<td>Device support
i
nitialization.</td>
<td>Called after
all records
have been
initialized to
initiate
scanning on
all
links/cards.</td>
<td>void</td>
</tr>
<tr class="row-even"><td>d
rvAbDf1SetupIO</td>
<td>Device support
i
nitialization.</td>
<td>Called by the
device support
“Init Record”
routine to
parse the
hardware
address
information
and initialize
the element IO
structure.</td>
<td><p class="first">S_drvAbD
f1_badAddrType</p>
<p>S_drvAbDf1
_badNodeNumber</p>
<p>S_dr
vAbDf1_badFile</p>
<p>S_drvAb
Df1_badElement</p>
<p>S_drvAbDf
1_badBitNumber</p>
<p>S_drvAbDf1
_badSubelement</p>
<p class="last">S_drvAbDf1_OK</p>
</td>
</tr>
<tr class="row-odd"><td>drv
AbDf1SetupScan</td>
<td>Device support
get i/o
interrupt info
routine.</td>
<td>Called by the
device support
“Init Record”
routine to
parse the
hardware
address
information
and initialize
the element IO
structure.</td>
<td>void</td>
</tr>
<tr class="row-even"><td>drvAbDf
1InitiateWrite</td>
<td>Device support
write routine.</td>
<td>Initiates a
write
operation.
Integer words,
bit strings,
and floating
point
currently
supported.</td>
<td><p class="first">S_drvAbD
f1_uknDataType</p>
<p>S_drv
AbDf1_noMemory</p>
<p>S_drvAbDf1
_notSubscribed</p>
<p>S_drvAbDf1_a
syncCompletion</p>
<p>S_drv
AbDf1_mutexTMO</p>
<p>S_df1_BadAddr</p>
<p>S_df1_EOF</p>
<p>S_df1_BadType</p>
<p class="last">S_drvAbDf1_OK</p>
</td>
</tr>
<tr class="row-odd"><td>dr
vAbDf1ReadWord</td>
<td>Device support
read routine.</td>
<td>Reads current
value from the
cache. Returns
unsigned word
value.</td>
<td><p class="first">S_drvAbDf1
_notSubscribed</p>
<p>S_drv
AbDf1_mutexTMO</p>
<p>S_df1_BadAddr</p>
<p>S_df1_EOF</p>
<p>S_df1_BadType</p>
<p class="last">S_drvAbDf1_OK</p>
</td>
</tr>
<tr class="row-even"><td>drvAbDf
1ReadBitString</td>
<td>Device support
binary input
routine.</td>
<td>Reads current
value from the
cache. Returns
bit string.</td>
<td><p class="first">S_drvAbDf1
_notSubscribed</p>
<p>S_drv
AbDf1_badParam</p>
<p>S_drv
AbDf1_mutexTMO</p>
<p>S_df1_BadAddr</p>
<p>S_df1_EOF</p>
<p>S_df1_BadType</p>
<p class="last">S_drvAbDf1_OK</p>
</td>
</tr>
<tr class="row-odd"><td>dr
vAbDf1ReadReal</td>
<td>Device support
analog input
routine</td>
<td>Reads current
value from the
cache. Returns
IEEE
si
ngle-precision
floating point
value.</td>
<td><p class="first">S_drvAbDf1
_notSubscribed</p>
<p>S_drv
AbDf1_badParam</p>
<p>S_drv
AbDf1_mutexTMO</p>
<p>S_df1_BadAddr</p>
<p>S_df1_EOF</p>
<p>S_df1_BadType</p>
<p class="last">S_drvAbDf1_OK</p>
</td>
</tr>
</tbody>
</table>
<div class="section" id="global-variables">
<h4>2.17.3.1 Global Variables<a class="headerlink" href="#global-variables" title="Permalink to this headline">¶</a></h4>
<p>The following variables can be used to configure and/or change the
behaviour of the driver.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Usedby</th>
<th class="head">Meaning</th>
<th class="head">Data Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>drvAbDf1Sr
cStationNumber</td>
<td>EPICS startup
script</td>
<td>The
Allen-Bradley
node (station)
number for the
host that is
running this
code. Should
be defined
before calling
iocInit()</td>
<td><p class="first">Unsigned
integer</p>
<p class="last">(default 012)</p>
</td>
</tr>
<tr class="row-odd"><td>drvAbDf1Defaul
tScanPeriod_mS</td>
<td>EPICS startup
script</td>
<td>The number of
milliseconds
between scans.
Should be
defined before
calling
iocInit().</td>
<td><p class="first">Double</p>
<p class="last">(default
100.0)</p>
</td>
</tr>
<tr class="row-even"><td>d
rvAbDf1MaxOuts
tandingRequest</td>
<td>EPICS shell</td>
<td>The maximum
outstanding
requests (the
maximum
simultaneous
unanswered
requests
allowed).
Should be
changed
occasionally.</td>
<td><p class="first">Unsigned
integer</p>
<p class="last">(default 16)</p>
</td>
</tr>
<tr class="row-odd"><td>drvAbDf1Debug</td>
<td>EPICS shell</td>
<td>Turn on/off
debug
messages.
Increasing
detail with
increasing
value.</td>
<td>Unsigned
integer
(default 0)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="vme-interrupts-request-vector-and-handlers-3">
<span id="id31"></span><h3>2.17.4 VME Interrupts Request Vector and Handlers<a class="headerlink" href="#vme-interrupts-request-vector-and-handlers-3" title="Permalink to this headline">¶</a></h3>
<p>No interrupt handlers are used in this driver.</p>
</div>
<div class="section" id="plc-scan-threads">
<h3>2.17.5 PLC Scan Threads<a class="headerlink" href="#plc-scan-threads" title="Permalink to this headline">¶</a></h3>
<p>The PLC driver has one dedicated thread per PLC to scan for updates in
the PLC memory. The threads are in charge of processing all responses
that are pending in drvSerial.</p>
</div>
<div class="section" id="specific-requirements-12">
<span id="id32"></span><h3>2.17.6 Specific Requirements<a class="headerlink" href="#specific-requirements-12" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-117-01-initialize">
<h4>2.17.6.1 REQ-117-01 Initialize<a class="headerlink" href="#req-117-01-initialize" title="Permalink to this headline">¶</a></h4>
<p>The PLC support library shall be capable of executing the
drvAbDf1InitiateAll() routine without error by calling</p>
<p>iocInit().</p>
</div>
<div class="section" id="req-117-02-epics-report">
<h4>2.17.6.2 REQ-117-02 EPICS Report<a class="headerlink" href="#req-117-02-epics-report" title="Permalink to this headline">¶</a></h4>
<p>The EPICS routine dbior drvAbDf1 &lt;interest_level&gt; shall display the
state of all data channels respective for each initialized card (in
VxWorks it doesn’t print anything).</p>
</div>
<div class="section" id="req-117-03-analog-input-record-support-for-ab-df1-serial-scan-i-o-intr">
<h4>2.17.6.3 REQ-117-03 Analog Input Record Support for AB DF1 serial(SCAN I/O Intr)<a class="headerlink" href="#req-117-03-analog-input-record-support-for-ab-df1-serial-scan-i-o-intr" title="Permalink to this headline">¶</a></h4>
<p>The AbDf1 support library shall be capable of initializing and
processing an EPICS analog input record with its DTYP field set to AB
DF1 serial. SCAN= I/O Intr.</p>
</div>
<div class="section" id="req-117-04-analog-output-record-support-for-ab-df1-serial">
<h4>2.17.6.4 REQ-117-04 Analog Output Record Support for AB DF1 serial<a class="headerlink" href="#req-117-04-analog-output-record-support-for-ab-df1-serial" title="Permalink to this headline">¶</a></h4>
<p>The AbDf1 support library shall be capable of initializing and
processing an EPICS analog output record with its DTYP field set to AB
DF1 serial.</p>
</div>
<div class="section" id="req-117-05-binary-input-record-support-for-ab-df1-serial-scan-i-o-intr">
<h4>2.17.6.5 REQ-117-05 Binary Input Record Support for AB DF1 serial(SCAN I/O Intr)<a class="headerlink" href="#req-117-05-binary-input-record-support-for-ab-df1-serial-scan-i-o-intr" title="Permalink to this headline">¶</a></h4>
<p>The AbDf1 support library shall be capable of initializing and
processing an EPICS binary input record with its DTYP field set to AB
DF1 serial. SCAN= I/O Intr.</p>
</div>
<div class="section" id="req-117-06-binary-output-record-support-for-ab-df1-serial">
<h4>2.17.6.6 REQ-117-06 Binary Output Record Support for AB DF1 serial<a class="headerlink" href="#req-117-06-binary-output-record-support-for-ab-df1-serial" title="Permalink to this headline">¶</a></h4>
<p>The AbDf1 support library shall be capable of initializing and
processing an EPICS binary output record with its DTYP field set to AB
DF1 serial.</p>
</div>
<div class="section" id="req-117-25-two-plc-support">
<h4>2.17.6.7 REQ-117-25 Two PLC Support<a class="headerlink" href="#req-117-25-two-plc-support" title="Permalink to this headline">¶</a></h4>
<p>The AbDf1 support library shall be capable of communicate with two
Allen-Bradley PLC’s connected to two separate serial ports. All scan
tasks shall be running and not suspended after iocInit() completes. Each
AbDf1 task running shall have the name “AB DF1”.</p>
</div>
</div>
</div>
<div class="section" id="tcslib">
<h2>2.18 tcslib<a class="headerlink" href="#tcslib" title="Permalink to this headline">¶</a></h2>
<p>The tcslib requirements are very extensive and it is not practical (at
this writing) to itemize every function here. Further, this would yield
a low return on the investment. The tcslib itself has not been
refactored for OSI system calls. All the tcslib calls are standard C
calls and don’t invoke RTOS utilities such as semaphores, message queues
and threads.</p>
<div class="section" id="specific-requirements-13">
<span id="id33"></span><h3>2.18.1 Specific Requirements<a class="headerlink" href="#specific-requirements-13" title="Permalink to this headline">¶</a></h3>
<p>Although there are no EPICS OSI specific requirements, the following
requirements are defined for compatibility with the build environment
and systems depending on slalib.</p>
<div class="section" id="req-118-01-tcslib-ade-compatibility">
<h4>2.18.1.1 REQ-118-01 tcslib ADE Compatibility<a class="headerlink" href="#req-118-01-tcslib-ade-compatibility" title="Permalink to this headline">¶</a></h4>
<p>The tcslib library shall be compatible with the Application Development
Environment (ADE ), and build without errors or warnings.</p>
</div>
<div class="section" id="req-118-02-tcslib-available-for-linking">
<h4>2.18.1.2 REQ-118-02 tcslib Available for Linking<a class="headerlink" href="#req-118-02-tcslib-available-for-linking" title="Permalink to this headline">¶</a></h4>
<p>The tcslib library shall be available for linking and testing with other
CCB components.</p>
</div>
</div>
</div>
<div class="section" id="vmic-5588">
<span id="section-1"></span><h2>2.19 VMIC-5588<a class="headerlink" href="#vmic-5588" title="Permalink to this headline">¶</a></h2>
<p>VMIVME-5588 is a high-performance, daisy-chained VME-to-VME network.
Data is transferred by writing to on-board global RAM. The data is
automatically sent to the location in memory on all Reflective Memory
boards on the network.</p>
<p>VMIC’s VMIVME-5588 Reflective Memory interface allows data to be shared
between up to 256 independent systems (nodes) at rates up to 29.5
Mbyte/s. Each Reflective Memory board may be configured with 256 Kbyte
to 16 Mbyte of on-board SRAM. The local SRAM provides fast Read access
times to stored data. Writes are stored in local SRAM and broadcast over
a high-speed data path to other Reflective Memory nodes. The transfer of
data between nodes is software transparent, so no I/O overhead is
required. Transmit and Receive FIFOs buffer data during peak data rates
to optimize</p>
<p>The Reflective Memory also allows interrupts to one or more nodes by
writing to a byte register. These interrupt (three levels, each user
definable) signals may be used to synchronize a system process, or used
to follow any data. The interrupt always follows the data to ensure the
reception of the data before the interrupt is acknowledged. The
VMIVME-5588 requires no initialization unless interrupts are being used.
If interrupts are used, vectors and interrupt levels must be written to
on-board registers and the interrupts enabled.</p>
<div class="section" id="database-definition-file-vmi5588-dbd">
<h3>2.19.1 Database Definition File (vmi5588.dbd)<a class="headerlink" href="#database-definition-file-vmi5588-dbd" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="line-block">
<div class="line">device( bi, INST_IO, devBiVmi5588, “VMI5588 Synchro Bus” )</div>
<div class="line">driver(drvVmi5588)</div>
<div class="line">registrar(drvVmi5588RegisterCommands)</div>
<div class="line">variable(intr0cnt, int)</div>
<div class="line">variable(intr1cnt, int)</div>
<div class="line">variable(intr2cnt, int)</div>
<div class="line">variable(intr3cnt, int)</div>
<div class="line">variable(latestIrqNum, int)</div>
</div>
</div></blockquote>
</div>
<div class="section" id="device-support-requirements-8">
<span id="id34"></span><h3>2.19.2 Device Support Requirements<a class="headerlink" href="#device-support-requirements-8" title="Permalink to this headline">¶</a></h3>
<p>devBiVmi5588 –Provide binary input support using INST_IO for EPICS
records with Interrupt I/O scanning.</p>
</div>
<div class="section" id="driver-support-requirements-7">
<span id="id35"></span><h3>2.19.3 Driver Support Requirements<a class="headerlink" href="#driver-support-requirements-7" title="Permalink to this headline">¶</a></h3>
<p>The vmi-5588 driver provides contains support routines for the VMIC
VMIVME5588 Reflective</p>
<p>Memory card, for use both from EPICS and from a C subroutine. The EPICS
device support requires the following routines.</p>
<p>long vmi5588_init(void);</p>
<p>long vmi5588_report (int level);</p>
<p>LOCAL void vmi5588_reboot (void *p);</p>
<p>void vmi5588_intr(void *p);</p>
<p>long rmIntConnect(int irqNumber, void (<a href="#id36"><span class="problematic" id="id37">*</span></a>proutine)(int));</p>
<p>long rmIntDisconnect(int irqNumber);</p>
<p>long rmIntSend(int irqNumber,int nodeId);</p>
<p>long rmNodeId(void);</p>
<p>unsigned long rmStatus(long reset);</p>
<p>void vmi5588_pageISR(int rmNodeId);</p>
<p>long vmi5588_pageInit(short rmPage);</p>
<p>void vmi5588_pvtInit(struct rmpvt **ppdpvt, short rmPage,short
rmOffset,struct rm_data *prmData);</p>
<p>long vmi5588_getIoscanpvt(struct rmpvt *pdpvt, IOSCANPVT *pscanpvt);</p>
<p>long vmi5588_trigger(short rmPage);</p>
<p>void *rmPageMemBase(void);</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Function</strong></th>
<th class="head"><strong>Usedby</strong></th>
<th class="head"><strong>Meaning</strong></th>
<th class="head"><strong>Returns</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vmi5588_init</td>
<td>EPICS
iocInit()</td>
<td><ul class="first">
<li><dl class="first docutils">
<dt>registers</dt>
<dd><p class="first last">the card
with the
devLib
address
routines</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>makes sure</dt>
<dd><p class="first last">that a
VMIC5588
card is
present
at the
given
location</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>enable</dt>
<dd><blockquote class="first">
<div><p>VMEbus</p>
</div></blockquote>
<dl class="last docutils">
<dt>interrupt</dt>
<dd><p class="first last">level
needed
by this
card</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>initialise</dt>
<dd><p class="first last">the card</p>
</dd>
</dl>
</li>
</ul>
<blockquote>
<div>interrupters</div></blockquote>
<ul class="last">
<li><p class="first">turn any</p>
<blockquote>
<div><dl class="docutils">
<dt>interrupts</dt>
<dd><p class="first last">off if
we do a
reboot</p>
</dd>
</dl>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>turn off</dt>
<dd><p class="first last">the FAIL
LED</p>
</dd>
</dl>
</li>
</ul>
</td>
<td>OK, or
<a href="#id412"><span class="problematic" id="id413">S_dev_</span></a>???
errors.</td>
</tr>
<tr class="row-odd"><td>vmi5588_report</td>
<td>&#160;</td>
<td><ul class="first last">
<li><dl class="first docutils">
<dt>driver</dt>
<dd><blockquote class="first">
<div><p>status
report</p>
</div></blockquote>
<dl class="last docutils">
<dt>function,</dt>
<dd><p class="first last">which
displays
the
current
status
of the
hardware
when
called</p>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</td>
<td>OK, or
S_dev_NoInit
if driver not
initialised.</td>
</tr>
<tr class="row-even"><td>vmi5588_reboot</td>
<td><p class="first">epicsAtExit</p>
<p>devAiXy566Di.c</p>
<p>d
evAiXy566DiL.c</p>
<p class="last">devAiXy566Se.c</p>
</td>
<td>reboot Hook by
vmi5588_init,
and is
responsible
for turning
off RM
interrupts.</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>vmi5588_intr</td>
<td>rmINtConnect</td>
<td><p class="first">All RM
interrupts
pass through
this routine,
which reads
the RM source
ID and calls
the connected
routine for
this channel.</p>
<p class="last">.</p>
</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>rmIntConnect</td>
<td>EPICS dbior()</td>
<td><p class="first">Connect a C
routine up to
an RM
Interrupt.</p>
<ul class="last">
<li><p class="first">register an</p>
<blockquote>
<div><dl class="docutils">
<dt>interrupt</dt>
<dd><p class="first last">routine
with the
RM
driver
layer</p>
</dd>
</dl>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>initialises</dt>
<dd><blockquote class="first">
<div><blockquote>
<div><p>the BIM</p>
</div></blockquote>
<dl class="docutils">
<dt>registers</dt>
<dd><p class="first last">on the
5588
card to
enable</p>
</dd>
</dl>
</div></blockquote>
<dl class="last docutils">
<dt>interrupts</dt>
<dd><blockquote class="first">
<div><p>for the
given RM</p>
</div></blockquote>
<dl class="last docutils">
<dt>interrupt</dt>
<dd><p class="first last">channel
number.</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</td>
<td>OK, or
<a href="#id414"><span class="problematic" id="id415">S_dev_</span></a>???
errors.</td>
</tr>
<tr class="row-odd"><td>r
mIntDisconnect</td>
<td>IOC Shell at
startup</td>
<td><ul class="first last">
<li><p class="first">disables RM</p>
<blockquote>
<div><dl class="docutils">
<dt>interrupts</dt>
<dd><p class="first last">on the
given
channel
number</p>
</dd>
</dl>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>marks the</dt>
<dd><p class="first last">channel
as
unused.</p>
</dd>
</dl>
</li>
</ul>
</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>rmIntSend</td>
<td>&#160;</td>
<td>causes an
interrupt to
be sent out on
the RM bus,
using the
given channel
number.</td>
<td>OK, or
<a href="#id416"><span class="problematic" id="id417">S_dev_</span></a>???</td>
</tr>
<tr class="row-odd"><td>rmNodeId</td>
<td>&#160;</td>
<td>Used to find
the value of
the RM node ID
setting on the
VMIC5588 card.</td>
<td>vmi5588 Node
number (in the
range 0 to
255), or
S_dev_NoInit.</td>
</tr>
<tr class="row-even"><td>rmStatus</td>
<td>devBiVmi5588.c</td>
<td>This routine
reads various
status bits
from the 5588
card and
returns a
composite of
the
interesting
bits.</td>
<td><p class="first">Status from
the VMIC558
card (a value
in the range 0
to 0xffff), or</p>
<p class="last">S_dev_NoInit.</p>
</td>
</tr>
<tr class="row-odd"><td>v
mi5588_pageISR</td>
<td>Called by an
incoming I/O
Interrupt on
channel 1</td>
<td>causes records
in modified
pages which
are set to I/O
Interrupt
scanning to be
processed.</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>vm
i5588_pageInit</td>
<td>&#160;</td>
<td><ul class="first">
<li><dl class="first docutils">
<dt>Initialises</dt>
<dd><blockquote class="first">
<div><p>the page</p>
</div></blockquote>
<dl class="last docutils">
<dt>structure</dt>
<dd><p class="first last">used for
incoming
I/O</p>
</dd>
</dl>
</dd>
</dl>
<p>Interrupts.</p>
</li>
<li><dl class="first docutils">
<dt>No action</dt>
<dd><p class="first last">if page
has
already
been</p>
</dd>
</dl>
</li>
</ul>
<blockquote class="last">
<div>initialised.</div></blockquote>
</td>
<td>OK, or
<a href="#id418"><span class="problematic" id="id419">S_dev_</span></a>??? if
can’t connect
interrupt</td>
</tr>
<tr class="row-odd"><td>v
mi5588_pvtInit</td>
<td>&#160;</td>
<td>Allocates
storage for
and
initialises
private record
data</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>vmi558
8_getIoscanpvt</td>
<td>&#160;</td>
<td>Returns the
IOSCANPVT
token for a
record given
its dpvt
structure.</td>
<td>OK, or
S_dev_internal
if no entry
found</td>
</tr>
<tr class="row-odd"><td>v
mi5588_trigger</td>
<td>&#160;</td>
<td>Sends a
broadcast
interrupt to
trigger I/O
interrupt
processing for
all RM pages
on given page
number.</td>
<td>OK, or
<a href="#id420"><span class="problematic" id="id421">S_dev_</span></a>???</td>
</tr>
<tr class="row-even"><td>rmPageMemBase</td>
<td>&#160;</td>
<td>Function to
tell us where
the Reflective
memory is
located</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<div class="section" id="reflected-memory-status-bits">
<h4>2.19.3.1 Reflected Memory Status Bits<a class="headerlink" href="#reflected-memory-status-bits" title="Permalink to this headline">¶</a></h4>
<p>The rmStatus routine plays a primary role in the device and driver
support for the Vmi5588, capturing the state of the board registers and
populating individual EPICS Binary Input records with the result every
second. This is all passive scanning.</p>
<p>The rmStatus routine reads various status bits from the 5588 card and
returns a composite of the interesting bits. The input parameter is a
bit mask which is used to reset those status bits which are writable –
if rmStatus is called with the parameters RM_RESYNC, RM_BADXFER or
RM_NORING then the relevant status bit or bits will be cleared if they
are currently set. To clear all status bits, use a parameter value of
0xffff. The returned status value is not affected by the input
parameter.</p>
<p>The RM_NORING bit functions slightly differently to the others. Whenever
rmStatus is called with the the bit RM_NORING set the current value of
the status bit is returned and the bit cleared as normal, but the test
location in the reflected memory is also written which results in a data
packet being transmitted around the ring. Any calls to rmStatus which
occur before this packet (or any other packets which originated at this
node) has been received will return RM_NORING, but the ring transition
time should only be a few microseconds at worst.</p>
<div class="line-block">
<div class="line">RETURNS:</div>
<div class="line">Status from the VMIC5588 card (a value in the range 0 to 0xffff), or
S_dev_NoInit.</div>
<div class="line">The following symbols are defined in the header file vmi5588.h and
provide a bit mask for the return state. The bit will be set if the
condition described below is true, so zero means Good status.</div>
<div class="line">RM_IRQ1 Interrupt 1 Pending</div>
<div class="line">RM_IRQ2 Interrupt 2 Pending</div>
<div class="line">RM_IRQ3 Interrupt 3 Pending</div>
<div class="line">RM_NOSIG No Input Signal</div>
<div class="line">RM_NOSYNC Input PLL unsynchronized</div>
<div class="line">RM_RESYNC PLL Recently unsynchronized</div>
<div class="line">RM_NORING Fibre Ring broken</div>
<div class="line">RM_BADXFR Single Transfer Error</div>
<div class="line">RM_TXHALF Transmit FIFO Half-full</div>
<div class="line">RM_RXHALF Receive FIFO Half-full</div>
<div class="line">EXAMPLE:</div>
<div class="line">-&gt; rmStatus 0x40</div>
<div class="line">value = 64 = 0x44 = ‘&#64;’</div>
<div class="line">-&gt; rmStatus</div>
<div class="line">value = 4 = 0x4</div>
</div>
</div>
</div>
<div class="section" id="specific-requirements-14">
<span id="id38"></span><h3>2.19.4 Specific Requirements<a class="headerlink" href="#specific-requirements-14" title="Permalink to this headline">¶</a></h3>
<div class="section" id="req-119-01-vmi5588-init">
<h4>2.19.4.1 REQ-119-01 vmi5588_init<a class="headerlink" href="#req-119-01-vmi5588-init" title="Permalink to this headline">¶</a></h4>
<p>The vmi-5588 support library shall be capable of executing the
vmi5588_init() routine without error by calling iocInit().</p>
</div>
<div class="section" id="req-119-02-vmi5588-epics-report">
<h4>2.19.4.2 REQ-119-02 Vmi5588 EPICS Report<a class="headerlink" href="#req-119-02-vmi5588-epics-report" title="Permalink to this headline">¶</a></h4>
<p>The EPICS routine dbior drvVmi5588 &lt;interest_level&gt;) shall display the
state of all data channels respective for that card. See vmi5588_report.</p>
</div>
<div class="section" id="req-119-03-binary-input-device-support">
<h4>2.19.4.3 REQ-119-03 Binary Input Device Support<a class="headerlink" href="#req-119-03-binary-input-device-support" title="Permalink to this headline">¶</a></h4>
<p>The vmi5588 support library shall be capable of initializing and
processing an EPICS binary input record with its DTYP field set to
‘VMI5588 Synchro Bus’.</p>
</div>
<div class="section" id="req-119-04-reflected-memory-status">
<h4>2.19.4.4 REQ-119-04 Reflected Memory Status<a class="headerlink" href="#req-119-04-reflected-memory-status" title="Permalink to this headline">¶</a></h4>
<p>The vmi5588 support library shall be capable of populating all “RM
Status” binary input records defined in the Reflected Memory Status Bits
section above.</p>
</div>
<div class="section" id="req-119-05-vme-node-to-pci-msdos-node-data-integrity">
<h4>2.19.4.5 REQ-119-05 VME Node to PCI (MSDOS) Node Data Integrity<a class="headerlink" href="#req-119-05-vme-node-to-pci-msdos-node-data-integrity" title="Permalink to this headline">¶</a></h4>
<p>The vmi5588 support library shall be capable of executing a Ping-Pong
test between a VME node and a PCI node running MSDOS (like the M2TS
CEM).</p>
<p>PING PONG DETAILS…</p>
</div>
<div class="section" id="req-119-06-vme-node-to-vme-node-data-integrity">
<h4>2.19.4.6 REQ-119-06 VME Node to VME Node Data Integrity<a class="headerlink" href="#req-119-06-vme-node-to-vme-node-data-integrity" title="Permalink to this headline">¶</a></h4>
<p>The vmi5588 support library shall be capable of executing a Ping-Pong
test between two VME systems.</p>
<p>PING PONG DETAILS…</p>
</div>
</div>
</div>
</div>
<div class="section" id="test-plan">
<span id="section-2"></span><h1>3 Test Plan<a class="headerlink" href="#test-plan" title="Permalink to this headline">¶</a></h1>
<p>The following test plans depend on a functioning ADE system capable of
building binaries for both the MVME2700 (RTEMS-mvme2307) and MVME6100
(RTEMS-beatnik) bsp’s. The following configurations are required for
each board.</p>
<div class="section" id="linux-host-setup">
<h2>3.1 Linux Host Setup<a class="headerlink" href="#linux-host-setup" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Open a Linux terminal and configure the EPICS Channel Access to</dt>
<dd>communicate with your IOC.</dd>
</dl>
</li>
</ol>
<blockquote>
<div>For HBF:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ export EPICS_CA_ADDR_LIST 10.1.2.171</td>
</tr>
</tbody>
</table>
<blockquote>
<div>For SBF:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ export EPICS_CA_ADDR_LIST 172</p>
<p class="last">.16.2.23</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cpu-board-setup">
<h2>3.2 CPU Board Setup<a class="headerlink" href="#cpu-board-setup" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Mvme2700 Setup Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Register your test IOC with the ADE</dt>
<dd>Redirector. For this example we’ll
use the gemtest1-MK as our test
IOC. Make sure your IOC has a
registered IP address. For this
setup we’ll use gemtest1-MK with
an IP address of 10.1.2.174. The
tftp server is hbfrtdev-lv1 and
has an IP address of 10.1.71.11.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ configure-ioc -t work -a
RTEMS-mvme2307 gemtest1-MK</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Setup your mvme2700 with the</dt>
<dd>following board level
configurations</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">PPC1-Bug&gt;niot</p>
<p>Controller LUN =00?</p>
<p>Device LUN =00?</p>
<p>Node Control Memory Address
=07F9E000?</p>
<p>Client IP Address =10.1.2.174?</p>
<p>Server IP Address =10.1.71.11?</p>
<p>Subnet IP Address Mask
=255.255.255.0?</p>
<p>Broadcast IP Address =10.1.2.255?</p>
<p>Gateway IP Address =10.1.2.1?</p>
<p>Boot File Name (“NULL” for None)
=/g
em_sw/prod/redirector/gemtest1-MK?</p>
<p>Argument File Name (“NULL” for
None)
=10.1.71.11:/gem_s
w:prod/redirector/gemtest1-MK.cmd?</p>
<p>Boot File Load Address =001F0000?</p>
<p>Boot File Execution Address
=001F0000?</p>
<p>Boot File Execution Delay
=00000000?</p>
<p>Boot File Length =00000000?</p>
<p>Boot File Byte Offset =00000000?</p>
<p>BOOTP/RARP Request Retry =05?</p>
<p>TFTP/ARP Request Retry =05?</p>
<p>Trace Character Buffer Address
=00000000?</p>
<p>BOOTP/RARP Request Control:
Always/When-Needed (A/W)=W?</p>
<p>BOOTP/RARP Reply Update Control:
Yes/No (Y/N) =Y?</p>
<p class="last">Update Non-Volatile RAM (Y/N)? Y</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Mvme-6100 Setup Procedure</td>
<td><ol class="first arabic simple">
<li>Register your ioc application</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ configure-ioc -t work -a
RTEMS-beatnik gemtest1-MK</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Setup your mvme6100 with the</dt>
<dd>following board level
configurations</dd>
</dl>
</li>
</ol>
<blockquote>
<div>TBD…</div></blockquote>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">MVME6100&gt; gevEdit
mot-/dev/enet0-file
mot-/dev
/enet0-file=ioc/labvme4/test.boot</p>
<p>(Blank line terminates input.)</p>
<p>ioc/labvme4/PGTEST-CP-IOC.boot</p>
<p>Update Global Environment Area of
NVRAM (Y/N)? y</p>
<p>MVME6100&gt; gevEdit epics-nfsmount</p>
<p>epics-nfsm
ount=172.16.71.11:/gemini:/gemini</p>
<p>(Blank line terminates input.)</p>
<p>172.16.71.11:/home:/home</p>
<p>Update Global Environment Area of
NVRAM (Y/N)? y</p>
<p>MVME6100&gt; gevEdit epics-script</p>
<p>epics-script
=/gemini/ioc/labvme4/epics/st.cmd</p>
<p>(Blank line terminates input.)</p>
<p>/gem_sw/work</p>
<p class="last">Update Global Environment Area of
NVRAM (Y/N)? y</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ioc-stats">
<h2>3.3 IOC-Stats<a class="headerlink" href="#ioc-stats" title="Permalink to this headline">¶</a></h2>
<p>This module tests the functional requirements of the EPICS iocStats
support library.</p>
<div class="section" id="test-setup-and-prerequisites">
<h3>3.3.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites" title="Permalink to this headline">¶</a></h3>
<p>There are no peripheral hardware tests for this module. You only need to
prepare a CPU board as described in <a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup</a>.</p>
</div>
<div class="section" id="epics-test-harness">
<h3>3.3.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness" title="Permalink to this headline">¶</a></h3>
<p>The iocStats libraries include epics records which can be loaded during
startup. The modular framework of databases can be viewed in
iocStats/iocAdmin/Db/. The iocAdminRTEMS.substitutions will load the
following template files with a top-level macro for $(IOC) :</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>ioc.template Records showing stats about IOC CPU load, records,</dt>
<dd>files, CA clients, etc.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>iocGeneralTime.template Records showing stats about IOC GeneralTime</dt>
<dd>providers</dd>
</dl>
</li>
<li>iocRTOS.template Records showing stats about IOC Free Memory Blocks</li>
<li><dl class="first docutils">
<dt>iocRTEMSOnly.template Records showing stats about RTEMS Workspace</dt>
<dd>memory</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>iocsEnvVar.template Records showing stats about IOC Environment</dt>
<dd>Variables</dd>
</dl>
</li>
<li>iocCluster.template. Records showing stats about IOC System Clusters</li>
</ul>
<div class="section" id="iocadmin-substitutions">
<h4>3.3.2.1 iocAdmin.substitutions<a class="headerlink" href="#iocadmin-substitutions" title="Permalink to this headline">¶</a></h4>
<p>The iocAdminRTEMS.substitutions file generates the iocAdmin.db file at
build time.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">#</p>
<p># Abs: IOC Administration Records for RTEMS IOCs</p>
<p>#</p>
<p># Name: iocAdminRTEMS.substitutions</p>
<p>#</p>
<p>#</p>
<p>file ioc.template</p>
<p>{</p>
<p>pattern { IOCNAME , TODFORMAT }</p>
<p>{ $(IOC) , “%m/%d/%Y %H:%M:%S” }</p>
<p>}</p>
<p>file iocGeneralTime.template</p>
<p>{</p>
<p>pattern { IOCNAME }</p>
<p>{ $(IOC) }</p>
<p>}</p>
<p>file iocRTOS.template</p>
<p>{</p>
<p>pattern { IOCNAME , SYS_MBUF_FLNK }</p>
<p>{ $(IOC) , $(IOC):CLUST_1_0_0}</p>
<p>}</p>
<p>file iocRTEMSOnly.template</p>
<p>{</p>
<p>pattern { IOCNAME }</p>
<p>{ $(IOC) }</p>
<p>}</p>
<p>file iocEnvVar.template</p>
<p>{</p>
<p>pattern { IOCNAME, ENVNAME , ENVVAR , ENVTYPE}</p>
<p>{ $(IOC) , CA_ADDR_LIST , EPICS_CA_ADDR_LIST , epics }</p>
<p>{ $(IOC) , CA_CONN_TIME , EPICS_CA_CONN_TMO , epics }</p>
<p>{ $(IOC) , CA_AUTO_ADDR , EPICS_CA_AUTO_ADDR_LIST , epics }</p>
<p>{ $(IOC) , CA_RPTR_PORT , EPICS_CA_REPEATER_PORT , epics }</p>
<p>{ $(IOC) , CA_SRVR_PORT , EPICS_CA_SERVER_PORT , epics }</p>
<p>{ $(IOC) , CA_MAX_ARRAY , EPICS_CA_MAX_ARRAY_BYTES , epics }</p>
<p>{ $(IOC) , CA_SRCH_TIME , EPICS_CA_MAX_SEARCH_PERIOD , epics }</p>
<p>{ $(IOC) , CA_BEAC_TIME , EPICS_CA_BEACON_PERIOD , epics }</p>
<p>{ $(IOC) , TIMEZONE , EPICS_TIMEZONE , epics }</p>
<p>{ $(IOC) , TS_NTP_INET , EPICS_TS_NTP_INET , epics }</p>
<p>{ $(IOC) , IOC_LOG_PORT , EPICS_IOC_LOG_PORT , epics }</p>
<p>{ $(IOC) , IOC_LOG_INET , EPICS_IOC_LOG_INET , epics }</p>
<p>}</p>
<p>file iocCluster.template</p>
<p>{</p>
<p># Pool Size</p>
<p>pattern { IOCNAME , P , S , TYPE , FLNK }</p>
<p># System Pool</p>
<p>{ $(IOC) , 1 , 0 , SYS , $(IOC):CLUST_1_1_0 }</p>
<p>{ $(IOC) , 1 , 1 , SYS , “” }</p>
<p class="last">}</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="include-the-iocadminrtems-db">
<h4>3.3.2.2 Include the iocAdminRTEMS.db<a class="headerlink" href="#include-the-iocadminrtems-db" title="Permalink to this headline">¶</a></h4>
<p>In your test IOC, include the iocAdminRTEMS database. Edit the
iocTestApp/Db/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += iocAdminRTEMS.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="include-the-deviocstats-and-iocadmin-libraries-in-your-build">
<h4>3.3.2.3 Include the devIocStats and iocAdmin libraries in your build<a class="headerlink" href="#include-the-deviocstats-and-iocadmin-libraries-in-your-build" title="Permalink to this headline">¶</a></h4>
<p>In your testIOC, include the iocAdmin libraries. Edit the
iocTestApp/src/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-MK_DBD += iocAdmin.dbd</p>
<p>…</p>
<p class="last">gemtest1-MK_LIBS += devIocStats</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-file">
<h4>3.3.2.4 Startup File<a class="headerlink" href="#startup-file" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-MK</p>
<p>cd ${INSTALL}</p>
<p>#Set the Timezone to UTC</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”Your Name Goes Here”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/gemtest1-MK.dbd”)</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p>dbLoadRecords(“db/iocAdminRTEMS.db”,
“IOC=gemtest1-MK,TODFORMAT=%m/%d/%Y %H:%M:%S”)</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rebuild-ioc">
<h4>3.3.2.5 Rebuild IOC<a class="headerlink" href="#rebuild-ioc" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Run ‘make distclean; make’ in ioc top directory.</td>
</tr>
</tbody>
</table>
<p>3.3.3 IOC Diagnostic Screens</p>
<p>For all iocStats requirements, you can use the MEDM screen below. Run
the gem-iocstats &lt;ioc_target&gt; diagnostic screen like this.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ gem-iocstats.py gemtest1-MK</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="other/ccb/./media/media/image6.png"><img alt="ioc_stats.png" src="other/ccb/./media/media/image6.png" style="width: 4.61831in; height: 6.57639in;" /></a></p>
</div>
</div>
<div class="section" id="req-101-01-largest-free-memory-block-1">
<span id="id39"></span><h3>3.3.3 REQ-101-01 Largest free memory block<a class="headerlink" href="#req-101-01-largest-free-memory-block-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id40"><span class="problematic" id="id41">`</span></a>3.3.1 Test Setup and</li>
</ol>
<p>Prerequisites &lt;#test-setup-and-prerequisites&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id42"><span class="problematic" id="id43">`</span></a>3.3.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id44"><span class="problematic" id="id45">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>Using the IOC Diagnostic screens, check the
value of the Largest free memory block is valid.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>Ensure that the value is reported.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-101-02-cpu-usage-1">
<span id="id46"></span><h3>3.3.4 REQ-101-02 CPU Usage<a class="headerlink" href="#req-101-02-cpu-usage-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id47"><span class="problematic" id="id48">`</span></a>3.3.1 Test Setup and</li>
</ol>
<p>Prerequisites &lt;#test-setup-and-prerequisites&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id49"><span class="problematic" id="id50">`</span></a>3.3.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id51"><span class="problematic" id="id52">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>Using the IOC Diagnostic screens, check the
value of the CPU Usage is valid.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>Ensure that the value is reported.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-101-03-suspended-tasks-1">
<span id="id53"></span><h3>3.3.5 REQ-101-03 Suspended Tasks<a class="headerlink" href="#req-101-03-suspended-tasks-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id54"><span class="problematic" id="id55">`</span></a>3.3.1 Test Setup and</li>
</ol>
<p>Prerequisites &lt;#test-setup-and-prerequisites&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id56"><span class="problematic" id="id57">`</span></a>3.3.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id58"><span class="problematic" id="id59">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>Using the IOC Diagnostic screens, check the
value of the Suspended Tasks is valid.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>Ensure that the value is reported.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-101-04-file-descriptors-1">
<span id="id60"></span><h3>3.3.6 REQ-101-04 File Descriptors<a class="headerlink" href="#req-101-04-file-descriptors-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id61"><span class="problematic" id="id62">`</span></a>3.3.1 Test Setup and</li>
</ol>
<p>Prerequisites &lt;#test-setup-and-prerequisites&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id63"><span class="problematic" id="id64">`</span></a>3.3.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id65"><span class="problematic" id="id66">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>Using the IOC Diagnostic screens, check the
value of the File Descriptors is valid.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>Ensure that the value is reported.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-101-05-ca-clients-1">
<span id="id67"></span><h3>3.3.7 REQ-101-05 CA Clients<a class="headerlink" href="#req-101-05-ca-clients-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id68"><span class="problematic" id="id69">`</span></a>3.3.1 Test Setup and</li>
</ol>
<p>Prerequisites &lt;#test-setup-and-prerequisites&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id70"><span class="problematic" id="id71">`</span></a>3.3.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id72"><span class="problematic" id="id73">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>Using the IOC Diagnostic screens, check the
number of CA Clients is valid.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>Ensure that the value is reported.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-101-06-ca-connections-1">
<span id="id74"></span><h3>3.3.8 REQ-101-06 CA Connections<a class="headerlink" href="#req-101-06-ca-connections-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id75"><span class="problematic" id="id76">`</span></a>3.3.1 Test Setup and</li>
</ol>
<p>Prerequisites &lt;#test-setup-and-prerequisites&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id77"><span class="problematic" id="id78">`</span></a>3.3.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id79"><span class="problematic" id="id80">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>Using the IOC Diagnostic screens, check the
value of the CA Connections.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>Ensure that the value is reported.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-101-07-number-of-records-1">
<span id="id81"></span><h3>3.3.9 REQ-101-07 Number of Records<a class="headerlink" href="#req-101-07-number-of-records-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id82"><span class="problematic" id="id83">`</span></a>3.3.1 Test Setup and</li>
</ol>
<p>Prerequisites &lt;#test-setup-and-prerequisites&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id84"><span class="problematic" id="id85">`</span></a>3.3.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id86"><span class="problematic" id="id87">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>Using the IOC Diagnostic screens, check the
value of the Number of records.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>.Ensure that the value is reported.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-101-09-restart-control">
<h3>3.3.10 REQ-101-09 Restart Control<a class="headerlink" href="#req-101-09-restart-control" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id88"><span class="problematic" id="id89">`</span></a>3.3.1 Test Setup and</li>
</ol>
<p>Prerequisites &lt;#test-setup-and-prerequisites&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id90"><span class="problematic" id="id91">`</span></a>3.3.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id92"><span class="problematic" id="id93">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>Using the IOC Diagnostic screens, execute a
Reboot.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>Ensure the Reboot is successful.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="sequencer">
<h2>3.4 Sequencer<a class="headerlink" href="#sequencer" title="Permalink to this headline">¶</a></h2>
<p>This module tests the functional requirements for the EPICS Sequencer.</p>
<div class="section" id="test-setup-and-prerequisites-1">
<span id="id94"></span><h3>3.4.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-1" title="Permalink to this headline">¶</a></h3>
<p>There are no peripheral hardware tests for this module. You only need to
prepare a CPU board as described in <a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup</a>.</p>
</div>
<div class="section" id="epics-test-harness-1">
<span id="section-3"></span><span id="id95"></span><h3>3.4.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-1" title="Permalink to this headline">¶</a></h3>
<p>To test the requirements for the EPICS Sequencer, there are two tests.
The demo program verifies a simple state set can be processed.
Additionally, a legacy Gemini program will be tested. For the demo
program, load the demo.db and the demoLib into the IOC test bench.</p>
<div class="section" id="add-the-demo-db">
<h4>3.4.2.1 Add the demo.db<a class="headerlink" href="#add-the-demo-db" title="Permalink to this headline">¶</a></h4>
<p>Edit the gemtest1App/Db/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += demo.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-demolib">
<h4>3.4.2.2 Add the demoLib<a class="headerlink" href="#add-the-demolib" title="Permalink to this headline">¶</a></h4>
<p>Edit the gemtest1App/Db/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-MK_DBD += demo.dbd</p>
<p>#SNCSEQ</p>
<p>gemtest1-MK_LIBS += demoLib</p>
<p class="last">gemtest1-MK_LIBS += seq pv</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script">
<h4>3.4.2.3 Startup script<a class="headerlink" href="#startup-script" title="Permalink to this headline">¶</a></h4>
<p>Edit the startup script to load the records and start the demo program.
Note that this builds on the <a class="reference external" href="#epics-test-harness">iocStats Test
Harness</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-MK</p>
<p>cd ${INSTALL}</p>
<p>#Setup timezone and user info for iocsStats</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”Matt Rippa”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/gemtest1-MK.dbd”)</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p>## Load record instances</p>
<p>dbLoadRecords(“db/iocAdminRTEMS.db”,
“IOC=gemtest1-MK,TODFORMAT=%m/%d/%Y %H:%M:%S”)</p>
<p>dbLoadRecords(“db/demo.db”, “PREFIX=snctest”)</p>
<p>iocInit</p>
<p>## Start any sequence programs</p>
<p class="last">seq(&amp;demo, “prefix=snctest”)</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="diagnostic-screens">
<h3>3.4.3 Diagnostic Screens<a class="headerlink" href="#diagnostic-screens" title="Permalink to this headline">¶</a></h3>
<p>The sequencer demo can be run to see the live state of the demo program.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$/gem_sw/prod/R3.14.12.4/support/seq/2-2-5/bin/linux-x86_64/seqdemo.py</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="other/ccb/./media/media/image3.png"><img alt="SequencerDemo.png" src="other/ccb/./media/media/image3.png" style="width: 4.61979in; height: 4.09208in;" /></a></p>
</div>
<div class="section" id="req-102-01-sequencer-demo-program-1">
<span id="id96"></span><h3>3.4.4 REQ-102-01 Sequencer Demo Program<a class="headerlink" href="#req-102-01-sequencer-demo-program-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt><a href="#id97"><span class="problematic" id="id98">`</span></a>3.4.1 Test Setup and</dt>
<dd>Pr</dd>
</dl>
</li>
</ol>
<p>erequisites &lt;#test-setup-and-prerequisites-1&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id99"><span class="problematic" id="id100">`</span></a>3.4.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness-1&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id101"><span class="problematic" id="id102">`</span></a>3.4.3 Diagnostic</dt>
<dd>Screens &lt;#diagnostic-screens&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li>Run the IOC as shown in the prerequisites.</li>
<li><dl class="first docutils">
<dt>Using the Diagnostic Screens check the demo</dt>
<dd>program is running.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The demo program is running with the voltage</dt>
<dd>ramping up and down. The light turns on
and off as the voltage goes above and
below the defined limits.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-102-02-legacy-state-notation-code-1">
<span id="id103"></span><h3>3.4.5 REQ-102-02 Legacy State Notation Code<a class="headerlink" href="#req-102-02-legacy-state-notation-code-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt><a href="#id104"><span class="problematic" id="id105">`</span></a>3.4.1 Test Setup and</dt>
<dd>Pr</dd>
</dl>
</li>
</ol>
<p>erequisites &lt;#test-setup-and-prerequisites-1&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id106"><span class="problematic" id="id107">`</span></a>3.4.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness-1&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id108"><span class="problematic" id="id109">`</span></a>3.4.3 Diagnostic</dt>
<dd>Screens &lt;#diagnostic-screens&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>For each legacy system, load and run the</dt>
<dd>sequencer code.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The legacy system code will function as</dt>
<dd>before. Because this test relies on the
upgraded systems, it must be executed
incrementally. It may only be possible to
verify this with summit testing.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="gemini-records">
<h2>3.5 Gemini Records<a class="headerlink" href="#gemini-records" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-2">
<span id="id110"></span><h3>3.5.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-2" title="Permalink to this headline">¶</a></h3>
<p>There are no peripheral hardware tests for this module. You only need to
prepare a CPU board as described in <a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup</a>.</p>
</div>
<div class="section" id="epics-test-harness-2">
<span id="id111"></span><h3>3.5.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="add-the-testtop-db">
<h4>3.5.2.1 Add the testTop.db<a class="headerlink" href="#add-the-testtop-db" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += testTop.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-libraries">
<h4>3.5.2.2 Add the libraries<a class="headerlink" href="#add-the-libraries" title="Permalink to this headline">¶</a></h4>
<p>We need to include libraries for geminiRecords, tcslib and
testGeminiRecords in the build.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-MK_DBD += geminiRecords.dbd</p>
<p>gemtest1-MK_DBD += tcslib.dbd</p>
<p>gemtest1-MK_DBD += testGeminiRecs.dbd</p>
<p>…</p>
<p>gemtest1-MK_LIBS += testGeminiRecs</p>
<p>gemtest1-MK_LIBS += tcslib</p>
<p>gemtest1-MK_LIBS += geminiRecords</p>
<p class="last">gemtest1-MK_LIBS += slalib</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-1">
<span id="id112"></span><h4>3.5.2.3 Startup script<a class="headerlink" href="#startup-script-1" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">cd /gem_sw/work/R3.14.12.4/ioc/gemtest1/MK</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”Matt Rippa”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/gemtest1-MK.dbd”)</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p>## Load record instances</p>
<p>dbLoadRecords(“db/iocAdminRTEMS.db”,
“IOC=gemtest1-MK,TODFORMAT=%m/%d/%Y %H:%M:%S”)</p>
<p>dbLoadRecords(“db/testTop.db”, “test=grt:”)</p>
<p>iocInit</p>
<p>## Start any sequence programs</p>
<p class="last">#seq(demo, “prefix=snctest”)</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="diagnostic-screens-1">
<span id="id113"></span><h3>3.5.3 Diagnostic Screens<a class="headerlink" href="#diagnostic-screens-1" title="Permalink to this headline">¶</a></h3>
<p>The Gemini Records Test screen can be run to test the functionality of
all records under the Gemini Records library.</p>
<p>Example script for work package:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$
/gem_sw/
work/R3.14.12.4/support/geminiRec/bin/linux-x86_64/gemRecordsTest.sh</td>
</tr>
</tbody>
</table>
<p>Example script for production package:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$
/gem_sw/prod/R
3.14.12.4/support/geminiRec/4-1-4/bin/linux-x86_64/gemRecordsTest.sh</td>
</tr>
</tbody>
</table>
<p><a class="reference internal" href="other/ccb/./media/media/image2.png"><img alt="GeminiRecordsTest.png" src="other/ccb/./media/media/image2.png" style="width: 6.5in; height: 3.31944in;" /></a></p>
</div>
<div class="section" id="req-103-01-gensubrecord-1">
<span id="id114"></span><h3>3.5.4 REQ-103-01 gensubRecord<a class="headerlink" href="#req-103-01-gensubrecord-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminals each configured</dt>
<dd>as described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id115"><span class="problematic" id="id116">`</span></a>3.5.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness-2&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id117"><span class="problematic" id="id118">`</span></a>3.5.3 Diagnostic</dt>
<dd>Screens &lt;#diagnostic-screens-1&gt;`__ for
Gemini Test Records</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id119"><span class="problematic" id="id120">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__ for iocStats</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Boot the IOC , start the Linux terminals and</dt>
<dd>the test screens as described in the
prerequisites.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>With the Gemini Records Test Libraries loaded</dt>
<dd>there will be roughly 1000+ channels
connected. View and confirm this on the
iocStats screen.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>For the gensubRecord test there is an airmass</dt>
<dd>calculation record in the testObserve
schematic. View the general record health
with the dbpr command using no interest
level argument.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>10.1.2.171&gt; dbpr grt:observe:calcAirmass</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><dl class="first docutils">
<dt>Run the dbpr command with an interest level</dt>
<dd>of 10 and check the results and the SNAM
field. The SNAM field shows the subroutine
which executes when the record processes.
The TIME field shows valid timestamp if
the record has processed.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>10.1.2.171&gt; dbpr grt:observe:calcAirmass 10</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="5">
<li><dl class="first docutils">
<dt>In linux terminal 1, add a camonitor to the</dt>
<dd>airMassNow record in the testObserve
schematic. The airMassNow is updated every
1 second based on the zenith distance of
the telescope (INPB of the calcAirmass
gensub).</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>10.1.2.171&gt; camonitor grt:airMassNow</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="6">
<li><dl class="first docutils">
<dt>You’ll see the airMassNow record update when</dt>
<dd>the elevation has updated. In your
terminal #2 update the elevation position.
Try successively updating the elevation to
confirm the gensub record processes at
most 1 time per second.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>10.1.2.171&gt; caput grtMC:elCurrentPos 60</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>From procedure step 3, view and confirm the</dt>
<dd>calcAirmass record is in good health. It’s
possible the record has not processed yet
and the SEVR field will show INVALID.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Check all the inputs, outputs and the SNAM</dt>
<dd>field from step 4. The SEVR will say
NO_ALARM.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>With linux terminal inputs verify the gensub</dt>
<dd>record processes. You can do this by
watching updates to the camonitor screen.
As the elevation values change, the
monitor on the airMassNow will update
demonstrating the gensubRecord is
functioning.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-103-02-applyrecord-1">
<span id="id121"></span><h3>3.5.5 REQ-103-02 applyRecord<a class="headerlink" href="#req-103-02-applyrecord-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminals each configured</dt>
<dd>as described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id122"><span class="problematic" id="id123">`</span></a>3.5.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness-2&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id124"><span class="problematic" id="id125">`</span></a>3.5.3 Diagnostic</dt>
<dd>Screens &lt;#diagnostic-screens-1&gt;`__ for
Gemini Records Test Screen (GRTS)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id126"><span class="problematic" id="id127">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__ for iocStats</dd>
</dl>
</li>
<li>Xycom is a dependency…</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li>Client ID Field (CLID)<ol class="loweralpha">
<li><dl class="first docutils">
<dt>The CLID is incremented every time a</dt>
<dd>directive is loaded. There are a series
of Apply records starting with the
“Master” Apply record in the testApply
schematic .The top-level “Master” apply
record can be controlled from the GRTS,
shown as an APPLY button. Put a
camonitor on the CLID field of all
apply records. Each time the “Master”
Apply record is processed the directive
is load for all Apply and CAD records
in the processing chain.</dd>
</dl>
</li>
</ol>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor grt:apply.CLID
grt:seq:apply.CLID grt:seq:apply1.CLID
grt:seq:apply2.CLID grt:seq:apply3.CLID
grt:seq:apply4.CLID</td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="2">
<li><dl class="first docutils">
<dt>Process the Apply sequence by MARKing any one</dt>
<dd>command on the GRTS, then click the Apply
button.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Mark any number of commands on the GRTS, then</dt>
<dd>click on the CLEAR button.</dd>
</dl>
</li>
</ol>
<ol class="arabic" start="2">
<li><dl class="first docutils">
<dt>Message Field (MESS) (<a href="#id128"><span class="problematic" id="id129">**</span></a>Requires XYCOM</dt>
<dd><p class="first last">currently**)</p>
</dd>
</dl>
<ol class="loweralpha simple">
<li><dl class="first docutils">
<dt>This is the return message from processing</dt>
<dd>an Apply directive. If the return is 0,
this field is empty. Otherwise, it
reads the error message. Put a monitor
on the MESS field of all apply records.</dd>
</dl>
</li>
</ol>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor grt:apply.MESS
grt:seq:apply.MESS grt:seq:apply1.MESS
grt:seq:apply2.MESS grt:seq:apply3.MESS
grt:seq:apply4.MESS</td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="2">
<li><dl class="first docutils">
<dt>Set the Xycom interlock to the INTERLOCKED</dt>
<dd>state by setting the Xycom 240 inputs. For
this you need the Xycom 240 installed.
(See <a href="#id130"><span class="problematic" id="id131">`</span></a>Xycom 240</dd>
<dt>Setup &lt;#test-setup-and-prerequisites-10&gt;`__).</dt>
<dd>Connect all Xycom output data ports
4,5,6,7 on JK/2 to all input data ports
0,1,2,3 on JK/1. Use a 50-pin breakout
with ribbon cables to make it easier, or
just the ribbon cable.</dd>
</dl>
</li>
</ol>
<blockquote>
<div>NB. By set the output bits on port 4, you
drive the input on port 0 (i.e., the state of
S24 and S25 determine the interlock. You need
1 for INTERLOCK and 2 for CLEAR) .</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ioc&gt; xy240_dio_out(0,4,1)</td>
</tr>
</tbody>
</table>
<ol class="loweralpha simple" start="3">
<li><dl class="first docutils">
<dt>With the interlock set, the first CAD</dt>
<dd>subroutine in the chain will be REJECTED
and this halts all further processing.
Process the Apply sequence by MARKing any
one command on the GRTS. Then click the
Apply button.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>With the interlock in a CLEAR state, the</dt>
<dd>processing is not REJECTED. Clear the
interlock by writing a 2 back to the Xycom
S24, S25.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ioc&gt; xy240_dio_out(0,4,2)</td>
</tr>
</tbody>
</table>
<ol class="last loweralpha simple" start="5">
<li><dl class="first docutils">
<dt>Process the Apply sequence by MARKing any one</dt>
<dd>command on the GRTS, then click the Apply
button.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Step 1.a should show the CLID for all apply</dt>
<dd>records. They should all be the same
integer.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Step 1b. should show all CLID’s increment by</dt>
<dd>1. Some apply records may processes
multiple times, but the CLID should
increment by 1 and only 1 for all records.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Step 1c. should clear the MARK bit on all</dt>
<dd>commands. The apply records will all
process, yet the CLID’s will NOT
increment.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Step 2a. should show no message returned in</dt>
<dd>any apply records when the interlock is in
a CLEAR state.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step 2b. and 2c., the message <a href="#id132"><span class="problematic" id="id133">**</span></a>“GIS</dt>
<dd>Interlock present”** should be printed on
the camonitor terminal for the top level
appy record.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After clearing the interlock and issuing the</dt>
<dd>apply on any number of marked command,
there should be no messages returned and
all commands should process.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-103-03-cadrecord-1">
<span id="id134"></span><h3>3.5.6 REQ-103-03 cadRecord<a class="headerlink" href="#req-103-03-cadrecord-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminals each configured</dt>
<dd>as described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id135"><span class="problematic" id="id136">`</span></a>3.5.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness-2&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id137"><span class="problematic" id="id138">`</span></a>3.5.3 Diagnostic</dt>
<dd>Screens &lt;#diagnostic-screens-1&gt;`__ for
Gemini Records Test Screen (GRTS)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id139"><span class="problematic" id="id140">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__ for iocStats</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The Apply record in the previous section is</dt>
<dd>really brokering the processing of a
sequence CAD records. That’s a sequence of
Command Action Directives. A CAD record
will process its command with a subroutine
(defined in the SNAM field) and possibly
reject the command if error conditions are
encountered. For example, the
testConfigBegin CAD record is the first
record in the testSequenceCommands
schematic. If the interlock (discussed in
the previous section ) is in the INTERLOCK
state, the testConfigBegin() is rejected
and the corresponding MESS is returned to
the Apply record. Process any command in
the GRTS to see the states printed in the
ioc terminal.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>By using the GRTS to process commands and</dt>
<dd>using the interlock to invalidate the
processing, you should see the respective
messages on the IOC console. This verifies
the CAD subroutine is working and printing
each directive.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-103-04-carrecord-1">
<span id="id141"></span><h3>3.5.7 REQ-103-04 carRecord<a class="headerlink" href="#req-103-04-carrecord-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminals each configured</dt>
<dd>as described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id142"><span class="problematic" id="id143">`</span></a>3.5.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness-2&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id144"><span class="problematic" id="id145">`</span></a>3.5.3 Diagnostic</dt>
<dd>Screens &lt;#diagnostic-screens-1&gt;`__ for
Gemini Records Test Screen (GRTS)</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id146"><span class="problematic" id="id147">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__ for iocStats</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Xycom-240 set for no interlocking: in IOC</dt>
<dd>console, type ‘xy240_dio_out(0,4,2)’</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Mark one of the commands in the OBSERVE</dt>
<dd>section on the GRTS, then press the APPLY
button.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Verify that the state of OBSERVE on the GRTS</dt>
<dd>changes from IDLE to BUSY, then back to
IDLE.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-103-05-sirrecord-1">
<span id="id148"></span><h3>3.5.8 REQ-103-05 sirRecord<a class="headerlink" href="#req-103-05-sirrecord-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminals each configured</dt>
<dd>as described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id149"><span class="problematic" id="id150">`</span></a>3.5.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness-2&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id151"><span class="problematic" id="id152">`</span></a>3.3.3 IOC Diagnostic</dt>
<dd>Screens &lt;#_rfm0gwxetqz&gt;`__ for iocStats</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Xycom-240 set for no interlocking: in IOC</dt>
<dd>console, type ‘xy240_dio_out(0,4,2)’</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>In first Linux host terminal, run ‘camonitor</dt>
<dd>grt:SAD:interlockSadState
grt:SAD:interlockSadState.OMSS’</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In second Linux host terminal run ‘caput</dt>
<dd>grt:SAD:interlockSadState.IMSS “test
message” ’</dd>
</dl>
</li>
<li>In IOC console, type ‘xy240_dio_out(0,4,1)’</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-103-06-cmdtimeoutrecord-1">
<span id="id153"></span><h3>3.5.9 REQ-103-06 cmdTimeoutRecord<a class="headerlink" href="#req-103-06-cmdtimeoutrecord-1" title="Permalink to this headline">¶</a></h3>
<p>This record is not described in the Gemini Records Reference Manual, and
no examples exist in the test harness database. Is it used anywhere?</p>
<p>Procedure
Success Criteria
================</p>
</div>
<div class="section" id="req-103-07-loadrecord-1">
<span id="id154"></span><h3>3.5.10 REQ-103-07 loadRecord<a class="headerlink" href="#req-103-07-loadrecord-1" title="Permalink to this headline">¶</a></h3>
<p>Note: This record is intended to used to load programs into PMAC cards,
but is not actually used by Gemini.</p>
<p>We will not test this record at this time.</p>
<p>Procedure
Success Criteria
================</p>
</div>
<div class="section" id="req-103-08-lutinrecord-1">
<span id="id155"></span><h3>3.5.11 REQ-103-08 lutinRecord<a class="headerlink" href="#req-103-08-lutinrecord-1" title="Permalink to this headline">¶</a></h3>
<p>Procedure
Success Criteria
================</p>
</div>
<div class="section" id="req-103-09-lutoutrecord-1">
<span id="id156"></span><h3>3.5.12 REQ-103-09 lutoutRecord<a class="headerlink" href="#req-103-09-lutoutrecord-1" title="Permalink to this headline">¶</a></h3>
<p>Procedure
Success Criteria
================</p>
</div>
<div class="section" id="req-103-10-statusrecord-1">
<span id="id157"></span><h3>3.5.13 REQ-103-10 statusRecord<a class="headerlink" href="#req-103-10-statusrecord-1" title="Permalink to this headline">¶</a></h3>
<p>Procedure
Success Criteria
================</p>
</div>
</div>
<div class="section" id="pvload-1">
<span id="id158"></span><h2>3.6 Pvload<a class="headerlink" href="#pvload-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-3">
<span id="id159"></span><h3>3.6.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-3" title="Permalink to this headline">¶</a></h3>
<p>There are no peripheral hardware tests for this module. You only need to
prepare a CPU board as described in <a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup</a>.</p>
</div>
<div class="section" id="epics-test-harness-3">
<span id="id160"></span><h3>3.6.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-3" title="Permalink to this headline">¶</a></h3>
<p>The pvload library does not have a native test harness. However, all
IOC’s will contain an identity record in the &lt;ioc&gt;App/Db directory which
is to be maintained with the corresponding &lt;ioc&gt;App/config/identity.pv
file. Below you can see how the record is defined with substitutions and
template files.</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">[gemtest1-MKApp/Db]&gt; cat identity.substitutions</p>
<p>file identity.template</p>
<p>{</p>
<p>pattern { IOCNAME }</p>
<p>{ $(IOC) }</p>
<p class="last">}</p>
</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">[gemtest1-MKApp/Db]&gt; cat identity.template</p>
<p>record(stringin, “$(IOCNAME):identity”) {</p>
<p>field(DESC, “Version of this IOC”)</p>
<p>field(DTYP, “Soft Channel”)</p>
<p>field(PINI, “YES”)</p>
<p class="last">}</p>
</td>
</tr>
</tbody>
</table>
<div class="section" id="add-the-identity-db-to-gemtest1-mkapp-db-makefile">
<h4>3.6.2.1 Add the identity.db to gemtest1-MKApp/Db/Makefile<a class="headerlink" href="#add-the-identity-db-to-gemtest1-mkapp-db-makefile" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">DEPSCHS = $(wildcard ../<a href="#id161"><span class="problematic" id="id162">*</span></a>.sch)</p>
<p>…</p>
<p class="last">DB += identity.db</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-library-to-gemtest1-mkapp-src-makefile">
<h4>3.6.2.2 Add the library to gemtest1-MKApp/src/Makefile<a class="headerlink" href="#add-the-library-to-gemtest1-mkapp-src-makefile" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-MK_DBD += pvload.dbd</p>
<p>…</p>
<p class="last">gemtest1-MK_LIBS += pvload</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-2">
<span id="id163"></span><h4>3.6.2.3 Startup Script<a class="headerlink" href="#startup-script-2" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-MK</p>
<p>cd ${INSTALL}</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”&lt;YOUR NAME&gt;”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/gemtest1-MK.dbd”)</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p>dbLoadRecords(“db/identity.db”, “IOC=gemtest1-MK”)</p>
<p>iocInit</p>
<p class="last">pvload “./data/identity.pv”, “IOC=gemtest1-MK:”</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-104-01-identity-record-1">
<span id="id164"></span><h3>3.6.3 REQ-104-01 Identity Record<a class="headerlink" href="#req-104-01-identity-record-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt><a href="#id165"><span class="problematic" id="id166">`</span></a>3.6.1 Test Setup and</dt>
<dd>Pr</dd>
</dl>
</li>
</ol>
<p>erequisites &lt;#test-setup-and-prerequisites-3&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt><a href="#id167"><span class="problematic" id="id168">`</span></a>3.6.2 EPICS Test</dt>
<dd>Harness &lt;#epics-test-harness-3&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot the test IOC and load the identity PV</dt>
<dd>file as described in the prerequisites.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Print out the identity record attributes with</dt>
<dd>dbpr.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>The IOC boots without error and loads the</dt>
<dd>identity.pv file</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Confirm the value defined in the identity.pv</dt>
<dd>file agrees with the VAL field of the
record shown below in red.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbpr gemtest1-MK:identity</p>
<p>ASG: DESC: Version of this IOC DISA: 0</p>
<p>DISP: 0 DISV: 1 NAME: gemtest1-MK:identity</p>
<p>SEVR: NO_ALARM STAT: NO_ALARM SVAL: TPRO: 0</p>
<p class="last">VAL: 1-1</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-104-02-legacy-pvload-files-1">
<span id="id169"></span><h3>3.6.4 REQ-104-02 Legacy pvload files<a class="headerlink" href="#req-104-02-legacy-pvload-files-1" title="Permalink to this headline">¶</a></h3>
<p>The requirement to support legacy pvload files must be tested
incrementally for each telescope system.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Prepare all hardware and boot IOC including</dt>
<dd>legacy pv files.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot the test IOC and load the legacy PV</dt>
<dd>file.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The legacy pvload file successfully populates</dt>
<dd>all records.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="bancomm-1">
<span id="id170"></span><h2>3.7 Bancomm<a class="headerlink" href="#bancomm-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-4">
<span id="id171"></span><h3>3.7.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-4" title="Permalink to this headline">¶</a></h3>
<p>Setup your test Bancomm 635 or 637 with the proper jumper and switch
setting to define the base address. The base address for Gemini boards
will be 0x4000 . Base address selection for the VMEbus requires the
setting of switch SW1 (A6 through A13) and SW2 (A14 and A15). So, for
the 0x4000 we want 0100 0000 00 for the A15 through A6 respectively.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="16%" />
<col width="27%" />
<col width="27%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Hex value</th>
<th class="head">Switch SW1/pins</th>
<th class="head">Swithc SW2/pins</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Base Address</td>
<td>0x4000</td>
<td>01</td>
<td>0000 0000</td>
</tr>
<tr class="row-odd"><td>Supervisory Mode</td>
<td>???</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Interrupt Level</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="epics-test-harness-4">
<span id="id172"></span><h3>3.7.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-4" title="Permalink to this headline">¶</a></h3>
<p>The bancomm driver is equipped with a set of EPICS records which can be
loaded during startup and used for testing. The database can be viewed
in bancommApp/Db/bctest.sch. Open in tdct like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>[bancommApp/Db]&gt;tdct -cfg ./tdct.cfg -i bctest.sch</td>
</tr>
</tbody>
</table>
<div class="section" id="add-the-bctest-db">
<h4>3.7.2.1 Add the bctest.db<a class="headerlink" href="#add-the-bctest-db" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first"># Create and install (or just install) into &lt;top&gt;/db</p>
<p># databases, templates, substitutions like this</p>
<p>#TDCT_CFG = ../tdct.cfg</p>
<p>DEPSCHS = $(wildcard ../<a href="#id173"><span class="problematic" id="id174">*</span></a>.sch)</p>
<p>DB += bctest.db</p>
<p class="last">DB += iocAdminRTEMS.db</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-libraries-1">
<span id="id175"></span><h4>3.7.2.2 Add the libraries<a class="headerlink" href="#add-the-libraries-1" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">###DBD_FILE########Bancomm-Section############</p>
<p>gemtest1-MK_DBD += bancomm.dbd</p>
<p>###DBD_FILE#######IOCSTATS-Section############</p>
<p>gemtest1-MK_DBD += iocAdmin.dbd</p>
<p>###LIB##########BANCOMM-Section#################</p>
<p>gemtest1-MK_LIBS += bancomm</p>
<p>###LIB#######IOCSTATS-Section#################</p>
<p class="last">gemtest1-MK_LIBS += devIocStats</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-3">
<span id="id176"></span><h4>3.7.2.3 Startup Script<a class="headerlink" href="#startup-script-3" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-MK</p>
<p>cd ${INSTALL}</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”&lt;YOUR NAME&gt;”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p># Configure the time system</p>
<p># Master ? Simulate ? intPerSecond, intPerTick, timeOffset
(microsec)</p>
<p>BCconfigure (0, 1, 80, 1, 0)</p>
<p>## Load record instances</p>
<p>dbLoadRecords(“db/bctest.db”, “ top=gemtest1-MK”)</p>
<p>dbLoadRecords(“db/iocAdminRTEMS.db”,
“IOC=gemtest1-MK,TODFORMAT=%m/%d/%Y %H:%M:%S”)</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-105-01-initialize-1">
<span id="id177"></span><h3>3.7.3 REQ-105-01 Initialize<a class="headerlink" href="#req-105-01-initialize-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your IOC and CPU board are setup</dt>
<dd>as described in<a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure that your Bancomm board is setup as</dt>
<dd>described in<a href="#id178"><span class="problematic" id="id179">`</span></a>3.7.1 Test Setup and
Pre</dd>
</dl>
</li>
</ol>
<p>requisites &lt;#test-setup-and-prerequisites-4&gt;`__.</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Bancomm as</dt>
<dd>described in <a class="reference external" href="#epics-test-harness-4">3.7.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Additionally, prepare your IOC to use the</dt>
<dd>IOCstats libraries and as described in
<a class="reference external" href="#ioc-stats">3.3 IOC-Stats</a>.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Boot the IOC and confirm the startup script</dt>
<dd>fully executes.</dd>
</dl>
</li>
<li>Run the ‘date’ command on the IOC.</li>
<li><dl class="first docutils">
<dt>Run the ‘generalTimeReport 10’ command on the</dt>
<dd>IOC</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Run the iocstats diagnostic screen from a</dt>
<dd>Linux terminal.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>linux$ gem-iocstats.py gemtest1-MK</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li>The IOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The BCconfigure() will have initialized the</dt>
<dd>Bancomm driver with no reported errors.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will have run with no</dt>
<dd>errors.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The date command will show the correct</dt>
<dd>current date and a time of day
corresponding to the numbers on the front
panel of the Bancomm board.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The generalTimeReport will show all</dt>
<dd>registered EPICS time providers, the first
of which shall be the Bancomm driver and
will be the highest priority.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The Bancomm driver will be reported as the</dt>
<dd>current time provider for the IOC.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; generalTimeReport 10</p>
<p>Backwards time errors prevented 410 times.</p>
<p>Current Time Providers:</p>
<p>“bc635”, priority = 20</p>
<p>Current Time is 2016-01-01 00:01:54.375971.</p>
<p>“NTP”, priority = 100</p>
<p>Current Time is 2016-05-11 20:35:09.862574.</p>
<p>“OS Clock”, priority = 999</p>
<p>Current Time is 2001-01-01 00:00:29.652200.</p>
<p>Event Time Providers:</p>
<p class="last">No Providers registered.</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="7">
<li><dl class="first docutils">
<dt>The iocStats diagnostic screen shall show the</dt>
<dd>same information as above and the
heartbeat and all update fields will be
green and active.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-105-02-epics-report-1">
<span id="id180"></span><h3>3.7.4 REQ-105-02 EPICS Report<a class="headerlink" href="#req-105-02-epics-report-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id181"><span class="problematic" id="id182">`</span></a>3.7.3 REQ-105-01 Bancomm</dt>
<dd>Initialize &lt;#req-105-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>This test is executed as part of the</dt>
<dd>initialize test above.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>When the Bancomm board initializes it</dt>
<dd>registers a report routine with EPICS. The
warning is currently acceptable.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvBc635 1</p>
<p>Driver: drvBc635</p>
<p>Warning: bspExtMemProbe kills real-time
performance.</p>
<p>use only during driver initialization</p>
<p>clear the ‘bspExtVerbosity’ variable to
silence this warning</p>
<p>Bancomm 635 board at address 0x4000</p>
<p class="last">TFP is flywheeling (not locked)</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-105-03-analog-input-record-scan-i-o-inter-support">
<h3>3.7.5 REQ-105-03 Analog Input Record (Scan I/O Inter Support)<a class="headerlink" href="#req-105-03-analog-input-record-scan-i-o-inter-support" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open a Linux terminal as described in <a href="#id183"><span class="problematic" id="id184">`</span></a>3.1</dt>
<dd>Linux Host Setup &lt;#linux-host-setup&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id185"><span class="problematic" id="id186">`</span></a>3.7.3 REQ-105-01 Bancomm</dt>
<dd>Initialize &lt;#req-105-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the IOC has boot successfully, verify</dt>
<dd>the Interrupts are enabled by viewing the
console messages.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In order to enable the TOD interrupt enter in</dt>
<dd>the linux terminal set the number of
seconds in the day by writing to the
timesecs record. The TOD record will
process with your input and update the
strobe registers as a result. The value
should be to something between 0.0 and
86399.999</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput gemtest1-MK:timesecs 82360.251</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The TOD interrupt Record will receive an</dt>
<dd>interrupt when the defined number of
second of the day happens.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-105-04-analog-output-record">
<h3>3.7.6 REQ-105-04 Analog Output Record<a class="headerlink" href="#req-105-04-analog-output-record" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open a Linux terminal as described in <a href="#id187"><span class="problematic" id="id188">`</span></a>3.1</dt>
<dd>Linux Host Setup &lt;#linux-host-setup&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id189"><span class="problematic" id="id190">`</span></a>3.7.3 REQ-105-01 Bancomm</dt>
<dd>Initialize &lt;#req-105-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the IOC has boot successfully, verify</dt>
<dd>the Interrupts are enabled by viewing the
console messages.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In the linux terminal set the number of</dt>
<dd>seconds in the day by writing to the
timesecs record. The TOD record will
process with your input and update the
strobe registers as a result. The value
should be to something between 0.0 and
86399.999</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput gemtest1-MK:timesecs 82360.251</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Both external event interrupts and time of</dt>
<dd>day interrupts are enabled (shown below in
red).</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">…</p>
<p>iocInit</p>
<p>Starting iocInit</p>
<p>## EPICS R3.14.12.4 $Date: Mon 2013-12-16
15:51:45 -0600$</p>
<p>## EPICS Base built Oct 24 2014</p>
<p>BC635 driver : external event interrupts
enabled</p>
<p>BC635 driver : time of day interrupts
enabled</p>
<p class="last">iocRun: All initialization complete</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt>As a result of inserting a new time in the</dt>
<dd>strobe registers, you can see the
TODinterrupt</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-105-05-string-input-record-scan-i-o-inter-support">
<h3>3.7.7 REQ-105-05 String Input Record (Scan I/O Inter Support)<a class="headerlink" href="#req-105-05-string-input-record-scan-i-o-inter-support" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open a Linux terminal as described in <a href="#id191"><span class="problematic" id="id192">`</span></a>3.1</dt>
<dd>Linux Host Setup &lt;#linux-host-setup&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id193"><span class="problematic" id="id194">`</span></a>3.7.3 REQ-105-01 Bancomm</dt>
<dd>Initialize &lt;#req-105-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the IOC has boot successfully, verify</dt>
<dd>the Interrupts are enabled by viewing the
console messages.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Change the SCAN I/O Intr to Passive because a</dt>
<dd>system exception happens using I/O
interrupt..</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Query the value in the string input EPICS</dt>
<dd>channel rtd9timestamp to verify the time
read from the Bancomm card.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ caget rtd9timestamp</p>
<p class="last">rtd9timestamp 2016/09/08 15:46:54.020072</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Verify that the time matches with the time</dt>
<dd>displayed in the Bancom card.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-105-06-string-output-record">
<h3>3.7.8 REQ-105-06 String Output Record<a class="headerlink" href="#req-105-06-string-output-record" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open a Linux terminal as described in <a href="#id195"><span class="problematic" id="id196">`</span></a>3.1</dt>
<dd>Linux Host Setup &lt;#linux-host-setup&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id197"><span class="problematic" id="id198">`</span></a>3.7.3 REQ-105-01 Bancomm</dt>
<dd>Initialize &lt;#req-105-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li>This record is not used at Gemini</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li>N/A</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="timelib-1">
<span id="id199"></span><h2>3.8 Timelib<a class="headerlink" href="#timelib-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-5">
<span id="id200"></span><h3>3.8.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-5" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="epics-test-harness-5">
<span id="id201"></span><h3>3.8.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-5" title="Permalink to this headline">¶</a></h3>
<p>The Timelib driver does not need any EPICS record to be loaded at
startup. This test configures a Bancomm card calling the timeClockInit
function and uses the timeTest program for the timenow function call.</p>
<div class="section" id="add-the-libraries-2">
<span id="id202"></span><h4>3.8.2.1 Add the libraries<a class="headerlink" href="#add-the-libraries-2" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">labvme9-sbf-ioc_DBD = timelib.dbd</p>
<p>…….</p>
<p>labvme9-sbf-ioc_LIBS = timelib</p>
<p>labvme9-sbf-ioc_SRCS += testtime.c</p>
<p class="last">DBD += testtime.dbd</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-4">
<span id="id203"></span><h4>3.8.2.2 Startup Script<a class="headerlink" href="#startup-script-4" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/labvme9-sbf-ioc</p>
<p>cd ${INSTALL}</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/labvme9-sbf-ioc.dbd”)</p>
<p>dbLoadDatabase(“dbd/testtime.dbd”)</p>
<p>labvme9_sbf_ioc_registerRecordDeviceDriver(pdbbase)</p>
<p># Configure the time system</p>
<p>timeClockInit (1, 0, 60, 1, 0)</p>
<p>## Load record instances</p>
<p>dbLoadRecords(“db/iocAdminRTEMS.db”,” IOC=rtd9,TODFORMAT=%m/%d/%Y
%H:%M:%S”)</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-106-01-timenow-1">
<span id="section-5"></span><span id="section-4"></span><span id="id204"></span><h3>3.8.3 REQ-106-01 timeNow<a class="headerlink" href="#req-106-01-timenow-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id205"><span class="problematic" id="id206">`</span></a>Test Setup and</dt>
<dd>Prerequisites &lt;#epics-test-harness-5&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id207"><span class="problematic" id="id208">`</span></a>EPICS Test</dt>
<dd>harness &lt;#epics-test-harness-5&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li>The IOC must show no errors at the startup</li>
<li><dl class="first docutils">
<dt>Enter the help shell command and verify the</dt>
<dd>testTimestamps command is available in the
list of shell commands. This confirms the
command is successfully initialized and
ready to be used.</dd>
</dl>
</li>
<li>Enter the command:</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ testTimestamps</p>
<p>Time now as double in testTimestamps() =
1473340592.470013</p>
<p class="last">Time now as hmsf in testTimestamps() =
13:16:31.4700</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Verify that the time now as hmsf format</dt>
<dd>matches the time displayed in the Bancomm
card.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-106-02-timeclockinit-1">
<span id="id209"></span><h3>3.8.4 REQ-106-02 timeClockInit<a class="headerlink" href="#req-106-02-timeclockinit-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id210"><span class="problematic" id="id211">`</span></a>Test Setup and</dt>
<dd>Prerequisites &lt;#epics-test-harness-5&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id212"><span class="problematic" id="id213">`</span></a>EPICS Test</dt>
<dd>harness &lt;#epics-test-harness-5&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li>The IOC must show no errors at the startup</li>
<li><dl class="first docutils">
<dt>Check the VME startup messages when the</dt>
<dd>timeClockInit function is executed.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Verify that the Bancomm card is configured</dt>
<dd>properly at startup.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first"># Configure the time system</p>
<p># Master ? Simulate ? intPerSecond,
intPerTick, timeOffset (microsec)</p>
<p>timeClockInit (1, 0, 60, 1, 0)</p>
<p>BC635 setup: initial clock tick frequency:
50</p>
<p>BC635 Time Provider registered</p>
<p>priority = 20</p>
<p>Flywheeling (not locked to reference)</p>
<p>Last successful sync was at 1990-01-01
00:00:01.000000</p>
<p>Bancomm interrupt frequency set to 60.001
Hz</p>
<p class="last">System clock frequency = 60.001 Hz</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="slalib-1">
<span id="id214"></span><h2>3.9 Slalib<a class="headerlink" href="#slalib-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-6">
<span id="id215"></span><h3>3.9.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-6" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="epics-test-harness-6">
<span id="id216"></span><h3>3.9.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-6" title="Permalink to this headline">¶</a></h3>
<p>The Slalib library does not need any EPICS record that can be loaded
during startup or for testing purposes. It must used with other CCB
components or new modules.</p>
<div class="section" id="add-the-slalib-dbd-file-and-library">
<h4>3.9.2.1 Add the Slalib DBD file and library<a class="headerlink" href="#add-the-slalib-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">labvme8-CP-ioc_DBD += slalib.dbd</p>
<p>….</p>
<p class="last">labvme8-CP-ioc_LIBS += slalib</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-5">
<span id="id217"></span><h4>3.9.2.2 Startup Script<a class="headerlink" href="#startup-script-5" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/labvme8-CP-ioc</p>
<p>cd ${INSTALL}</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/labvme8-CP-ioc.dbd”)</p>
<p>labvme8_CP_ioc_registerRecordDeviceDriver(pdbbase)</p>
<p>## Load record instances</p>
<p>#dbLoadTemplate(“db/labvme8-CP-ioc.substitutions”)</p>
<p>#dbLoadRecords(“db/labvme8-CP-ioc.db”, “user=username”)</p>
<p>iocInit</p>
<p>## Start any sequence programs</p>
<p class="last">#seq(sncxxx, “user=username”)</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install">
<h4>3.9.2.3 Build and Install<a class="headerlink" href="#build-and-install" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd labvme8/CP</p>
<p class="last">$ make distclean uninstall; make</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-107-01-slalib-ade-compatibility-1">
<span id="id218"></span><h3>3.9.3 REQ-107-01 Slalib ADE Compatibility<a class="headerlink" href="#req-107-01-slalib-ade-compatibility-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id219"><span class="problematic" id="id220">`</span></a>3.9.1 Test Setup and</li>
</ol>
<blockquote class="last">
<div>Prerequisites &lt;#test-setup-and-prerequisites-6&gt;`__</div></blockquote>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Edit configure/RELEASE to put in correct paths</dt>
<dd>for dependencies:</dd>
</dl>
</li>
</ol>
<p>WORKSUP = /gem_sw/work/R3.14.12.4/support</p>
<p>PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>SLALIB=$(PRODSUP)/slalib/1-9-5</p>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Add dependencies to</dt>
<dd>labvme8/CP/labvme8-CP-iocApp/src/Makefile</dd>
</dl>
</li>
</ol>
<p>labvme8-CP-ioc_DBD += slalib.dbd</p>
<p>labvme8-CP-ioc_LIBS += slalib</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt><a href="#id221"><span class="problematic" id="id222">`</span></a>Build and Install the</dt>
<dd>module. &lt;#build-and-install&gt;`__</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The Slalib library shall be compatible with the</dt>
<dd>Application Development Environment (ADE ),
and build without errors or warnings.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-107-02-slalib-available-for-linking-1">
<span id="id223"></span><h3>3.9.4 REQ-107-02 Slalib Available for Linking<a class="headerlink" href="#req-107-02-slalib-available-for-linking-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt><a href="#id224"><span class="problematic" id="id225">`</span></a>3.9.1 Test Setup and</dt>
<dd>Pr</dd>
</dl>
</li>
</ol>
<p class="last">erequisites &lt;#test-setup-and-prerequisites-6&gt;`__</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Edit configure/RELEASE to put in correct</dt>
<dd>paths for all library dependencies:</dd>
</dl>
</li>
</ol>
<p>WORKSUP = /gem_sw/work/R3.14.12.4/support</p>
<p>PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>IOCSTATS=$(PRODSUP)/iocStats/3-1-14-2</p>
<p>SNCSEQ=$(PRODSUP)/seq/2-2-3-1</p>
<p>GEMREC=$(PRODSUP)/geminiRec/4-0-1</p>
<p>PVLOAD=$(PRODSUP)/pvload/1-1-1</p>
<p>SLALIB=$(PRODSUP)/slalib/1-9-5</p>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Add dependencies to</dt>
<dd>labvme8/CP/labvme8-CP-iocApp/src/Makefile</dd>
</dl>
</li>
</ol>
<p>labvme8-CP-ioc_DBD += base.dbd</p>
<p>labvme8-CP-ioc_DBD += iocAdmin.dbd</p>
<p>labvme8-CP-ioc_DBD += geminiRecords.dbd</p>
<p>labvme8-CP-ioc_DBD += pvload.dbd</p>
<p>labvme8-CP-ioc_DBD += slalib.dbd</p>
<p>labvme8-CP-ioc_LIBS += devIocStats</p>
<p>labvme8-CP-ioc_LIBS += seq pv</p>
<p>labvme8-CP-ioc_LIBS += geminiRecords</p>
<p>labvme8-CP-ioc_LIBS += pvload</p>
<p>labvme8-CP-ioc_LIBS += slalib</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt><a href="#id226"><span class="problematic" id="id227">`</span></a>Build and Install the</dt>
<dd>module. &lt;#build-and-install&gt;`__</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The slalib library shall be available for</dt>
<dd>linking and testing with other CCB
components.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="astlib-1">
<span id="id228"></span><h2>3.10 Astlib<a class="headerlink" href="#astlib-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-7">
<span id="id229"></span><h3>3.10.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-7" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="epics-test-harness-7">
<span id="id230"></span><h3>3.10.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-7" title="Permalink to this headline">¶</a></h3>
<p>The Astlib library does not need any EPICS record that can be loaded
during startup or for testing purposes. It must used with other CCB
components or new modules.</p>
<div class="section" id="add-the-astlib-dbd-file-and-library">
<h4>3.10.2.1 Add the Astlib DBD file and library<a class="headerlink" href="#add-the-astlib-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">labvme8-CP-ioc_DBD += astlib.dbd</p>
<p>….</p>
<p class="last">labvme8-CP-ioc_LIBS += astlib</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-6">
<span id="id231"></span><h4>3.10.2.2 Startup Script<a class="headerlink" href="#startup-script-6" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/labvme8-CP-ioc</p>
<p>cd ${INSTALL}</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/labvme8-CP-ioc.dbd”)</p>
<p>labvme8_CP_ioc_registerRecordDeviceDriver(pdbbase)</p>
<p>## Load record instances</p>
<p>#dbLoadTemplate(“db/labvme8-CP-ioc.substitutions”)</p>
<p>#dbLoadRecords(“db/labvme8-CP-ioc.db”, “user=username”)</p>
<p>iocInit</p>
<p>## Start any sequence programs</p>
<p class="last">#seq(sncxxx, “user=username”)</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install-1">
<span id="id232"></span><h4>3.10.2.3 Build and Install<a class="headerlink" href="#build-and-install-1" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd labvme8/CP</p>
<p class="last">$ make distclean uninstall; make</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-107-01-astlib-ade-compatibility">
<h3>3.9.3 REQ-107-01 Astlib ADE Compatibility<a class="headerlink" href="#req-107-01-astlib-ade-compatibility" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id233"><span class="problematic" id="id234">`</span></a>3.10.1 Test Setup and</li>
</ol>
<blockquote class="last">
<div>Prerequisites &lt;#test-setup-and-prerequisites-7&gt;`__</div></blockquote>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Edit configure/RELEASE to put in correct paths</dt>
<dd>for dependencies:</dd>
</dl>
</li>
</ol>
<p>WORKSUP = /gem_sw/work/R3.14.12.4/support</p>
<p>PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>ASTLIB=$(PRODSUP)/astlib/1-6-2</p>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Add dependencies to</dt>
<dd>labvme8/CP/labvme8-CP-iocApp/src/Makefile</dd>
</dl>
</li>
</ol>
<p>labvme8-CP-ioc_DBD += astlib.dbd</p>
<p>labvme8-CP-ioc_LIBS += astlib</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt><a href="#id235"><span class="problematic" id="id236">`</span></a>Build and Install the</dt>
<dd>module. &lt;#build-and-install-1&gt;`__</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The Astlib library shall be compatible with the</dt>
<dd>Application Development Environment (ADE ),
and build without errors or warnings.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-107-02-astlib-available-for-linking">
<h3>3.10.4 REQ-107-02 Astlib Available for Linking<a class="headerlink" href="#req-107-02-astlib-available-for-linking" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt><a href="#id237"><span class="problematic" id="id238">`</span></a>3.10.1 Test Setup and</dt>
<dd>Pr</dd>
</dl>
</li>
</ol>
<p class="last">erequisites &lt;#test-setup-and-prerequisites-7&gt;`__</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Edit configure/RELEASE to put in correct</dt>
<dd>paths for all library dependencies:</dd>
</dl>
</li>
</ol>
<p>WORKSUP = /gem_sw/work/R3.14.12.4/support</p>
<p>PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>IOCSTATS=$(PRODSUP)/iocStats/3-1-14-2</p>
<p>SNCSEQ=$(PRODSUP)/seq/2-2-3-1</p>
<p>GEMREC=$(PRODSUP)/geminiRec/4-0-1</p>
<p>PVLOAD=$(PRODSUP)/pvload/1-1-1</p>
<p>ASTLIB=$(PRODSUP)/astlib/1-6-2</p>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Add dependencies to</dt>
<dd>labvme8/CP/labvme8-CP-iocApp/src/Makefile</dd>
</dl>
</li>
</ol>
<p>labvme8-CP-ioc_DBD += base.dbd</p>
<p>labvme8-CP-ioc_DBD += iocAdmin.dbd</p>
<p>labvme8-CP-ioc_DBD += geminiRecords.dbd</p>
<p>labvme8-CP-ioc_DBD += pvload.dbd</p>
<p>labvme8-CP-ioc_DBD += astlib.dbd</p>
<p>labvme8-CP-ioc_LIBS += devIocStats</p>
<p>labvme8-CP-ioc_LIBS += seq pv</p>
<p>labvme8-CP-ioc_LIBS += geminiRecords</p>
<p>labvme8-CP-ioc_LIBS += pvload</p>
<p>labvme8-CP-ioc_LIBS += astlib</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt><a href="#id239"><span class="problematic" id="id240">`</span></a>Build and Install the</dt>
<dd>module. &lt;#build-and-install-1&gt;`__</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The astlib library shall be available for</dt>
<dd>linking and testing with other CCB
components.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="asyn-1">
<span id="id241"></span><h2>3.11 Asyn<a class="headerlink" href="#asyn-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-8">
<span id="id242"></span><h3>3.11.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-8" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="epics-test-harness-8">
<span id="id243"></span><h3>3.11.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-8" title="Permalink to this headline">¶</a></h3>
<p>Th ASYN driver is an EPICS community package which has been tested and
probed to work properIy with RTEMS. The ASYN driver validation consists
on check their ADE compatibility and the availability to be linked to
other CCB components.</p>
<div class="section" id="add-the-asyn-dbd-file-and-library">
<h4>3.11.2.1 Add the ASYN DBD file and library<a class="headerlink" href="#add-the-asyn-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">labvme8-CP-ioc_DBD += asyn.dbd</p>
<p>….</p>
<p class="last">labvme8-CP-ioc_LIBS += asyn</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-7">
<span id="id244"></span><h4>3.11.2.2 Startup Script<a class="headerlink" href="#startup-script-7" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/labvme8-CP-ioc</p>
<p>cd ${INSTALL}</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/labvme8-CP-ioc.dbd”)</p>
<p>labvme8_CP_ioc_registerRecordDeviceDriver(pdbbase)</p>
<p>## Load record instances</p>
<p>#dbLoadTemplate(“db/labvme8-CP-ioc.substitutions”)</p>
<p>#dbLoadRecords(“db/labvme8-CP-ioc.db”, “user=username”)</p>
<p>iocInit</p>
<p>## Start any sequence programs</p>
<p class="last">#seq(sncxxx, “user=username”)</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install-2">
<span id="id245"></span><h4>3.11.2.3 Build and Install<a class="headerlink" href="#build-and-install-2" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd labvme8/CP</p>
<p class="last">$ make distclean uninstall; make</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-109-01-asyn-ade-compatibility-1">
<span id="id246"></span><h3>3.11.3 REQ-109-01 ASYN ADE Compatibility<a class="headerlink" href="#req-109-01-asyn-ade-compatibility-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id247"><span class="problematic" id="id248">`</span></a>3.11.1 Test Setup and</li>
</ol>
<blockquote class="last">
<div>Prerequisites &lt;#test-setup-and-prerequisites-8&gt;`__</div></blockquote>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Edit configure/RELEASE to put in correct paths</dt>
<dd>for dependencies:</dd>
</dl>
</li>
</ol>
<p>WORKSUP = /gem_sw/work/R3.14.12.4/support</p>
<p>PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>ASYN=$(PRODSUP)/asyn/4-29-1-0</p>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Add dependencies to</dt>
<dd>labvme8/CP/labvme8-CP-iocApp/src/Makefile</dd>
</dl>
</li>
</ol>
<p>labvme8-CP-ioc_DBD += asyn.dbd</p>
<p>labvme8-CP-ioc_LIBS += asyn</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt><a href="#id249"><span class="problematic" id="id250">`</span></a>Build and Install the</dt>
<dd>module &lt;#build-and-install-2&gt;`__.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The ASYN driver shall be compatible with the</dt>
<dd>Application Development Environment (ADE ),
and build without errors or warnings.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-109-02-asyn-available-for-linking">
<h3>3.11.4 REQ-109-02 ASYN Available for Linking<a class="headerlink" href="#req-109-02-asyn-available-for-linking" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt><a href="#id251"><span class="problematic" id="id252">`</span></a>3.11.1 Test Setup and</dt>
<dd>Pr</dd>
</dl>
</li>
</ol>
<p class="last">erequisites &lt;#test-setup-and-prerequisites-8&gt;`__</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Edit configure/RELEASE to put in correct</dt>
<dd>paths for all library dependencies:</dd>
</dl>
</li>
</ol>
<p>WORKSUP = /gem_sw/work/R3.14.12.4/support</p>
<p>PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>IOCSTATS=$(PRODSUP)/iocStats/3-1-14-2</p>
<p>SNCSEQ=$(PRODSUP)/seq/2-2-3-1</p>
<p>GEMREC=$(PRODSUP)/geminiRec/4-0-1</p>
<p>PVLOAD=$(PRODSUP)/pvload/1-1-1</p>
<p>ASYN=$(PRODSUP)/4-29-1-0</p>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Add dependencies to</dt>
<dd>labvme8/CP/labvme8-CP-iocApp/src/Makefile</dd>
</dl>
</li>
</ol>
<p>labvme8-CP-ioc_DBD += base.dbd</p>
<p>labvme8-CP-ioc_DBD += iocAdmin.dbd</p>
<p>labvme8-CP-ioc_DBD += geminiRecords.dbd</p>
<p>labvme8-CP-ioc_DBD += pvload.dbd</p>
<p>labvme8-CP-ioc_DBD += asyn.dbd</p>
<p>labvme8-CP-ioc_LIBS += devIocStats</p>
<p>labvme8-CP-ioc_LIBS += seq pv</p>
<p>labvme8-CP-ioc_LIBS += geminiRecords</p>
<p>labvme8-CP-ioc_LIBS += pvload</p>
<p>labvme8-CP-ioc_LIBS += asyn</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt><a href="#id253"><span class="problematic" id="id254">`</span></a>Build and Install the</dt>
<dd>module. &lt;#build-and-install-1&gt;`__</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The ASYN driver shall be available for</dt>
<dd>linking and testing with other CCB
components.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="streamdevice-1">
<span id="id255"></span><h2>3.12 StreamDevice<a class="headerlink" href="#streamdevice-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-9">
<span id="id256"></span><h3>3.12.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-9" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="epics-test-harness-9">
<span id="id257"></span><h3>3.12.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-9" title="Permalink to this headline">¶</a></h3>
<p>The Stream Device driver is an EPICS community package which has been
tested and probed to work properly with RTEMS. The Stream Device driver
validation consists on check their ADE compatibility and the
availability to be linked to other CCB components.</p>
<div class="section" id="add-the-streamsdevice-dbd-file-and-library">
<h4>3.12.2.1 Add the StreamSDevice DBD file and library<a class="headerlink" href="#add-the-streamsdevice-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">labvme9-sbf-ioc_DBD += stream.dbd</p>
<p>….</p>
<p class="last">labvme9-sbf-ioc_LIBS += stream</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-8">
<span id="id258"></span><h4>3.12.2.2 Startup Script<a class="headerlink" href="#startup-script-8" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/labvme9-sbf-ioc</p>
<p>cd ${INSTALL}</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/labvme8-CP-ioc.dbd”)</p>
<p>labvme9-sbf_ioc_registerRecordDeviceDriver(pdbbase)</p>
<p>## Load record instances</p>
<p>#dbLoadTemplate(“db/labvme9-sbf-ioc.substitutions”)</p>
<p>#dbLoadRecords(“db/labvme9-sbf-ioc.db”, “user=username”)</p>
<p>iocInit</p>
<p>## Start any sequence programs</p>
<p class="last">#seq(sncxxx, “user=username”)</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install-3">
<span id="id259"></span><h4>3.12.2.3 Build and Install<a class="headerlink" href="#build-and-install-3" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd labvme9/sbf</p>
<p class="last">$ make distclean uninstall all</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-110-01-stream-device-ade-compatibility-1">
<span id="section-6"></span><span id="id260"></span><h3>3.12.3 REQ-110-01 Stream Device ADE Compatibility<a class="headerlink" href="#req-110-01-stream-device-ade-compatibility-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><a href="#id261"><span class="problematic" id="id262">`</span></a>3.12.1 Test Setup and</li>
</ol>
<blockquote class="last">
<div>Prerequisites &lt;#test-setup-and-prerequisites-9&gt;`__</div></blockquote>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Edit configure/RELEASE to put in correct paths</dt>
<dd>for dependencies:</dd>
</dl>
</li>
</ol>
<p>WORKSUP = /gem_sw/work/R3.14.12.4/support</p>
<p>PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>SNCSEQ=$(PRODSUP)/seq/2-2-3 ls</p>
<p>ASYN=$(PRODSUP)/asyn/4-29-1</p>
<p>CALC=$(PRODSUP)/calc/3-6-1-1</p>
<p>PCRE=$(PRODSUP)/pcre/8-38-1</p>
<p>STREAM=$(PRODSUP)/StreamDevice/2-6-1</p>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Add dependencies to</dt>
<dd>labvme8/CP/labvme8-CP-iocApp/src/Makefile</dd>
</dl>
</li>
</ol>
<p>labvme9-sbf-ioc_DBD += stream.dbd</p>
<p>labvme9-sbf-ioc_LIBS += stream</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt><a href="#id263"><span class="problematic" id="id264">`</span></a>Build and Install the</dt>
<dd>module. &lt;#build-and-install-3&gt;`__</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>&#160;</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The Stream Device driver shall be compatible</dt>
<dd>with the Application Development Environment
(ADE), and build without errors or warnings.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-110-02-stream-device-available-for-linking">
<h3>3.12.4 REQ-110-02 Stream Device Available for Linking<a class="headerlink" href="#req-110-02-stream-device-available-for-linking" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt><a href="#id265"><span class="problematic" id="id266">`</span></a>3.12.1 Test Setup and</dt>
<dd>Pr</dd>
</dl>
</li>
</ol>
<p class="last">erequisites &lt;#test-setup-and-prerequisites-9&gt;`__</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Edit configure/RELEASE to put in correct</dt>
<dd>paths for all library dependencies:</dd>
</dl>
</li>
</ol>
<p>WORKSUP = /gem_sw/work/R3.14.12.4/support</p>
<p>PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>IOCSTATS=$(PRODSUP)/iocStats/3-1-14-2</p>
<p>SNCSEQ=$(PRODSUP)/seq/2-2-3-1</p>
<p>GEMREC=$(PRODSUP)/geminiRec/4-0-1</p>
<p>PVLOAD=$(PRODSUP)/pvload/1-1-1</p>
<p>ASYN=$(PRODSUP)/asyn/4-29-1</p>
<p>CALC=$(PRODSUP)/calc/3-6-1-1</p>
<p>PCRE=$(PRODSUP)/pcre/8-38-1</p>
<p>STREAM=$(PRODSUP)/StreamDevice/2-6-1</p>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Add dependencies to</dt>
<dd>labvme8/CP/labvme8-CP-iocApp/src/Makefile</dd>
</dl>
</li>
</ol>
<p>labvme9-sbf-ioc_DBD += base.dbd</p>
<p>labvme9-sbf-ioc_DBD += iocAdmin.dbd</p>
<p>labvme9-sbf-ioc_DBD += geminiRecords.dbd</p>
<p>labvme9-sbf-ioc_DBD += pvload.dbd</p>
<p>labvme8-CP-ioc_DBD += stream.dbd</p>
<p>labvme9-sbf-ioc_LIBS += devIocStats</p>
<p>labvme9-sbf-ioc_LIBS += seq pv</p>
<p>labvme9-sbf-ioc_LIBS += geminiRecords</p>
<p>labvme9-sbf-ioc_LIBS += pvload</p>
<p>labvme9-sbf-ioc_LIBS += stream</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt><a href="#id267"><span class="problematic" id="id268">`</span></a>Build and Install the</dt>
<dd>module. &lt;#build-and-install-3&gt;`__</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The Stream Device driver shall be available</dt>
<dd>for linking and testing with other CCB
components.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="xycom-240-1">
<span id="section-7"></span><span id="id269"></span><h2>3.13 Xycom-240<a class="headerlink" href="#xycom-240-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-10">
<span id="id270"></span><h3>3.13.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-10" title="Permalink to this headline">¶</a></h3>
<p>Setup your test Xycom 240 with the proper jumper and switch settings to
define the base address. This test will use 0xD000 as the base address
so the S2 (switches 1-6) should be set as: 0,0,1,0,1,1 (where 0 is
closed and 1 is open). S2 (switches 7-8) define the
supervisor/non-privileged mode and address space selection. For this
test we use Supervisory OR Non-Privileged mode and Short I/O Access
Operation. Therefore, S2 (switches 7-8) should be set to 0,0 (both
closed).</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="16%" />
<col width="21%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Hex Value</th>
<th class="head">Switch /pins</th>
<th class="head">Switch S2 (pins 1-6)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Base Address</td>
<td>0xD000</td>
<td>S2/ 1-6</td>
<td>0,0,1,0,1,1</td>
</tr>
<tr class="row-odd"><td>Supervisory Mode</td>
<td>0x00</td>
<td>S2/ 7-8</td>
<td>0,0</td>
</tr>
<tr class="row-even"><td>Interrupt Level</td>
<td>&#160;</td>
<td>S3 …</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="epics-test-harness-10">
<span id="id271"></span><h3>3.13.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-10" title="Permalink to this headline">¶</a></h3>
<p>The XYCOM-240 driver is equipped with a set of epics records which can
be loaded during startup. The database can be viewed in
xy240App/Db/xycom240Test.sch. Make sure your SYS_TDCT_PATHS is defined
like this,</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">[xy240App/Db]&gt;echo $SYS_TDCT_PATHS</p>
<p class="last">/gem_sw/epics/R3.14.12.4/exte
nsions/src/tdct/sym:/gem_sw/prod/R3.14.12.4/support/geminiRec/4-0/db</p>
</td>
</tr>
</tbody>
</table>
<p>and use the tdct like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>[xy240App/Db]&gt;tdct -cfg ./tdct.cfg -i xycom240Test.sch</td>
</tr>
</tbody>
</table>
<p>The test harness record names have been designed with specific tests in
mind:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="19%" />
<col width="14%" />
<col width="19%" />
<col width="19%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">De
scription</th>
<th class="head">Signal</th>
<th class="head">Xycom-240
JK/Pin</th>
<th class="head">SCAN</th>
<th class="head">NOBT</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>x
y240:s0bo</td>
<td>Binary
Output</td>
<td>S0</td>
<td>JK2/37</td>
<td>Passive</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>x
y240:s1bo</td>
<td>Binary
Output</td>
<td>S1</td>
<td>JK2/38</td>
<td>Passive</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>x
y240:s2bo</td>
<td>Binary
Output</td>
<td>S2</td>
<td>JK2/39</td>
<td>Passive</td>
<td>N/A</td>
</tr>
<tr class="row-odd"><td>x
y240:s3bo</td>
<td>Binary
Output</td>
<td>S3</td>
<td>JK2/40</td>
<td>Passive</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>xy2
40:s0mbbo</td>
<td>Multi-bit
binary
output</td>
<td>S0</td>
<td>JK2/37
,38,39,40</td>
<td>Passive</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>xy2
40:s4mbbo</td>
<td>Multi-bit
binary
output</td>
<td>S4</td>
<td>JK2/41
,42,43,44</td>
<td>Passive</td>
<td>4</td>
</tr>
<tr class="row-even"><td>xy2
40:s8mbbo</td>
<td>Multi-bit
binary
output</td>
<td>S8</td>
<td>JK2/25
,26,27,28</td>
<td>Passive</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>xy24
0:s12mbbo</td>
<td>Multi-bit
binary
output</td>
<td>S12</td>
<td>JK2/29
,30,31,32</td>
<td>Passive</td>
<td>4</td>
</tr>
<tr class="row-even"><td>xy24
0:s16mbbo</td>
<td>Multi-bit
binary
output</td>
<td>S16</td>
<td>JK2/13
,14,15,16</td>
<td>Passive</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>xy
240:s24bi</td>
<td>Binary
Input</td>
<td>S24</td>
<td>JK1/1</td>
<td>I/O
Interrupt</td>
<td>N/A</td>
</tr>
<tr class="row-even"><td>xy
240:s25bi</td>
<td>Binary
Input</td>
<td>S25</td>
<td>JK1/2</td>
<td>I/O
Interrupt</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<div class="section" id="add-the-xycom240test-db">
<h4>3.13.2.1 Add the xycom240Test.db<a class="headerlink" href="#add-the-xycom240test-db" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>If you need to, create a test ioc in the ADE environment, Eg.,</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$gem-start-new-module.py -i gemtest1/MK</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Edit your configure/RELEASE to include the XYCOM module from either</dt>
<dd>WORK or PROD:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">…</p>
<p class="last">XYCOM=/gem_sw/work/R3.14.12.4/support/xycom</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Find your gemtest1-MKApp/Db/Makefile and edit your Makefile to</dt>
<dd>include the test harness as described in <a class="reference external" href="#epics-test-harness-10">3.2.1 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += xycom240Test.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-xycom240-library">
<h4>3.13.2.2 Add the xycom240 Library<a class="headerlink" href="#add-the-xycom240-library" title="Permalink to this headline">¶</a></h4>
<p>Include the following dbd and libraries in your
gemtest1-MKApp/src/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-MK_DBD += xy240.dbd</p>
<p>…</p>
<p class="last">gemtest1-MK_LIBS += xy240</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-9">
<span id="id272"></span><h4>3.13.2.3 Startup Script<a class="headerlink" href="#startup-script-9" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="edit-your-startup-source-file-iocboot-ioclab4vme-hbf-stgemtest1-mk-src-to-reflect-a-minimal-test-for-the-xycom-240-you-want-to-load-your-database-definition-dbd-configure-the-xycom-240-load-the-test-harness-records-we-imported-and-call-iocinit">
<h4>3.13.2.4 Edit your startup source file iocBoot/ioclab4vme-hbf/stgemtest1-MK.src to reflect a minimal test for the Xycom 240. You want to load your database definition (dbd), configure the Xycom 240, load the test harness records we imported and call iocInit().<a class="headerlink" href="#edit-your-startup-source-file-iocboot-ioclab4vme-hbf-stgemtest1-mk-src-to-reflect-a-minimal-test-for-the-xycom-240-you-want-to-load-your-database-definition-dbd-configure-the-xycom-240-load-the-test-harness-records-we-imported-and-call-iocinit" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-MK</p>
<p>cd ${INSTALL}</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/gemtest1-MK.dbd”)</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p>#Configure the Xycom 240 for our base address</p>
<p>drvXy240Config(1, 32, 0xd000)</p>
<p>## Load record instances</p>
<p>#dbLoadRecords(“db/xycom240Test.db”)</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install-4">
<span id="id273"></span><h4>3.13.2.5 Build and install<a class="headerlink" href="#build-and-install-4" title="Permalink to this headline">¶</a></h4>
<p>Build the test ioc:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd gemtest1-MK/hbf</p>
<p class="last">$ make distclean uninstall; make</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-111-01-initialize">
<h3>3.13.3 REQ-111-01 Initialize<a class="headerlink" href="#req-111-01-initialize" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your IOC and CPU board are setup</dt>
<dd>as described in <a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure that your Xycom-240 board is setup as</dt>
<dd>described in <a href="#id274"><span class="problematic" id="id275">`</span></a>3.13.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites &lt;#test-setup-and-prerequisites-10&gt;`__.</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Xycom Tests as</dt>
<dd>described in <a class="reference external" href="#epics-test-harness-10">3.13.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot the prepared IOC and confirm the startup</dt>
<dd>script fully executes.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li>The IOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will be running and will</dt>
<dd>have initialized the Xycom-240 driver as a
result.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The Front-Panel LED will turn from RED to</dt>
<dd>GREEN upon successful initialization.
<strong>NB. This is a necessary but NOT a
sufficient condition for a successful
initialization.</strong></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Run epicsThreadShowAll and verify the</dt>
<dd>dio_scan task is running. This confirms
the driver is successfully initialized and
the driver is emulating interrupt
scanning.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; epicsThreadShowAll</p>
<p>…</p>
<p>0a010010 50 149 Delay dio_scan</p>
<p class="last">…</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><dl class="first docutils">
<dt>When the board initializes all inputs are set</dt>
<dd>to 1 and all outputs are set to 0. Verify
this is the state by running the report
for this driver.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<p>XY240 BINARY OUT CHANNELS:</p>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-111-02-epics-report">
<h3>3.13.4 REQ-111-02 EPICS Report<a class="headerlink" href="#req-111-02-epics-report" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id276"><span class="problematic" id="id277">`</span></a>3.13.3 REQ-111-01</dt>
<dd>Initialize &lt;#req-111-01-initialize&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>This test is executed as part of the</dt>
<dd>initialize test above.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>When the board initializes all inputs are set</dt>
<dd>to 1 and all outputs are set to 0. Verify
this is the state by running the report
for this driver.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<p>XY240 BINARY OUT CHANNELS:</p>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-111-03-binary-output-support">
<h3>3.13.5 REQ-111-03 Binary Output Support<a class="headerlink" href="#req-111-03-binary-output-support" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><a class="reference external" href="#linux-host-setup">3.1 Linux Host Setup</a></li>
<li><dl class="first docutils">
<dt><a href="#id278"><span class="problematic" id="id279">`</span></a>3.3.3 REQ-101-01</dt>
<dd>Initialize &lt;#req-111-01-initialize&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure a DMM to measure the output voltage</dt>
<dd>for signal S0. Refer to <a class="reference external" href="#signal-to-port-mapping">2.2.4.1 Signal to
Port Mapping</a>
for a Xycom-240 front-panel pinouts.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Reboot the IOC to reinitialize all eight I/O</dt>
<dd>ports to the default values. All input
ports 0-3 should read 1 and all output
ports 4-7 should read 0.</dd>
</dl>
</li>
<li>Populate the xy240:S0bo record with a 1</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0bo 1</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li>Populate the xy240:S0bo record with a 0</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0bo 0</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After step one above report the Xycom 240</dt>
<dd>channel status and verify the output
channel 0 reports a 1 value as shown below
in red:.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 1 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>After step two above, use the DMM as</dt>
<dd>configured in the prerequisites to verify
a TTL level 1 (approximately 5 volts).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step two above report the Xycom 240</dt>
<dd>channel status and verify output channel 0
reads a 0 value, as shown below in red.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="4">
<li><dl class="first docutils">
<dt>After step three above, use the DMM as</dt>
<dd>configured in the prerequisites to verify
a TTL level 0 (approximately 0 volts).</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-111-04-binary-input-support">
<h3>3.13.6 REQ-111-04 Binary Input Support<a class="headerlink" href="#req-111-04-binary-input-support" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><a class="reference external" href="#linux-host-setup">3.1 Linux Host Setup</a></li>
<li><dl class="first docutils">
<dt><a href="#id280"><span class="problematic" id="id281">`</span></a>3.3.3 REQ-101-01</dt>
<dd>Initialize &lt;#req-111-01-initialize&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure a power supply to inject a 0-5 volt</dt>
<dd>input voltage for signal S0. Refer to
<a class="reference external" href="#signal-to-port-mapping">2.2.4.1 Signal to Port
Mapping</a> for a
Xycom-240 front-panel pinouts.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Reboot the IOC to reinitialize all eight I/O</dt>
<dd>ports to the default values. All input
ports 0-3 should read 1 and all output
ports 4-7 should read 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Set the power supply input voltage to 0</dt>
<dd>volts.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Set the power supply input voltage to 5</dt>
<dd>volts.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After step 2 above query the value of the</dt>
<dd>input record xy240:s0bi and verify that it
is 0 by processing the record.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ caget -n xy240:s0bi</p>
<p class="last">xy240:s0bi 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>After step 2 in the procedure above, and</dt>
<dd>after you process the record with caget,
report the Xycom 240 channel status and
verify output channel 0 reads a 0 value.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 0 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>After step 3 in the procedure section above,</dt>
<dd>process the input record xy240:s0bi and
verify that it is 1.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ caget -n xy240:s0bi</p>
<p class="last">xy240:s0bi 1</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><dl class="first docutils">
<dt>After step 3 in the procedure section above,</dt>
<dd>report the Xycom 240 channel status and
verify output channel 0 reads a 1 value.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-111-05-multibit-binary-input-support-passive-scanning">
<h3>3.13.7 REQ-111-05 Multibit Binary Input Support (Passive Scanning)<a class="headerlink" href="#req-111-05-multibit-binary-input-support-passive-scanning" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><a class="reference external" href="#linux-host-setup">3.1 Linux Host Setup</a></li>
<li><dl class="first docutils">
<dt><a href="#id282"><span class="problematic" id="id283">`</span></a>3.3.3 REQ-101-01</dt>
<dd>Initialize &lt;#req-111-01-initialize&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure a <strong>dual channel</strong> power supply to</dt>
<dd>apply a 0-5 volt input for signals S24 and
S25 independently. Refer to <a class="reference external" href="#signal-to-port-mapping">2.2.4.1
Signal to Port
Mapping</a> for a
Xycom-240 front-panel pinouts.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Note for this test, xy240:s24mbbi is Passive</dt>
<dd>with NOBT=2, so S24 and S25 are read and
determine the final value for this record.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Make sure the power supply is off and reboot</dt>
<dd>the IOC to reinitialize all eight I/O
ports to the default values. All input
ports 0-3 should read 1 and all output
ports 4-7 should read 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test for 0x0. Set both channels of the power</dt>
<dd>supply input voltage to 0 volts each.
Check the S24 and S25 input values are
both 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test for 0x1. Set the S25 channel on the</dt>
<dd>power supply voltage to 5 volts, and leave
the S24 channel to 0 volts. Check the
input values for S24 and S25 show 0 and 1
respectively.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test for 0x2. Set the S25 channel on the</dt>
<dd>power supply voltage to 0 volts, and set
the S24 channel to 5 volts. Check the
input values for S24 and S25 show 1 and 0
respectively.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Test for 0x3. Set the S25 channel on the</dt>
<dd>power supply voltage to 5 volts, and set
the S24 channel to 5 volts. Check the
input values for S24 and S25 show 1 and 1
respectively.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After step 2 above query the value of the</dt>
<dd>input record xy240:s4mbbi and verify that
it is 0 by processing the record.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ caget -n xy240:s24mbbi</p>
<p class="last">xy240:s24mbbi 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>After step 2 in the procedure above, and</dt>
<dd>after you process the record with caget,
report the Xycom 240 channel status and
verify channel S24 and S25 read a 0 value
as shown below in red.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>After step 2 above query the value of the</dt>
<dd>input record xy240:s24mbbi and verify that
it is 0x1 by processing the record.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ caget -n xy240:s24mbbi</p>
<p class="last">xy240:s24mbbi 1</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><dl class="first docutils">
<dt>After step 3 in the procedure above, and</dt>
<dd>after you process the record with caget,
report the Xycom 240 channel status and
verify that it is a 0x1 . S24 should
report 0 and S25 should report a 1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step 4 in the procedure section above,</dt>
<dd>process the input record xy240:s24mbbi and
verify that it is a 0x2 .</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ caget -n xy240:s24mbbi</p>
<p class="last">xy240:s24mbbi 2</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="6">
<li><dl class="first docutils">
<dt>After step 4 in the procedure section above,</dt>
<dd>and after you process the record with
caget, report the Xycom 240 channel status
and verify that it is a 0x2 . S24 should
report 1 and S25 should report a 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step 5 in the procedure section above,</dt>
<dd>process the input record xy240:s24mbbi and
verify that it is a 0x3.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ caget -n xy240:s24mbbi</p>
<p class="last">xy240:s24mbbi 3</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="8">
<li><dl class="first docutils">
<dt>After step 5 in the procedure section above,</dt>
<dd>and after you process the record with
caget, report the Xycom 240 channel status
and verify that it is a 0x3 . S24 should
report 1 and S25 should report a 1.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-111-06-multibit-binary-output-support">
<h3>3.13.8 REQ-111-06 Multibit Binary Output Support<a class="headerlink" href="#req-111-06-multibit-binary-output-support" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><a class="reference external" href="#linux-host-setup">3.1 Linux Host Setup</a></li>
<li><dl class="first docutils">
<dt><a href="#id284"><span class="problematic" id="id285">`</span></a>3.3.3 REQ-101-01</dt>
<dd>Initialize &lt;#req-111-01-initialize&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure a DMM to measure the output voltage</dt>
<dd>for signal S0, S1, S2 and S3. Refer to
<a class="reference external" href="#signal-to-port-mapping">2.2.4.1 Signal to Port
Mapping</a> for a
Xycom-240 front-panel pinouts.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Reboot the IOC to reinitialize all eight I/O</dt>
<dd>ports to the default values. All input
ports 0-3 should read 1 and all output
ports 4-7 should read 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The xy240:s0mbbo record has the NOBT=4 so</dt>
<dd>S0,S1,S2 and S3 are set when this record
processes. Populate the xy240:s0mbbo
record with a 15 (0xF) to set all channels
to 1.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 15</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Test 0xE. Populate the xy240:s0mbbo record</dt>
<dd>with a 14 (0xE)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 14</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><dl class="first docutils">
<dt>Test 0xD. Populate the xy240:s0mbbo record</dt>
<dd>with a 13 (0xD)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 13</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="5">
<li><dl class="first docutils">
<dt>Test 0xC. Populate the xy240:s0mbbo record</dt>
<dd>with a 12 (0xC)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 12</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="6">
<li><dl class="first docutils">
<dt>Test 0xB. Populate the xy240:s0mbbo record</dt>
<dd>with a 11 (0xB)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 11</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="7">
<li><dl class="first docutils">
<dt>Test 0xA. Populate the xy240:s0mbbo record</dt>
<dd>with a 10 (0xA)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 10</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="8">
<li><dl class="first docutils">
<dt>Test 0x9. Populate the xy240:s0mbbo record</dt>
<dd>with a 9 (0x9)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 9</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="9">
<li><dl class="first docutils">
<dt>Test 0x8. Populate the xy240:s0mbbo record</dt>
<dd>with a 8 (0x8)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 8</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="10">
<li><dl class="first docutils">
<dt>Test 0x7. Populate the xy240:s0mbbo record</dt>
<dd>with a 7 (0x7)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 7</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="11">
<li><dl class="first docutils">
<dt>Test 0x6. Populate the xy240:s0mbbo record</dt>
<dd>with a 6 (0x6)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 6</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="12">
<li><dl class="first docutils">
<dt>Test 0x5. Populate the xy240:s0mbbo record</dt>
<dd>with a 5 (0x5)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 5</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="13">
<li><dl class="first docutils">
<dt>Test 0x4. Populate the xy240:s0mbbo record</dt>
<dd>with a 4 (0x4)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 4</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="14">
<li><dl class="first docutils">
<dt>Test 0x3. Populate the xy240:s0mbbo record</dt>
<dd>with a 3 (0x3)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 3</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="15">
<li><dl class="first docutils">
<dt>Test 0x2. Populate the xy240:s0mbbo record</dt>
<dd>with a 2 (0x2)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 2</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="16">
<li><dl class="first docutils">
<dt>Test 0x1. Populate the xy240:s0mbbo record</dt>
<dd>with a 1 (0x1)</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 1</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="17">
<li><dl class="first docutils">
<dt>Test 0x0. Populate the xy240:s0mbbo record</dt>
<dd>with a 0 (0x0)</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 0</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After step two in the procedure above, report</dt>
<dd>the Xycom 240 channel status and verify
the output channel 0,1,2 and 3 all report
1’s as values, as shown below in red.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>After step two in the procedure above, verify</dt>
<dd>the DMM reports a TTL level 1
(approximately 5 volts) or TTL 0
(approximately 0 volts) for the respective
output channels on the board.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step three in the procedure above,</dt>
<dd>report the Xycom 240 channel status and
verify output channel S0, S1 S2 and S3
report the correct bit pattern for the
respective test in question. RECALL, the
most significant bit is Channel 3!</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = ? Chan 1 = ? Chan 2 = ? Chan 3 =
?</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="4">
<li><dl class="first docutils">
<dt>After step three in the procedure above,</dt>
<dd>verify the DMM reports a TTL level 1
(approximately 5 volts) or TTL 0
(approximately 0 volts) for the respective
output channels on the board. RECALL, the
most significant bit is Channel 3!</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Repeat steps 3 and 4 for the remaining steps</dt>
<dd>(through step 17) in the procedure.
Confirm all bit patterns.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-111-07-binary-input-support-interrupt-scanning">
<h3>3.13.9 REQ-111-07 Binary Input Support Interrupt Scanning<a class="headerlink" href="#req-111-07-binary-input-support-interrupt-scanning" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminals each</dt>
<dd>configured as described in <a class="reference external" href="#linux-host-setup">3.1 Linux
Host Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure IOC is initialized as described in</dt>
<dd><a class="reference external" href="#req-111-01-initialize">3.3.3 REQ-101-01
Initialize</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Connect all output data ports 4,5,6,7 on</dt>
<dd>JK/2 to all input data ports 0,1,2,3 on
JK/1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Refer to <a href="#id286"><span class="problematic" id="id287">`</span></a>2.2.4.1 Signal to Port</dt>
<dd>Mapping &lt;#signal-to-port-mapping&gt;`__ for
a Xycom-240 front-panel pinouts.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Reboot the IOC to reinitialize all eight I/O</dt>
<dd>ports to the default values.
<strong>NB.</strong><em>When the driver initializes,
all input ports are set to 1 (TTL 5
volts), and all output ports are set to 0
(TTL 0 volts). Yet, all the input records
loaded are configured as SCAN I/O
Interrupt, and since the outputs are
default to zero (and you connected all
the outputs to the input channels), these
output values shall exist on all input
records (channels) that are processed.
See the</em><a class="reference external" href="#epics-test-harness-10">3.3.2 EPICS Test
Harness</a><em>for
the Xycom-240 and confirm these records
and have been set to zero immediately
after initialize.</em> Confirm the success
criteria below in step 1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>To get the bi input to process, we drive the</dt>
<dd>connected output channels. Then, confirm
the proper state of the input channel .
To make this easier, set your first Linux
terminal to monitor the input record and
drive your outputs in the second
terminal.</dd>
</dl>
</li>
</ol>
<blockquote>
<div>Terminal 1:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor -n xy240:s0bi</td>
</tr>
</tbody>
</table>
<blockquote>
<div>Terminal 2:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0bo 1</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Return the output channel to zero by driving</dt>
<dd>xy240:s0bo to zero. Then, confirm the
proper state of the input channels by
watching your monitor terminal.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s1bo 0</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="4">
<li><dl class="first docutils">
<dt>Repeat steps 2 and 3 for the following</dt>
<dd>channels: xy240:s1bo.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td>Success Criterial</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Confirm the state after iocInit() has set</dt>
<dd>all connected input records with I/O
interrupt channels to zero. Eg.,
xy240:s0bi shall process due to the
changing value from default 1 to 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>For steps 2,3 and 4 in the procedure,</dt>
<dd>confirm the correct channel states at
each step using the dbior drvXy240 1
command.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-111-08-multibit-binary-input-support-interrupt-scanning">
<h3>3.13.10 REQ-111-08 Multibit Binary Input Support (Interrupt Scanning)<a class="headerlink" href="#req-111-08-multibit-binary-input-support-interrupt-scanning" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminals each configured</dt>
<dd>as described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure IOC is initialized as described in</dt>
<dd><a class="reference external" href="#req-111-01-initialize">3.3.3 REQ-101-01
Initialize</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Connect all output data ports 4,5,6,7 on JK/2</dt>
<dd>to all input data ports 0,1,2,3 on JK/1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Refer to <a href="#id288"><span class="problematic" id="id289">`</span></a>2.2.4.1 Signal to Port</dt>
<dd>Mapping &lt;#signal-to-port-mapping&gt;`__ for a
Xycom-240 front-panel pinouts.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Reboot the IOC to reinitialize all eight I/O</dt>
<dd>ports to the default values.
<strong>NB.</strong><em>When the driver initializes, all
input ports are set to 1 (TTL 5 volts),
and all out ports are set to 0 (TTL 0
volts). Yet, all the MBBI records loaded
are configured as SCAN I/O Interrupt, and
since the outputs are default to zero (and
you connected all the outputs to the input
channels), these output values shall exist
on all input records (channels) that are
processed. See the</em><a class="reference external" href="#epics-test-harness-10">3.3.2 EPICS Test
Harness</a><em>for
the Xycom-240 and confirm these MBBI
records and the adjacent NOBT number of
bits have been set to zero immediately
after initialize.</em> Confirm the success
criteria below in step 1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>To get the mbbi inputs to process, we drive</dt>
<dd>the connected output channels. Drive the 4
output signals S0-S3 to all ones by
writing a 15 (0xF) into record
xy240:s0mbbo . Then, confirm the proper
state of the input channels. To make this
easier, set your first Linux terminal to
monitor the input record and drive your
outputs in the second terminal.</dd>
</dl>
</li>
</ol>
<blockquote>
<div>Terminal 1:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor -n xy240:s0mbbi</td>
</tr>
</tbody>
</table>
<blockquote>
<div>Terminal 2:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 15</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Return the S0-S3 channels to zero by driving</dt>
<dd>xy240:s0mbbo to zero. Then, confirm the
proper state of the input channels.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0mbbo 0</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="4">
<li><dl class="first docutils">
<dt>Repeat steps 2 and 3 for the following</dt>
<dd>channels: xy240:s4mbbo, xy240:s8mbbo,
xy240:s12mbbo, xy240:s16mbbo.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Confirm the state after iocInit() has set all</dt>
<dd>connected MBBI records with I/O interrupt
channels to zero. Eg., xy240:s0mbbi shall
process due to the changing value from
default 1 to 0. Since NOBT =4, the
adjacent 3 bits S1,S2 and S3 are also set
to 0. This pattern is repeated for
xy240:s4mbbi, xy240:s8mbbi, xy240:s12mbbi
and xy240:s16mbbi.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Since the test harness does not include</dt>
<dd>records for xy240:s20mbbi, xy240:s24mbbi,
and xy240:s28mbbi, these final 12 input
channels shall remain as the default of 1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>For steps 2,3 and 4 in the procedure, confirm</dt>
<dd>the correct channel states at each step
using the dbior drvXy240 1 command.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-111-09-two-card-support">
<h3>3.13.11 REQ-111-09 Two Card Support<a class="headerlink" href="#req-111-09-two-card-support" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><a class="reference external" href="#linux-host-setup">3.1 Linux Host Setup</a></li>
<li><dl class="first docutils">
<dt>Configure a second Xycom-240 board with the</dt>
<dd>base address set appropriately.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><a href="#id290"><span class="problematic" id="id291">`</span></a>3.3.3 REQ-101-01</dt>
<dd>Initialize &lt;#req-111-01-initialize&gt;`__</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure a DMM to measure the output voltage</dt>
<dd>for CARD 1 (second Xycom-240) signal S0.
Refer to <a class="reference external" href="#signal-to-port-mapping">2.2.4.1 Signal to Port
Mapping</a> for a
Xycom-240 front-panel pinouts.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Connect the same output from S0 of Card 1 to</dt>
<dd>the input S0 of Card1.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Reboot the IOC to reinitialize all eight I/O</dt>
<dd>ports to the default values. For CARD 1.
all input ports 0-3 should read 1 (EXCEPT
S0) and all output ports 4-7 should read
0.</dd>
</dl>
</li>
<li>Populate the xy240:S0bocard1 record with a 1</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0bocard1 1</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li>Populate the xy240:S0bocard1 record with a 0</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput -n xy240:s0bo 0</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Confirm a default state on both boards with</dt>
<dd>the power supply off and the IOC just
rebooted. Use the report functionality.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step <strong>two</strong> above report the Xycom-240</dt>
<dd>channel status and verify the output
channel 0 reports a 1 value. BOTH CARDS
SHALL BE REPORTED.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p>Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
<p>B*: XY240: card 1</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 1 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>After step two above, verify the DMM reports</dt>
<dd>a TTL level 1 (approximately 5 volts).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step three above report the Xycom-240</dt>
<dd>channel status and verify output channel 0
reads a 0 value.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy240 1</p>
<p>Driver: drvXy240</p>
<p>B*: XY240: card 0</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 1 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<blockquote>
<div>XY240 BINARY OUT CHANNELS:</div></blockquote>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p>Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
<p>B*: XY240: card 1</p>
<p>XY240 BINARY IN CHANNELS:</p>
<p>Chan 0 = 0 Chan 1 = 1 Chan 2 = 1 Chan 3 =
1</p>
<p>Chan 4 = 1 Chan 5 = 1 Chan 6 = 1 Chan 7 =
1</p>
<p>Chan 8 = 1 Chan 9 = 1 Chan 10 = 1 Chan 11
= 1</p>
<p>Chan 12 = 1 Chan 13 = 1 Chan 14 = 1 Chan
15 = 1</p>
<p>Chan 16 = 1 Chan 17 = 1 Chan 18 = 1 Chan
19 = 1</p>
<p>Chan 20 = 1 Chan 21 = 1 Chan 22 = 1 Chan
23 = 1</p>
<p>Chan 24 = 1 Chan 25 = 1 Chan 26 = 1 Chan
27 = 1</p>
<p>Chan 28 = 1 Chan 29 = 1 Chan 30 = 1 Chan
31 = 1</p>
<p>XY240 BINARY OUT CHANNELS:</p>
<p>Chan 0 = 0 Chan 1 = 0 Chan 2 = 0 Chan 3 =
0</p>
<p>Chan 4 = 0 Chan 5 = 0 Chan 6 = 0 Chan 7 =
0</p>
<p>Chan 8 = 0 Chan 9 = 0 Chan 10 = 0 Chan 11
= 0</p>
<p>Chan 12 = 0 Chan 13 = 0 Chan 14 = 0 Chan
15 = 0</p>
<p>Chan 16 = 0 Chan 17 = 0 Chan 18 = 0 Chan
19 = 0</p>
<p>Chan 20 = 0 Chan 21 = 0 Chan 22 = 0 Chan
23 = 0</p>
<p>Chan 24 = 0 Chan 25 = 0 Chan 26 = 0 Chan
27 = 0</p>
<p class="last">Chan 28 = 0 Chan 29 = 0 Chan 30 = 0 Chan
31 = 0</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="5">
<li><dl class="first docutils">
<dt>After step three above, verify the DMM</dt>
<dd>reports a TTL level 0 (approximately 0
volts).</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="xycom-566-1">
<span id="id292"></span><h2>3.14 Xycom-566<a class="headerlink" href="#xycom-566-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-11">
<span id="id293"></span><h3>3.14.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-11" title="Permalink to this headline">¶</a></h3>
<p>Setup your test Xycom 566 with the proper jumper and switch settings to
define the base address. This test will use 0xC000 as the base address
so the S3 (switches 1-6 ) should be set as: 1,1,0,0,0,0 (where 0 is
closed and 1 is open). S2 (switches 7-8) define the
supervisor/non-privileged mode and address space selection. For this
test we use Supervisory OR Non-Privileged mode and Short I/O Access
Operation. Therefore, S3 (switches 7-8) should be set to 0,0 (both
closed).</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="28%" />
<col width="22%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Hex Value</th>
<th class="head">Switch /pins</th>
<th class="head">Switch Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Switches</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Interrupt Level
3</td>
<td>&#160;</td>
<td>S1/1-3</td>
<td>110</td>
</tr>
<tr class="row-even"><td>Data Ram Address</td>
<td>0xA000000</td>
<td>S2/1-8</td>
<td>10100000</td>
</tr>
<tr class="row-odd"><td>Base Address,
A16,
non-privileged</td>
<td>0xC000</td>
<td>S3/ 1-6</td>
<td>110000</td>
</tr>
<tr class="row-even"><td>Supervisory Mode</td>
<td>0x00</td>
<td>S3/ 7-8</td>
<td>0,0</td>
</tr>
<tr class="row-odd"><td>Jumpers</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>IACK Daisy Chain
Mode</td>
<td>J1=B, J2=B</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Short I/O</td>
<td>J3=B</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>Bipolar, +/- 10
volt input</td>
<td>J8=B, J10=B</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Offset binary,
A/D data format</td>
<td>J9=B,
J14=J15=out</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="epics-test-harness-11">
<span id="id294"></span><h3>3.14.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-11" title="Permalink to this headline">¶</a></h3>
<p>The XYCOM-566 driver is equipped with a set of epics records which can
be loaded during startup. The database can be viewed in
xy566App/Db/xycom566Test.sch. Make sure your SYS_TDCT_PATHS is defined
like this,</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">[xy566App/Db]&gt;echo $SYS_TDCT_PATHS</p>
<p class="last">/gem_sw/epics/R3.14.12.4/exte
nsions/src/tdct/sym:/gem_sw/prod/R3.14.12.4/support/geminiRec/4-0/db</p>
</td>
</tr>
</tbody>
</table>
<p>and use the tdct like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>[xy566App/Db]&gt;tdct -cfg ./tdct.cfg -i xycom566Test.sch</td>
</tr>
</tbody>
</table>
<p>The test harness record names have been designed with specific tests in
mind based on the MCS Requirements for the use of the Xycom 566. See the
<a class="reference external" href="https://drive.google.com/open?id=11SiQmNp9DEFfp89ijOznZefrOQr9GnBmJq9qmW9DxLs">MCS System
Note</a>
regarding the Xycom 566. There is only a single analog input record
running with Differential Scanned setup.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="14%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Des
cription</th>
<th class="head">Signal</th>
<th class="head">X
ycom-240
J
K/Pin(s)</th>
<th class="head">SCAN</th>
<th class="head">MDEL</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>xy5
66:aiS14</td>
<td>Analog
Input</td>
<td>S14</td>
<td>J
K1/43,44
(diffe
rential)</td>
<td>.1
second</td>
<td><p class="first">-1</p>
<p class="last">Trigger
monitor
every
scan</p>
</td>
</tr>
</tbody>
</table>
<div class="section" id="add-the-xycom566test-db">
<h4>3.14.2.1 Add the xycom566Test.db<a class="headerlink" href="#add-the-xycom566test-db" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>If you need to, create a test ioc in the ADE environment, Eg.,</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$gem-start-new-module.p￼￼y -i gemtest1/MK</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>The XYCOM module provides drivers and device support for both the 240</dt>
<dd>and 566. Edit your configure/RELEASE to include the XYCOM module
from either WORK or PROD:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">…</p>
<p class="last">XYCOM=/gem_sw/work/R3.14.12.4/support/xycom</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Find your gemtest1-MKApp/Db/Makefile and edit your Makefile to</dt>
<dd>include the test harness as described in <a class="reference external" href="#epics-test-harness-10">3.2.1 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += xycom566Test.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-xycom-566-dbd-file-and-library">
<h4>3.14.2.2 Add the Xycom 566 DBD file and library<a class="headerlink" href="#add-the-xycom-566-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<p>Include the following dbd and libraries in your
gemtest1-MKApp/src/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-MK_DBD += xy566.dbd</p>
<p>…</p>
<p class="last">gemtest1-MK_LIBS += xy566</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-10">
<span id="id295"></span><h4>3.14.2.3 Startup Script<a class="headerlink" href="#startup-script-10" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-MK</p>
<p>cd ${INSTALL}</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”&lt;YOUR NAME&gt;”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/gemtest1-MK.dbd”)</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p>#Configure the Xycom 240 for our base address</p>
<p>xy566_set_gain(0,0); #set card 0 to gain_entry 0 –&gt; gain=1</p>
<p>#xy566_set_gain(0,1); #set card 0 to gain_entry 1 –&gt; gain=2</p>
<p>xy566DIConfig(1, 16, 0xc000, 0xa00000)</p>
<p>## Load record instances</p>
<p>dbLoadRecords(“db/xycom566Test.db”)</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install-5">
<span id="id296"></span><h4>3.14.2.4 Build and install<a class="headerlink" href="#build-and-install-5" title="Permalink to this headline">¶</a></h4>
<p>Build the test ioc:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd gemtest1-MK/hbf</p>
<p class="last">$ make distclean uninstall; make</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-112-01-initialize-1">
<span id="id297"></span><h3>3.14.3 REQ-112-01 Initialize<a class="headerlink" href="#req-112-01-initialize-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your IOC and CPU board are setup</dt>
<dd>as described in <a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure that your Xycom-566 board is setup as</dt>
<dd>described in <a href="#id298"><span class="problematic" id="id299">`</span></a>3.14.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites &lt;#test-setup-and-prerequisites-11&gt;`__.</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Xycom Tests as</dt>
<dd>described in <a class="reference external" href="#epics-test-harness-11">3.14.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot the prepared IOC and confirm the startup</dt>
<dd>script fully executes.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li>The IOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will be running and will</dt>
<dd>have initialized the Xycom-566 driver as a
result.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The driver configures all the boards’</dt>
<dd>internal registers during the INIT
process, and as a final step sets the
front-Panel LED from RED to GREEN upon
successful initialization.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-112-02-epics-report-1">
<span id="id300"></span><h3>3.14.4 REQ-112-02 EPICS Report<a class="headerlink" href="#req-112-02-epics-report-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id301"><span class="problematic" id="id302">`</span></a>3.14.3 REQ-112-01</dt>
<dd>Initialize &lt;#req-112-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the board successfully initializes, run</dt>
<dd>the report for the Xycom 566.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>10.1.2.171&gt; dbior drvXy566 1</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>The console will report the raw hex values</dt>
<dd>for all 16 differential channels.</dd>
</dl>
</li>
<li></li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">10.1.2.171&gt; dbior drvXy566 1</p>
<p>Driver: drvXy566</p>
<p>AI: XY566-DI: card 0</p>
<p>type = 1</p>
<p>type0_nchans = 16</p>
<p>type1_nchans = 32</p>
<p>type2_nchans = 16</p>
<p>Raw values:</p>
<p>Chan 00 = 0x0816 Chan 01 = 0x0814 Chan 02
= 0x0813 Chan 03 = 0x080d</p>
<p>Chan 04 = 0x080a Chan 05 = 0x0807 Chan 06
= 0x0805 Chan 07 = 0x0800</p>
<p>Chan 08 = 0x080b Chan 09 = 0x0805 Chan 10
= 0x0802 Chan 11 = 0x07f6</p>
<p class="last">Chan 12 = 0x07ef Chan 13 = 0x07e4 Chan 14
= 0x0668 Chan 15 = 0x0804</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="3">
<li></li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-112-03-xy566diconfig-1">
<span id="id303"></span><h3>3.14.5 REQ-112-03 xy566DIConfig<a class="headerlink" href="#req-112-03-xy566diconfig-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id304"><span class="problematic" id="id305">`</span></a>3.14.3 REQ-112-01</dt>
<dd>Initialize &lt;#req-112-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Following the initialize procedure above, the</dt>
<dd>board is configured using the
xy566DIConfig() routine before iocInit().</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure the startup script completes and</dt>
<dd>iocInit() runs without error.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>This requirement is successfully passes if</dt>
<dd>the initialize test passes.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-112-04-analog-input-record">
<h3>3.14.6 REQ-112-04 Analog Input Record<a class="headerlink" href="#req-112-04-analog-input-record" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><a class="reference external" href="#linux-host-setup">3.1 Linux Host Setup</a></li>
<li><dl class="first docutils">
<dt><a href="#id306"><span class="problematic" id="id307">`</span></a>3.14.3 REQ-112-01</dt>
<dd>Initialize &lt;#req-112-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Configure a 2-channel signal generator (SG)</dt>
<dd>for differential outputs and connect to
Channel 14 of the Xycom566. Tie the low
outputs together, one high signal to pin
43 and the other high signal to pin 44.
This is described in <a class="reference external" href="#vmeio-signal-pinout">2.12.4.1 VMEIO
Signal Pinout</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure a scope to monitor and verify the</dt>
<dd>output signal from the signal generator.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Since the differential signal is twice the</dt>
<dd>voltage at the input on channel 14, set
the SG to +/- 5 volt square wave to see
the full range of +/-10 volts.</dd>
</dl>
</li>
<li>Set the frequency to 1 Hz.</li>
<li><dl class="first docutils">
<dt>Confirm your gain is set correct for unity</dt>
<dd>gain in the startup script.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>The scope will see 2 times the voltage of the</dt>
<dd>SG if connected to either pins 43 or 44
and ground on pin 45. This is correct. We
have +/-10 volts in this case.</dd>
</dl>
</li>
<li></li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">&gt;camonitor xy566:aiS14</p>
<p>xy566:aiS14 2016-08-25 17:37:24.334238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.434238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.534238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.634238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.734238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.834238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.934238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.034238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.134238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.234238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.334238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.434238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.534238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.634238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.734238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.834238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.934238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:26.034238
-9.99023</p>
<p class="last">xy566:aiS14 2016-08-25 17:37:26.134238 -10</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="3">
<li></li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-112-05-gain-control-1">
<span id="id308"></span><h3>3.14.7 REQ-112-05 Gain Control<a class="headerlink" href="#req-112-05-gain-control-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic">
<li><p class="first"><a class="reference external" href="#linux-host-setup">3.1 Linux Host Setup</a></p>
</li>
<li><p class="first"><a href="#id309"><span class="problematic" id="id310">`</span></a>3.14.6 REQ-112-04 Analog Input</p>
<blockquote>
<div><p>Record &lt;#req-112-04-analog-input-record&gt;`__</p>
</div></blockquote>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Follow the procedure for REQ-112-04 but set</dt>
<dd>the gain_setting to entry 1 which is a
gain of 2. This is commented out in the
startup script above.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Set the SG amplitude to ¼ the full range, so</dt>
<dd>2.5 Vpp.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>The differential signal is doubled showing</dt>
<dd>+/- 5 Vpp on the scope.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The epics record sees the gain of 2 and shows</dt>
<dd>+/- 10 Vpp.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">&gt;camonitor xy566:aiS14</p>
<p>xy566:aiS14 2016-08-25 17:37:24.334238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.434238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.534238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.634238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.734238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.834238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.934238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.034238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.134238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.234238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.334238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.434238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.534238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.634238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.734238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.834238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.934238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:26.034238
-9.99023</p>
<p class="last">xy566:aiS14 2016-08-25 17:37:26.134238 -10</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-112-06-xy566seconfig-1">
<span id="id311"></span><h3>3.14.8 REQ-112-06 xy566SEConfig<a class="headerlink" href="#req-112-06-xy566seconfig-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">WAIVED as not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-112-07-xy566dilconfig-1">
<span id="id312"></span><h3>3.14.9 REQ-112-07 xy566DILConfig<a class="headerlink" href="#req-112-07-xy566dilconfig-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">WAIVED as not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-112-08-xy566wfconfig-1">
<span id="id313"></span><h3>3.14.10 REQ-112-08 xy566WFConfig<a class="headerlink" href="#req-112-08-xy566wfconfig-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">WAIVED as not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-112-09-dual-card-analog-input-record">
<h3>3.14.11 REQ-112-09 Dual Card Analog Input Record<a class="headerlink" href="#req-112-09-dual-card-analog-input-record" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><a class="reference external" href="#linux-host-setup">3.1 Linux Host Setup</a></li>
<li><dl class="first docutils">
<dt><a href="#id314"><span class="problematic" id="id315">`</span></a>3.14.3 REQ-112-01</dt>
<dd>Initialize &lt;#req-112-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Configure a 2-channel signal generator (SG)</dt>
<dd>for differential outputs and connect to
Channel 14 of the Xycom566. Tie the low
outputs together, one high signal to pin
43 and the other high signal to pin 44.
This is described in <a class="reference external" href="#vmeio-signal-pinout">2.12.4.1 VMEIO
Signal Pinout</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure a scope to monitor and verify the</dt>
<dd>output signal from the signal generator.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Since the differential signal is twice the</dt>
<dd>voltage at the input on channel 14, set
the SG to +/- 5 volt square wave to see
the full range of +/-10 volts.</dd>
</dl>
</li>
<li>Set the frequency to 1 Hz.</li>
<li><dl class="first docutils">
<dt>Confirm your gain is set correct for unity</dt>
<dd>gain in the startup script.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>The scope will see 2 times the voltage of the</dt>
<dd>SG if connected to either pins 43 or 44
and ground on pin 45. This is correct. We
have +/-10 volts in this case.</dd>
</dl>
</li>
<li></li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">&gt;camonitor xy566:aiS14</p>
<p>xy566:aiS14 2016-08-25 17:37:24.334238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.434238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.534238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.634238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.734238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.834238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:24.934238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.034238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.134238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.234238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.334238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.434238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.534238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.634238 10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.734238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.834238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:25.934238 -10</p>
<p>xy566:aiS14 2016-08-25 17:37:26.034238
-9.99023</p>
<p class="last">xy566:aiS14 2016-08-25 17:37:26.134238 -10</p>
</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="3">
<li></li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="pmac-1">
<span id="section-10"></span><span id="section-9"></span><span id="section-8"></span><span id="id316"></span><h2>3.15 PMAC<a class="headerlink" href="#pmac-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-12">
<span id="id317"></span><h3>3.15.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-12" title="Permalink to this headline">¶</a></h3>
<p>Set up your test PMAC-VME card for proper VME address space and base
addresses. This must be done through the serial port connection on front
panel connector J4. See application note #106A in the PMAC VME
Addressing document for the procedure. For this test, set the PMAC
mailbox address space to non-privileged access, A24 space at base
address 0x7FA000, DPRAM base address to 0x700000, interrupt level 7 and
IRQ vector to 0xA1.</p>
</div>
<div class="section" id="epics-test-harness-12">
<span id="id318"></span><h3>3.15.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-12" title="Permalink to this headline">¶</a></h3>
<p>The pmac driver is equipped with a set of EPICS records which can be
loaded during startup and used for testing. The database can be viewed
in pmaclibApp/Db/pmactest.sch. Open in tdct like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>[pmaclibApp/Db]&gt;tdct -cfg ./tdct.cfg -i pmactest.sch</td>
</tr>
</tbody>
</table>
<div class="section" id="add-the-pmactest-db">
<h4>3.15.2.1 Add the pmactest.db<a class="headerlink" href="#add-the-pmactest-db" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>If you need to, create a test ioc in the ADE environment, Eg.,</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$gem-start-new-module.py -i gemtest1/MK</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Edit your configure/RELEASE to include the PMAC module from either</dt>
<dd>WORK or PROD:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>PMAC=/gem_sw/work/R3.14.12.4/support/pmaclib</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Find your gemtest1-MKApp/Db/Makefile and edit your Makefile to</dt>
<dd>include the test harness as described in <a class="reference external" href="https://docs.google.com/document/d/1riqBByUvcI34ubQWQzHFLtfkV3DXafrONYEkJmi0Z6k/edit#heading=h.61tktv79xmlv">3.2.1 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += pmactest.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-pmaclib-dbd-file-and-library">
<h4>3.15.2.2 Add the pmaclib DBD file and Library<a class="headerlink" href="#add-the-pmaclib-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<p>Include the following dbd and libraries in your
gemtest1-MKApp/src/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-MK_DBD += pmaclib.dbd</p>
<p>…</p>
<p class="last">gemtest1-MK_LIBS += pmaclib</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-11">
<span id="id319"></span><h4>3.15.2.3 Startup Script<a class="headerlink" href="#startup-script-11" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-MK</p>
<p>cd ${INSTALL}</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”&lt;YOUR NAME&gt;”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/gemtest1-MK.dbd”)</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p>…</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-113-01-initialize-1">
<span id="id320"></span><h3>3.15.3 REQ-113-01 Initialize<a class="headerlink" href="#req-113-01-initialize-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your IOC and CPU board are set up</dt>
<dd>as described in <a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup.</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure that your PMAC-VME board is set up as</dt>
<dd>described in <a href="#id321"><span class="problematic" id="id322">`</span></a>3.15.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites. &lt;#test-setup-and-prerequisites-12&gt;`__</p>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt>Preparre your test IOC for the PMAC tests as</dt>
<dd>described in <a class="reference external" href="#epics-test-harness-12">3.15.2 EPICS Test
Harness.</a></dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot the prepared IOC and confirm the startup</dt>
<dd>script fully executes.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li>The IIOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will be running and will</dt>
<dd>have initialized the PMAC-VME driver as a
result.</dd>
</dl>
</li>
<li></li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-02-epics-report-1">
<span id="id323"></span><h3>3.15.4 REQ 113-02 EPICS Report<a class="headerlink" href="#req-113-02-epics-report-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id324"><span class="problematic" id="id325">`</span></a>3.15.3 REQ-113-01</dt>
<dd>Initialize &lt;#req-113-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the board successfully initializes, run</dt>
<dd>the driver report for the PMAC module:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>10.1.2.171&gt; dbior drvPmac 1</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>The console will report the number of cards</dt>
<dd>configured and the state of 17 operating
parameters.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">Driver: drvPmac</p>
<p>PMAC-VME driver: &#64;(#) drvPmac.c 1.7
97/05/06</p>
<p>Number of cards configured = 1.</p>
<p>card = 0 ctlr = 0 present = 0 enabled = 0</p>
<p>enabledMbx = 1 enabledAsc = 0 enabledRam =
1</p>
<p>enabledSvo = 1 enabledBkg = 1 enabledVar =
1</p>
<p>enabledOpn = 1 enabledFld = 1 enabledGat =
1</p>
<p class="last">numSvoIo = 0 numBkgIo = 0 numVarIo = 0
numOpnIo = 8</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-03-analog-input-record-support-for-pmac-vme-ascii-1">
<span id="id326"></span><h3>3.15.5 REQ 113-03 Analog Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-03-analog-input-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-04-analog-output-record-support-for-pmac-vme-ascii-1">
<span id="id327"></span><h3>3.15.6 REQ 113-04 Analog Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-04-analog-output-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-05-binary-input-record-support-for-pmac-vme-ascii-1">
<span id="id328"></span><h3>3.15.7 REQ 113-05 Binary Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-05-binary-input-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-06-binary-output-record-support-for-pmac-vme-ascii-1">
<span id="id329"></span><h3>3.15.8 REQ 113-06 Binary Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-06-binary-output-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-07-long-input-record-support-for-pmac-vme-ascii-1">
<span id="id330"></span><h3>3.15.9 REQ 113-07 Long Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-07-long-input-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-08-long-output-record-support-for-pmac-vme-ascii-1">
<span id="id331"></span><h3>3.15.10 REQ 113-08 Long Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-08-long-output-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-09-multibit-binary-input-record-support-for-pmac-vme-ascii-1">
<span id="id332"></span><h3>3.15.11 REQ 113-09 Multibit Binary Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-09-multibit-binary-input-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-10-multibit-binary-output-record-support-for-pmac-vme-ascii-1">
<span id="id333"></span><h3>3.15.12 REQ 113-10 Multibit Binary Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-10-multibit-binary-output-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-11-string-input-record-support-for-pmac-vme-ascii-1">
<span id="id334"></span><h3>3.15.13 REQ 113-11 String Input Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-11-string-input-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Open a Linux host terminal, configured as</dt>
<dd>described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup.</a></dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><p class="first">This will test two different variations of the
string input record:</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">For the VME signal S1 variation:
| In the Linux host window type:</div>
</div>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caget pmac0:mbxSiVer</td>
</tr>
</tbody>
</table>
<ol class="arabic" start="2">
<li><div class="first line-block">
<div class="line">For the VME signal S2 variation:
| In the Linux host window type:</div>
</div>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:mbxSi ver
$ caget pmac0:mbxsi</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Verify that for each variation of the</dt>
<dd>stringin record tested, the caget command
returns the correct firmware version of
the PMAC-VME card.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-12-string-output-record-support-for-pmac-vme-ascii-1">
<span id="id335"></span><h3>3.15.14 REQ 113-12 String Output Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-12-string-output-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminal, configured as</dt>
<dd>described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup.</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In the first terminal window, use camonitor</dt>
<dd>to monitor the values of pmac0:dprAi,
pmac0:mbxSoSig1 and pmac0:mbxSoSig0:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor pmac0:dprAi pmac0:mbxSoSig1
pmac0:mbxSoSig0</td>
</tr>
</tbody>
</table>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><p class="first">This will test two different variations of the
stringoutput record:</p>
<ol class="arabic">
<li><div class="first line-block">
<div class="line">For the VME signal S1 variation:
| In the second Linux host window type:</div>
</div>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:mbxSoSig1 ‘M100-&gt;F:$DFFE’
$ caput pmac0:mbxSoSig1 ‘M100=3.14’
$ caput pmac0:mbxSoSig1 M100</td>
</tr>
</tbody>
</table>
<ol class="arabic" start="2">
<li><div class="first line-block">
<div class="line">For the VME non-signal S1 variation:
| In the second Linux host window type:</div>
</div>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:mbxSoSig0 ‘M100=6.28’
$ caput pmac0:mbxSoSig0 M100</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After step 1 of the procedure verify that</dt>
<dd>camonitor in the first Linux terminal
window reports the values of pmac0:Ai and
pmac0:mbxSoSig1 as follows:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">pmac0:dprAi 2016-08-23 17:03:46.400063
3.14</p>
<p>pmac0:mbxSoSig1 2016-08-23 17:03:46.442391</p>
<p class="last">pmac0:mbxSoSig1 2016-08-23 17:04:32.459209
3.14</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>After step 2 of the procedure verify that</dt>
<dd>camonitor reports the values of pmac0:Ai
and pmac0:mbxSoSig0 as follows:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">pmac0:dprAi 2016-08-23 17:08:12.487568
6.28</p>
<p class="last">pmac0:mbxSoSig0 2016-08-23 17:08:20.824495
m100</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-13-load-record-support-for-pmac-vme-ascii-1">
<span id="id336"></span><h3>3.15.15 REQ 113-13 Load Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-13-load-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-14-status-record-support-for-pmac-vme-ascii-1">
<span id="id337"></span><h3>3.15.16 REQ 113-14 Status Record Support for PMAC-VME ASCII<a class="headerlink" href="#req-113-14-status-record-support-for-pmac-vme-ascii-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-15-analog-input-record-support-for-pmac-vme-dpram-1">
<span id="id338"></span><h3>3.15.17 REQ 113-15 Analog Input Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-15-analog-input-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><p class="first rubric"><a href="#id339"><span class="problematic" id="id340">`</span></a>3.15.14 REQ
113-12 &lt;#req-113-12-strin</p>
<dl class="docutils">
<dt>g-output-record-support-for-pmac-vme-ascii-1&gt;`__</dt>
<dd>String Output Record Support for PMAC-VME
ASCII
:name: req-113-12-s</dd>
</dl>
<p class="last">tring-output-record-support-for-pmac-vme-ascii-2</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li>None</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Successful completion of <a href="#id341"><span class="problematic" id="id342">`</span></a>3.15.14 REQ</dt>
<dd>113-12 &lt;#req-113-12-strin</dd>
</dl>
</li>
</ol>
<dl class="last docutils">
<dt>g-output-record-support-for-pmac-vme-ascii-1&gt;`__</dt>
<dd>String Output Record Support for PMAC-VME
ASCII</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-16-analog-output-record-support-for-pmac-vme-dpram-1">
<span id="id343"></span><h3>3.15.18 REQ 113-16 Analog Output Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-16-analog-output-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><a class="reference external" href="#req-113-15-analog-input-record-support-for-pmac-vme-dpram-1">3.15.17 REQ 113-15 Analog Input Record Support
for PMAC-VME
DPRAM</a></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>None</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>Successful completion of <a class="reference external" href="#req-113-15-analog-input-record-support-for-pmac-vme-dpram-1">3.15.17 REQ 113-15
Analog Input Record Support for PMAC-VME
DPRAM</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-17-binary-input-record-support-for-pmac-vme-dpram-1">
<span id="id344"></span><h3>3.15.19 REQ 113-17 Binary Input Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-17-binary-input-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-18-binary-output-record-support-for-pmac-vme-dpram-1">
<span id="id345"></span><h3>3.15.20 REQ 113-18 Binary Output Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-18-binary-output-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-19-event-record-support-for-pmac-vme-dpram-1">
<span id="id346"></span><h3>3.15.21 REQ 113-19 Event Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-19-event-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-20-long-input-record-support-for-pmac-vme-dpram-1">
<span id="id347"></span><h3>3.15.22 REQ 113-20 Long Input Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-20-long-input-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-21-long-output-record-support-for-pmac-vme-dpram-1">
<span id="id348"></span><h3>3.15.23 REQ 113-21 Long Output Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-21-long-output-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-22-multibit-binary-input-record-support-for-pmac-vme-dpram-1">
<span id="id349"></span><h3>3.15.24 REQ 113-22 Multibit Binary Input Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-22-multibit-binary-input-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-23-multibit-binary-output-record-support-for-pmac-vme-dpram-1">
<span id="id350"></span><h3>3.15.25 REQ 113-23 Multibit Binary Output Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-23-multibit-binary-output-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">NOTE: This type of record is not used at Gemini</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-24-status-record-support-for-pmac-vme-dpram-1">
<span id="id351"></span><h3>3.15.26 REQ 113-24 Status Record Support for PMAC-VME DPRAM<a class="headerlink" href="#req-113-24-status-record-support-for-pmac-vme-dpram-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Open 2 Linux host terminals, configured as</dt>
<dd>described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In one terminal, start the pmac status record</dt>
<dd>monitor display screen:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">$
/gem
_sw/prod/R3.14.12.4/support/pmaclib/{ver}/
bin/linux-x86_64/pmaclibTest.sh</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="other/ccb/./media/media/image4.png"><img alt="pmacStatusRecMonitor.png" src="other/ccb/./media/media/image4.png" style="width: 4.38021in; height: 1.72917in;" /></a></td>
</tr>
</tbody>
</table>
<p class="last">￼</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>In the second terminal, issue the following</dt>
<dd>command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:dprLo 2147483647</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Again, In the second terminal, issue the</dt>
<dd>following command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:dprLo 11184810</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Again, In the second terminal, issue the</dt>
<dd>following command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>caput pmac0:dprLo 5592405</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><dl class="first docutils">
<dt>Again, In the second terminal, issue the</dt>
<dd>following command:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>caput pmac0:dprLo 0</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>After step 1 of the procedure, verify that</dt>
<dd>the status record monitor screen indicates
all bits 0 - 23 are green.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step 2 of the procedure verify that</dt>
<dd>same screen indicates only the odd
numbered bits up to bit 23 are green.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step 3 of the procedure, verify that</dt>
<dd>same screen indicates only the even
numbered bits up to bit 22 are green.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step 4 of the procedure, verify that</dt>
<dd>same screen indicates none of the bits are
green.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Verify that for each step of the procedure</dt>
<dd>the status record monitor screen does not
indicate any of the bits 24 - 31 become
green.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-25-two-card-support-1">
<span id="id352"></span><h3>3.15.27 REQ 113-25 Two Card Support<a class="headerlink" href="#req-113-25-two-card-support-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><p class="first">This will test basic functionality of two PMAC
cards on one CPU</p>
<p class="last">Details incomplete</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-26-continuous-data-stream-1-card">
<h3>3.15.28 REQ 113-26 Continuous Data Stream 1 card<a class="headerlink" href="#req-113-26-continuous-data-stream-1-card" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Open 3 Linux host terminals, configured as</dt>
<dd>described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In the first terminal, issue the following</dt>
<dd>command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor pmac0:azM60 pmac0:azM61 …
pmac0:azM79</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>In the second terminal, issue the following</dt>
<dd>command:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor pmac0:M90 pmac0:M91 … pmac0:M109</td>
</tr>
</tbody>
</table>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>In the first terminal, issue the following</dt>
<dd>command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:Tracking.SCAN “1 second”</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Wait around 10 seconds and issue the</dt>
<dd>following command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:Tracking.SCAN “Passive”</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>In the first terminal, issue the following</dt>
<dd>command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:Tracking.SCAN “.01 second”</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><dl class="first docutils">
<dt>Wait around 10 seconds and issue the</dt>
<dd>following command:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:Tracking.SCAN “Passive”</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>After step 2 of the procedure, verify that</dt>
<dd>the timestamp difference between
pmac0:azM60 and pmac0:M90 is 0.01 second
or less.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Verify that the timestamp difference between</dt>
<dd>two correlatives instances of pmac0:M90 os
1 second. Also the value for pmac0:azM60
and pmac0:M90 must be the same.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>After step 3 of the procedure, verify that</dt>
<dd>the timestamp difference between
pmac0:azM60 and pmac0:M90 is 0.01 second
or less.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Verify that the timestamp difference between</dt>
<dd>two correlatives instances of pmac0:M90 os
.01 second. Also the value for pmac0:azM60
and pmac0:M90 must be the same.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-27-two-continuous-data-streams-2-cards">
<h3>3.15.29 REQ 113-27 Two Continuous Data Streams 2 cards<a class="headerlink" href="#req-113-27-two-continuous-data-streams-2-cards" title="Permalink to this headline">¶</a></h3>
<p>Procedure
Success Criteria
================</p>
</div>
<div class="section" id="req-113-28-servo-data-reporting-thread">
<h3>3.15.30 REQ 113-28 Servo Data Reporting Thread<a class="headerlink" href="#req-113-28-servo-data-reporting-thread" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminal, configured as</dt>
<dd>described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup.</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In the first terminal window, use camonitor</dt>
<dd>to monitor the value of pmac0:aiOpn</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor pmac0:aiSvo</td>
</tr>
</tbody>
</table>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>In the second Linux host terminal, command</dt>
<dd>the value of pmac0:aoOpn:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:aoSvo 1.414</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>1Verify that camonitor in the first Linux</dt>
<dd>host terminal reports the correct value
for pmac0:aiSvo:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>pmac0:aiSvo 2016-08-26 14:01:49.050103 1.414</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-29-background-fixed-data-reporting-thread">
<h3>3.15.31 REQ 113-29 Background Fixed Data Reporting Thread<a class="headerlink" href="#req-113-29-background-fixed-data-reporting-thread" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminal, configured as</dt>
<dd>described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup.</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In the first terminal window, use camonitor</dt>
<dd>to monitor the value of pmac0:aiOpn</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor pmac0:aiBfd</td>
</tr>
</tbody>
</table>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Verify that camonitor in the first Linux host</dt>
<dd>terminal reports the correct value for
pmac0:aiBfd:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>pmac0:aiBfd 2016-08-26 14:01:49.050103 98.62</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-30-background-variable-data-reporting-thread">
<h3>3.15.32 REQ 113-30 Background Variable Data Reporting Thread<a class="headerlink" href="#req-113-30-background-variable-data-reporting-thread" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Open two Linux host terminal, configured as</dt>
<dd>described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup.</a></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>In the first terminal window, use camonitor</dt>
<dd>to monitor the value of pmac0:aiBvd</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor pmac0:aiBvd</td>
</tr>
</tbody>
</table>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>In the second Linux host terminal, command</dt>
<dd>the value of pmac0:mbxSoSig1</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:mb</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Verify that camonitor in the first Linux host</dt>
<dd>terminal reports the correct value for
pmac0:aiBvd:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>pmac0:aiBvd 2016-09-06 15:38:21.975589 12345</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-31-open-area-data-thread">
<h3>3.15.33 REQ 113-31 Open Area Data Thread<a class="headerlink" href="#req-113-31-open-area-data-thread" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><p class="first">Open two Linux host terminal, configured as
described in <a class="reference external" href="#linux-host-setup">3.1 Linux Host
Setup.</a></p>
<p>In the first terminal window, use camonitor to
monitor the value of pmac0:aiOpn</p>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor pmac0:aiOpn</td>
</tr>
</tbody>
</table>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple" start="2">
<li><dl class="first docutils">
<dt>In the second Linux host terminal, command</dt>
<dd>the value of pmac0:aoOpn:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput pmac0:aoOpn 3.14159</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple" start="2">
<li><dl class="first docutils">
<dt>Verify that camonitor in the first Linux host</dt>
<dd>terminal reports the correct value for
pmac0:aiOpn:</dd>
</dl>
</li>
</ol>
<p class="last">+-
———————————————–+
|
pmac0:aiOpn 2016-08-26 14:01:49.050103 3.14159 |
+-
———————————————–+</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-32-file-download-thread-1">
<span id="id353"></span><h3>3.15.34 REQ 113-32 File Download Thread<a class="headerlink" href="#req-113-32-file-download-thread-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-113-33-gather-data-readwrite-threads-1">
<span id="id354"></span><h3>3.15.35 REQ 113-33 Gather Data Read/Write Threads<a class="headerlink" href="#req-113-33-gather-data-readwrite-threads-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>This test is waived.</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="oms44">
<h2>3.16 OMS44<a class="headerlink" href="#oms44" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-13">
<span id="id355"></span><h3>3.16.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-13" title="Permalink to this headline">¶</a></h3>
<p>Setup your test OMS VME44 with the proper jumper and switch settings to
define the base address. This test will use the factory default address
of 0xFF80,jumpers for address line A15, A14, A13, A12, A11, A10, A9 and
A8 on J25 and A7 on J26 should be absent, selecting 1 for those lines.
Jumpers should be placed on A6, A7 and A4 on J26, selecting a 0 for
those lines. Alternatively, for GS testing, address 0xFC00 (Jumpers on
A7, A8 &amp; A9) could be used, avoiding a later change when live testing.
The OMS44 allows Short Non-Previleged Access setting a jumper on lines
AM1 and AM4 to decode them when they are low, no jumper should be on AM0
and AM5 so they will be decoded when high.</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="21%" />
<col width="16%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Hex Value</th>
<th class="head">Switches</th>
<th class="head">Switch Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Interrupt Level 5</td>
<td>0xEF/0xB</td>
<td>J15/J35</td>
<td>11101111/1011</td>
</tr>
<tr class="row-odd"><td>Limit Polarity
Selection</td>
<td>0x0</td>
<td>J24</td>
<td>0000</td>
</tr>
<tr class="row-even"><td>Base Address, A16,
non-privileged</td>
<td><p class="first">0xFF80</p>
<p class="last">(0xFC00 GS)</p>
</td>
<td>J25/J26</td>
<td><p class="first">11111111/10000011</p>
<p class="last">(
11111110/00000011)</p>
</td>
</tr>
<tr class="row-odd"><td>Encoder Bias
Selection (T &amp; Z
Axes)</td>
<td>0xF</td>
<td>J11</td>
<td>1111</td>
</tr>
<tr class="row-even"><td>Encoder Bias
Selection (X &amp; Y
Axes)</td>
<td>0xF</td>
<td>J14</td>
<td>1111</td>
</tr>
<tr class="row-odd"><td>I/O and Pull Up
Select</td>
<td>0xFC</td>
<td>J32</td>
<td>11111100</td>
</tr>
</tbody>
</table>
<p>You will also need to setup a test-bench in order to test hardware I/O.
The following should be the setup:</p>
<p>Hardware needed</p>
<ul class="simple">
<li>Bread Board</li>
<li>VME Backboard cable w/64Pin connector</li>
<li>Oscilloscope with passive 10x probes</li>
<li>Resistor 300 Ohm</li>
<li>Switch 2 positions</li>
<li>Wires</li>
</ul>
<p>Setup</p>
<ul class="simple">
<li>Using the bread-board, make the following connections</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">64DIN Connector Pin</th>
<th class="head">Bread Board</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>21a</td>
<td>Resistor Terminal A</td>
</tr>
<tr class="row-odd"><td>21c</td>
<td>Resistor Terminal B</td>
</tr>
<tr class="row-even"><td>23a</td>
<td>Switch Terminal 1</td>
</tr>
<tr class="row-odd"><td>24c</td>
<td>Switch Terminal 2</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><a class="reference internal" href="other/ccb/./media/media/image5.png"><img alt="oms44_testbench.png" src="other/ccb/./media/media/image5.png" style="width: 6.34375in; height: 4.65278in;" /></a></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Fig: OMS44 Motor Test Bench</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><dl class="first docutils">
<dt>Connect the 64 pin VME cable to backplane connector P2 of the OMS44</dt>
<dd>slot</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Connect Channel 1 of the oscilloscope to the connection point</dt>
<dd>Resistor B.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="epics-test-harness-13">
<span id="id356"></span><h3>3.16.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-13" title="Permalink to this headline">¶</a></h3>
<p>The OMS44 driver is equipped with an epics records which can be loaded
during startup. The database can be viewed in oms44App/Db/oms44Test.sch.
Make sure your SYS_TDCT_PATHS is defined like this,</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">[xy566App/Db]&gt;echo $SYS_TDCT_PATHS</p>
<p class="last">/gem_sw/epics/R3.14.12.4/exte
nsions/src/tdct/sym:/gem_sw/prod/R3.14.12.4/support/geminiRec/4-0/db</p>
</td>
</tr>
</tbody>
</table>
<p>and use the tdct like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>[xy566App/Db]&gt;tdct -cfg ./tdct.cfg -i oms44Test.sch</td>
</tr>
</tbody>
</table>
<p>The test harness motor record</p>
<div class="section" id="add-the-oms44test-db">
<h4>3.16.2.1 Add the oms44Test.db<a class="headerlink" href="#add-the-oms44test-db" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>If you need to, create a test ioc in the ADE environment, Eg.,</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$gem-start-new-module.py -i labvme8/CP</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>The OMS44 module provides driver and device support for the OMS VME44</dt>
<dd>card. Edit your configure/RELEASE to include the OMS44 module from
PROD:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">PRODSUP = /gem_sw/prod/R3.14.12.4/support</p>
<p>…</p>
<p class="last">OMS44=$(PRODSUP)/oms44/1-0-1</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Find your labvme8-CP-App/Db/Makefile and edit your Makefile to</dt>
<dd>include the test harness as described in <a class="reference external" href="https://docs.google.com/document/d/18Dh69MtvqhNOmubMdDTA2BO2wkRWw3m_DF5OXEk58cc/edit#heading=h.61tktv79xmlv">3.2.1 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += oms44Test.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-oms44-dbd-file-and-library">
<h4>3.16.2.2 Add the OMS44 DBD file and library<a class="headerlink" href="#add-the-oms44-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<p>Include the following dbd and libraries in your
gemtest1-MKApp/src/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">labvme8-CP-ioc_DBD += oms44.dbd</p>
<p>…</p>
<p class="last">labvme8-CP-ioc_LIBS += oms44</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-12">
<span id="id357"></span><h4>3.16.2.3 Startup Script<a class="headerlink" href="#startup-script-12" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/labvme8-CP-ioc</p>
<p>cd ${INSTALL}</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”&lt;YOUR NAME&gt;”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/labvme8-CP-ioc.dbd”)</p>
<p>labvme8-CP-ioc_registerRecordDeviceDriver(pdbbase)</p>
<p>## Load record instances</p>
<p>dbLoadRecords(“db/oms44Test.db”)</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install-6">
<span id="id358"></span><h4>3.16.2.4 Build and install<a class="headerlink" href="#build-and-install-6" title="Permalink to this headline">¶</a></h4>
<p>Build the test ioc:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd labvme8/CP</p>
<p class="last">$ make distclean uninstall; make</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-114-01-initialize-1">
<span id="id359"></span><h3>3.16.3 REQ-114-01 Initialize<a class="headerlink" href="#req-114-01-initialize-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your IOC and CPU board are setup</dt>
<dd>as described in <a href="#id360"><span class="problematic" id="id361">`</span></a>3.2 CPU Board
Setup &lt;<a class="reference external" href="https://docs.goo">https://docs.goo</a></dd>
</dl>
</li>
</ol>
<p>gle.com/document/d/18Dh69MtvqhNOmubMdDTA2BO2wkRW
w3m_DF5OXEk58cc/edit#heading=h.ipoe1u10cu8i&gt;`__.</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt>Ensure that your OMS VME44 board is setup as</dt>
<dd>described in 3.16.1 Test Setup and
Prerequisites.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Prepare your test IOC for the OMS44 Tests as</dt>
<dd>described in 3.16.2 EPICS Test Harness.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot the prepared IOC and confirm the startup</dt>
<dd>script fully executes.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li>The IOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will be running and will</dt>
<dd>have initialized the oms44 driver as a
result.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-114-02-oms44-motor-record-support-1">
<span id="section-12"></span><span id="section-11"></span><span id="id362"></span><h3>3.16.4 REQ-114-02 OMS44 Motor Record Support<a class="headerlink" href="#req-114-02-oms44-motor-record-support-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li>3.16.3 REQ-114-01 Initialize</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the board successfully initializes, set</dt>
<dd>the EPICS_CA_ADDR_LIST to the IOC IP.
Using the export linux command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&gt; export EPICS_CA_ADDR_LIST &lt;IOC IP&gt;</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Start the GCAL dm-screen on any console</dt>
<dd>machine</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&gt; gcal</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Open the Filter Device Control dm screen.</dt>
<dd>Click on the Engineering screen button and
select Filter Device Control option menu.
Use the leftmost mouse button</dd>
</dl>
</li>
</ol>
<p>.</p>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Select the INIT command by clicking the INIT</dt>
<dd>button in the MODE menu. Then, click the
GO button</dd>
</dl>
</li>
</ol>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Select the INDEX command by clicking the</dt>
<dd><p class="first last">INDEX button in the MODE menu. Then, click
the GO button</p>
</dd>
</dl>
<ol class="loweralpha simple">
<li>Close switch, then open</li>
<li>Repeat to complete index</li>
</ol>
</li>
</ol>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Select the MOVE command by clicking the INIT</dt>
<dd>button in the MODE menu. Enter a position
in the target position field. Then, click
the GO button.</dd>
</dl>
</li>
</ol>
<ol class="last arabic simple">
<li><dl class="first docutils">
<dt>Select the PARK command by clicking the PARK</dt>
<dd>button in the MODE menu. Then, click the
GO button</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>The mechanism initializes without any</dt>
<dd>problem.</dd>
</dl>
</li>
<li>The mechanism indexes triggered by the switch</li>
<li><dl class="first docutils">
<dt>During index, move and park, the oscilloscope</dt>
<dd>should display the pulse signal outputed
by the OMS card</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="ipac-tip810">
<span id="section-14"></span><span id="section-13"></span><h2>3.17 IPAC/tip810<a class="headerlink" href="#ipac-tip810" title="Permalink to this headline">¶</a></h2>
<div class="section" id="req-115-01">
<h3>3.17.1 REQ-115-01<a class="headerlink" href="#req-115-01" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="req-115-02">
<h3>3.17.2 REQ-115-02<a class="headerlink" href="#req-115-02" title="Permalink to this headline">¶</a></h3>
</div>
</div>
<div class="section" id="drvserial-1">
<span id="id363"></span><h2>3.18 drvSerial<a class="headerlink" href="#drvserial-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-14">
<span id="id364"></span><h3>3.18.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-14" title="Permalink to this headline">¶</a></h3>
<p>Set up a VME crate running EPICS. Insert a loopback plug into the second
serial port of the IOC .</p>
</div>
<div class="section" id="epics-test-harness-14">
<span id="id365"></span><h3>3.18.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-14" title="Permalink to this headline">¶</a></h3>
<p>The drvSerial driver does not need a database to run the tests. The test
programs will be loaded on a VME crate running EPICS and executed from
the EPICS shell.</p>
<div class="section" id="add-the-c-code">
<h4>3.18.2.1 Add the C code<a class="headerlink" href="#add-the-c-code" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>If you need to, create a test ioc in the ADE environment, Eg.,</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$gem-start-new-module.py -i gemtest1/CP</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>The drvSerial module provides driver and device support for the OMS</dt>
<dd>VME44 card. Edit your configure/RELEASE to include the drvSerial
module from either WORK or PROD:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>SERIAL = /gem_sw/prod/R3.14.12.4/support/drvSerial/2-0-4</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-drvserial-and-drvserialtest-dbd-files-and-libraries">
<h4>3.18.2.2 Add the drvSerial and drvSerialTest DBD files and libraries<a class="headerlink" href="#add-the-drvserial-and-drvserialtest-dbd-files-and-libraries" title="Permalink to this headline">¶</a></h4>
<p>Include the following dbd and libraries in your
gemtest1-CPApp/src/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-CP_DBD += drvSerial.dbd</p>
<p>gemtest1-CP_DBD += drvSerialTest.dbd</p>
<p>…</p>
<p>gemtest1-CP_LIBS += drvSerial</p>
<p class="last">gemtest1-CP_LIBS += drvSerialTest</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-13">
<span id="id366"></span><h4>3.18.2.3 Startup Script<a class="headerlink" href="#startup-script-13" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-CP</p>
<p>cd ${INSTALL}</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”&lt;YOUR NAME&gt;”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>gemtest1_CP_registerRecordDeviceDriver(pdbbase)</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install-7">
<span id="id367"></span><h4>3.18.2.4 Build and install<a class="headerlink" href="#build-and-install-7" title="Permalink to this headline">¶</a></h4>
<p>Build the test ioc:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd gemtest1/CP</p>
<p class="last">$ make distclean uninstall; make</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="tst-116-01-initialize">
<h3>3.18.3 TST-116-01 Initialize<a class="headerlink" href="#tst-116-01-initialize" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your IOC and CPU board are setup</dt>
<dd>as described in the CPU Board Setup.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure that your serial port is setup as</dt>
<dd>described in Test Setup and Prerequisites.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Prepare your test IOC for the drvSerial Tests</dt>
<dd>as described in the EPICS Test Harness.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot the prepared IOC and confirm the startup</dt>
<dd>script fully executes.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li>The IOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will be running and will</dt>
<dd>have initialized the drvSerial driver as a
result.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tst-116-02-drvserial-attach-link">
<span id="section-15"></span><h3>3.18.4 TST-116-02 drvSerial Attach Link<a class="headerlink" href="#tst-116-02-drvserial-attach-link" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li>REQ-116-01 Initialize</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the IOC has boot successfully, verify</dt>
<dd>that there are no errors reported at
iocInit.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Run the drvSerialTestAttach routine from the</dt>
<dd>EPICS shell:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>prompt&gt; drvSerialTestAttachLink /dev/ttyS1</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Run the drvSerialTestCreateLink routine from</dt>
<dd>the EPICS shell</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>prompt&gt; drvSerialTestVreateLink /dev/ttyS1</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="4">
<li><dl class="first docutils">
<dt>Run the drvSerialTestAttachLink routine again</dt>
<dd>from the EPICS shell.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>prompt&gt; drvSerialTestAttachLink /dev/ttyS1</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After step 2 of the test procedure, the</dt>
<dd>following message shall be printed on the
console:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>drvSerialAttachLink(): No link exists to
which to attach</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>After step 3 of the test procedure, the</dt>
<dd>following message shall be printed on the
console:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>drvSerialAttachLink(): attached to link on
port /dev/ttyS1</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tst-116-03-drvserial-create-link">
<h3>3.18.5 TST-116-03 drvSerial Create Link<a class="headerlink" href="#tst-116-03-drvserial-create-link" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic">
<li><p class="first"><a href="#id368"><span class="problematic" id="id369">`</span></a>TST-116-02 drvSerial Attach</p>
<blockquote>
<div><p>Link &lt;#tst-116-02-drvserial-attach-link&gt;`__</p>
</div></blockquote>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li>(None)</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li>Successful completion of TEST-116-02</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tst-116-04-send-message">
<h3>3.18.6 TST-116-04 Send Message<a class="headerlink" href="#tst-116-04-send-message" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt><a href="#id370"><span class="problematic" id="id371">`</span></a>TST-116-02</dt>
<dd>drvSerialA</dd>
</dl>
</li>
</ol>
<p class="last">ttachLink &lt;#tst-116-02-drvserial-attach-link&gt;`__</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Run the drvSerialTestSend routine from the</dt>
<dd>IPICS shell:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>prompt&gt; drvSerialTestSend</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Verify that the following messages are</dt>
<dd>printed on the console:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">drvSerialTestSend(): sizeof(req)=268,
sizeof(req.buf)=256</p>
<p>drvSerialTestPrintBuffer (serialTestSend)</p>
<div class="line-block">
<div class="line">[A print out of the random buffer data,
with lines like:</div>
<div class="line">[87] [f3] [ :] [ +] [06] [da] [99] [dd]
…</div>
<div class="line">…</div>
</div>
<p>… [f2] [ p] [b2] [97] [ J] [da]</p>
<p>]</p>
<p>172.16.2.23&gt; sendRequest: nwritten=255</p>
<p>drvSerialTestParser() called, bufCount =
255</p>
<p>172.16.2.23&gt; sendRequest: nwritten=255</p>
<p class="last">drvSerialTestParser() called, bufCount =
255</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tst-116-05-receive-response">
<h3>3.18.7 TST-116-05 Receive Response<a class="headerlink" href="#tst-116-05-receive-response" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><a class="reference external" href="#_itgb3wi5s82f">TST-116-04 Send Message</a></li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Run the drvSerialTestReceive routine from the</dt>
<dd>EPICS shell</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>prompt&gt; drvSerialTestReceive</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Verify the following messages are printed on</dt>
<dd>the console:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">drvSerialTestPrintBuffer
(serialTestReceive)</p>
<div class="line-block">
<div class="line">[A print out of the random buffer data,
with lines like:</div>
<div class="line">[87] [f3] [ :] [ +] [06] [da] [99] [dd]
…</div>
<div class="line">…</div>
</div>
<p>… [f2] [ p] [b2] [97] [ J] [da]</p>
<p>]</p>
<p>bufCount=255</p>
<p class="last">Buffers agree</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tst-116-06-drvserial-report">
<h3>3.18.8 TST-116-06 drvSerial Report<a class="headerlink" href="#tst-116-06-drvserial-report" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id372"><span class="problematic" id="id373">`</span></a>TST-116-05 Receive</dt>
<dd>Response &lt;#tst-116-05-receive-response&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Run the i/o report routine on the IOC</dt>
<dd>console:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>prompt&gt; dbior drvSerial 10</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Verify the following lines are printed on the</dt>
<dd>IOC console:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">Driver: drvSerial</p>
<p>Device Name =/dev/ttyS1</p>
<p>Request Queue</p>
<p>Pri=0 Pending=0 Reserved=0</p>
<p>Pri=1 Pending=0 Reserved=0</p>
<p>Pri=2 Pending=0 Reserved=0</p>
<p>Response Q cnt=0</p>
<p>mutexSem epicsMutexId 0x2d9c48 source
../drvSerial.c line 577</p>
<p>1a010b97 Not Held</p>
<p>writeQueueSem 1a010b96 Held by:0a01002c
(SerialWT) Nest count:1</p>
<p>readQueueSem 1a010b95 Held by:0a010001
(_main_) Nest count:1</p>
<p>Bucket entries in use = 1 bytes in use =
1060</p>
<p class="last">Bucket entries/hash id - mean = 0.003906
std dev = 0.062378 max = 1</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="abdf1-1">
<span id="section-16"></span><span id="id374"></span><h2>3.19 AbDf1<a class="headerlink" href="#abdf1-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-15">
<span id="id375"></span><h3>3.19.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-15" title="Permalink to this headline">¶</a></h3>
<p>This test requires an Allen-Bradley PLC-5 Programmable Logic Controllers
(PLC) up and running. This PLC communicates using an asynchronous
byte-oriented protocol that is used to communicate with most Allen
Bradley RS232 interface modules, called DF1. It works over half duplex
and full duplex modes of communication. The AbDf1 driver implements the
DF1 protocol and uses drvSerial to talk to serial lines.</p>
</div>
<div class="section" id="epics-test-harness-15">
<span id="id376"></span><h3>3.19.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-15" title="Permalink to this headline">¶</a></h3>
<p>The Allen-Bradley driver is equipped with a set of EPICS records which
can be loaded during startup and used for testing. The database can be
viewed in labvme-cp-iocApp/Db/abdf1test.sch. Open in tdct like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>[labvme-cp-iocApp/Db]&gt;tdct -cfg ./tdct.cfg -i abdf1test.sch</td>
</tr>
</tbody>
</table>
<div class="section" id="add-the-abdf1test-db">
<h4>3.19.2.1 Add the abdf1test.db<a class="headerlink" href="#add-the-abdf1test-db" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>If you need to create a test ioc in the ADE environment, Eg.</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$gem-start-new-module.py -i labvme/cp</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Edit your configure/RELEASE to include the Allen-Bradley module from</dt>
<dd>either WORK or PROD:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">ABDF1=/gem_sw/prod/R3.14.12.4/support/AbDf1/2-0-1</p>
<p class="last">DRVSERIAL=$(PRODSUP)/drvSerial/2-0-5</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Find your labvme-cp-iocApp/Db/ and edit your Makefile to include the</dt>
<dd>Allen-Bradley test database:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += AbDf1test.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-abdf1-dbd-file-and-library">
<h4>3.19.2.2 Add the AbDf1 DBD file and Library<a class="headerlink" href="#add-the-abdf1-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<p>Include the following dbd and library in your
labvme-cp-iocApp/src/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">labvme-cp-ioc_DBD += drvSerial.dbd</p>
<p>labvme-cp-ioc_DBD += AbDf1.dbd</p>
<p>…</p>
<p>labvme-cp-ioc_LIB += drvSerial</p>
<p class="last">labvme-cp-ioc_LIB += AbDf1</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-14">
<span id="section-17"></span><span id="id377"></span><h4>3.19.2.3 Startup Script<a class="headerlink" href="#startup-script-14" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/labvme-cp-ioc</p>
<p>cd ${INSTALL}</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”&lt;YOUR NAME&gt;”)</p>
<p>epicsEnvSet(“LOCATION”,”CP”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/labvme-cp-ioc.dbd”)</p>
<p>labvme_cp_ioc_registerRecordDeviceDriver(pdbbase)</p>
<p>…</p>
<p>## Load record instances</p>
<p>dbLoadRecords(“db/abdf1test.db”, “user=&lt;your name&gt;”)</p>
<p>var drvAbDf1SrcStationNumber 11</p>
<p>var drvAbDf1Debug 2</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-117-01-initialize-1">
<span id="id378"></span><h3>3.19.3 REQ-117-01 Initialize<a class="headerlink" href="#req-117-01-initialize-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your Allen-Bradley is set up as</dt>
<dd>described in <a href="#id379"><span class="problematic" id="id380">`</span></a>3.19.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites. &lt;#test-setup-and-prerequisites-15&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Allen-Bradley</dt>
<dd>tests as described in <a class="reference external" href="#epics-test-harness-15">3.19.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot the prepared IOC and confirm the startup</dt>
<dd>script fully executes.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li>The IOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will be running and will</dt>
<dd>have initialized the Allen-Bradley Driver
and the serial driver as a result.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-117-02-epics-report-1">
<span id="id381"></span><h3>3.19.4 REQ 117-02 EPICS Report<a class="headerlink" href="#req-117-02-epics-report-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id382"><span class="problematic" id="id383">`</span></a>3.19.3</dt>
<dd>Initialize &lt;#req-117-01-initialize-1&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the board successfully initializes, run</dt>
<dd>the AbDf1 driver report:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>labvme&gt; dbior drvAbDf1Report 1</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>The console will report the number of cards</dt>
<dd>configured and the state of the driver</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Add output from command</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id384">
<h3>3.19.5 REQ-117-03 Analog Input Record Support for AB DF1 Serial (SCAN I/O Intr)<a class="headerlink" href="#id384" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your Allen-Bradley is set up as</dt>
<dd>described in <a href="#id385"><span class="problematic" id="id386">`</span></a>3.19.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites. &lt;#test-setup-and-prerequisites-15&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Allen-Bradley</dt>
<dd>tests as described in <a class="reference external" href="#epics-test-harness-15">3.19.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
<li>Open a Linux host terminal</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>In the Linux host terminal, run camonitor on</dt>
<dd>the Analog Input record:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor plc:ai</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Verify that the camonitor is showing the</dt>
<dd>value of plc:ai is being incremented every
half second.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-117-04-analog-output-record-support-for-ab-df1-serial-1">
<span id="id387"></span><h3>3.19.6 REQ-117-04 Analog Output Record Support for AB DF1 Serial<a class="headerlink" href="#req-117-04-analog-output-record-support-for-ab-df1-serial-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your Allen-Bradley is set up as</dt>
<dd>described in <a href="#id388"><span class="problematic" id="id389">`</span></a>3.19.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites. &lt;#test-setup-and-prerequisites-15&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Allen-Bradley</dt>
<dd>tests as described in <a class="reference external" href="#epics-test-harness-15">3.19.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
<li>Open a Linux host terminal</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>In the Linux host terminal, run camonitor on</dt>
<dd>the Analog Input record:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor plc:ao</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Verify that the camonitor is showing the</dt>
<dd>value of plc:ao is being incremented every
half second.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-117-05-binary-output-record-support-for-ab-df1-serial-scan-i-o-intr">
<h3>3.19.7 REQ-117-05 Binary Output Record Support for AB DF1 Serial(SCAN I/O Intr)<a class="headerlink" href="#req-117-05-binary-output-record-support-for-ab-df1-serial-scan-i-o-intr" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your Allen-Bradley is set up as</dt>
<dd>described in <a href="#id390"><span class="problematic" id="id391">`</span></a>3.19.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites. &lt;#test-setup-and-prerequisites-15&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Allen-Bradley</dt>
<dd>tests as described in <a class="reference external" href="#epics-test-harness-15">3.19.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
<li>Open a Linux host terminal</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>In the Linux host terminal, populate the</dt>
<dd>output record using the caput command:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput plc:bo 0</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li>run camonitor on the binary Input record:</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ camonitor plc:bi</p>
<p class="last">camonitor plc:bi 0</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Verify that the binary input (plc:bi) channel</dt>
<dd>is set to 0</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-117-06-binary-input-record-support-for-ab-df1-serial">
<h3>3.19.8 REQ-117-06 Binary Input Record Support for AB DF1 Serial<a class="headerlink" href="#req-117-06-binary-input-record-support-for-ab-df1-serial" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your Allen-Bradley is set up as</dt>
<dd>described in <a href="#id392"><span class="problematic" id="id393">`</span></a>3.19.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites. &lt;#test-setup-and-prerequisites-15&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Allen-Bradley</dt>
<dd>tests as described in <a class="reference external" href="#epics-test-harness-15">3.19.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
<li>Open a Linux host terminal</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>In the Linux host terminal, run camonitor on</dt>
<dd>the binary Input record:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ camonitor plc:bi</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>Populate the output record using the caput</dt>
<dd>command:</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$ caput plc:bo 1</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Verify that the binary input (plc:bi) channel</dt>
<dd>is set to 1</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-117-07-two-plc-support">
<h3>3.19.9 REQ-117-07 Two PLC Support<a class="headerlink" href="#req-117-07-two-plc-support" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your Allen-Bradley is set up as</dt>
<dd>described in <a href="#id394"><span class="problematic" id="id395">`</span></a>3.19.1 Test Setup and
Prer</dd>
</dl>
</li>
</ol>
<p>equisites. &lt;#test-setup-and-prerequisites-15&gt;`__</p>
<ol class="last arabic simple" start="2">
<li><dl class="first docutils">
<dt>Prepare your test IOC for the Allen-Bradley</dt>
<dd>tests as described in <a class="reference external" href="#epics-test-harness-15">3.19.2 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="tcslib-1">
<span id="section-19"></span><span id="section-18"></span><span id="id396"></span><h2><strong>3.20 tcslib</strong><a class="headerlink" href="#tcslib-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-16">
<span id="id397"></span><h3>3.20.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-16" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="epics-test-harness-16">
<span id="id398"></span><h3>3.20.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-16" title="Permalink to this headline">¶</a></h3>
<p>This module will be tested using the Gemini Records Test Harness
Database.</p>
<div class="section" id="add-the-db">
<h4>3.20.2.1 Add the ……db<a class="headerlink" href="#add-the-db" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-libraries-3">
<span id="id399"></span><h4>3.20.2.2 Add the libraries<a class="headerlink" href="#add-the-libraries-3" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-CP_DBD += tcslib.dbd</p>
<p>…</p>
<p class="last">gemtest1-CP_LIBS += tcslib</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="startup-script-15">
<span id="id400"></span><h4>3.20.2.3 Startup Script<a class="headerlink" href="#startup-script-15" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$(LINUX_ONLY)#!${INSTALL}/bin/${ARCH}/gemtest1-MK</p>
<p>cd ${INSTALL}</p>
<p>zoneset(“UTC0”)</p>
<p>epicsEnvSet(“ENGINEER”,”&lt;YOUR NAME&gt;”)</p>
<p>epicsEnvSet(“LOCATION”,”HBF”)</p>
<p>## Register all support components</p>
<p>dbLoadDatabase(“dbd/gemtest1-MK.dbd”)</p>
<p>gemtest1_MK_registerRecordDeviceDriver(pdbbase)</p>
<p>…</p>
<p class="last">iocInit</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-118-01-ade-compatibility">
<h3>3.20.3 REQ-118-01 ADE Compatibility<a class="headerlink" href="#req-118-01-ade-compatibility" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><p class="first">cd ~/work//support/tcslib</p>
<p>* Clean to start from fresh</p>
<p>make distclean</p>
<p>1. Make sure the configuration is fine
(configure/RELEASE)</p>
<p>cd configure</p>
<p>cat RELEASE</p>
<p>Should report the following:</p>
<p>SLA
LIB=/gem_sw/prod/R3.14.12.4/support/slalib/1-9-5</p>
<p>AST
LIB=/gem_sw/prod/R3.14.12.4/support/astlib/1-6-2</p>
<p>GEMREC
=/gem_sw/prod/R3.14.12.4/support/geminiRec/4-0-3</p>
<p>…</p>
<p>EPICS_BASE=/gem_sw/epics/R3.14.12.4/base</p>
<p>…</p>
<ol class="arabic simple" start="2">
<li>Build tcslib</li>
</ol>
<p>cd ..</p>
<p class="last">make</p>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>The tcslib library shall be compatible with the
Application Development Environment (ADE ), and
build without errors or warnings.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-118-02-ade-available-for-linking">
<h3>3.20.4 REQ-118-02 ADE Available for Linking<a class="headerlink" href="#req-118-02-ade-available-for-linking" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head">&#160;</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><p class="first">1.Switch to an IOC directory</p>
<p>For example:</p>
<p>cd ~/work/ioc/sbf/</p>
<p>2. Check that the RELEASE loads all the
libraries (including tcslib). You’ll need to
specify the library versions if they are in
production.</p>
<p>cd configure</p>
<p>cat RELEASE</p>
<p>…</p>
<p>SLALIB=$(PRODSUP)/slalib/1-9-5</p>
<p>ASTLIB=$(PRODSUP)/astlib/1-6-2</p>
<p>GEMREC=$(PRODSUP)/geminiRec/4-0-3</p>
<p>TCSLIB=$(PRODSUP)/tcslib/1-0-1</p>
<p>…</p>
<p>3. Switch to the src directory and make sure the
library is included in the makefile</p>
<p>cd ../labvme3-sbf-iocApp/src</p>
<p>cat Makefile</p>
<p>…</p>
<p>labvme3-sbf-ioc_DBD += tcslib.dbd</p>
<p>…</p>
<ol class="arabic simple" start="4">
<li>Recompile</li>
</ol>
<p>cd ~/work/ioc/sbf</p>
<p>make distclean</p>
<p class="last">make</p>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>The tcslib library shall be available for
linking and testing with other CCB components.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="vmi5588-refelective-memory">
<h2>3.21 VMI5588 Refelective Memory<a class="headerlink" href="#vmi5588-refelective-memory" title="Permalink to this headline">¶</a></h2>
<div class="section" id="test-setup-and-prerequisites-17">
<span id="id401"></span><h3>3.21.1 Test Setup and Prerequisites<a class="headerlink" href="#test-setup-and-prerequisites-17" title="Permalink to this headline">¶</a></h3>
<p>Setup your test Vmi5588 with the proper jumper and switch settings to
define the base address and memory</p>
<p>/* default base addr, mem size, interrupt vector and level */</p>
<p>#define RM_VME_BASE 0xA00000 /* A24 Address space */</p>
<p>#define RM_VME_SIZE 0x040000 /* 256 Kbytes long */</p>
<p>#define RM_INT_VECTOR 0xb0 /* 4 vectors used, b0 to b3 */</p>
<p>#define RM_INT_LEVEL 6 /* interrupts are urgent */</p>
<ol class="arabic simple">
<li>DESCRIBE JUMPERS AND SWITCHES HERE</li>
<li>POINT OUT DIFFERENCES FOR DMA and NON-DMA BOARDS</li>
</ol>
</div>
<div class="section" id="epics-test-harness-17">
<span id="id402"></span><h3>3.21.2 EPICS Test Harness<a class="headerlink" href="#epics-test-harness-17" title="Permalink to this headline">¶</a></h3>
<p>The Vmi5588 driver is equipped with a set of epics records which can be
loaded during startup. The database can be viewed in
vmi5588App/Db/vmi5588Test.sch. Make sure your SYS_TDCT_PATHS is defined
like this,</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">[vmi5588App/Db]&gt;echo $SYS_TDCT_PATHS</p>
<p class="last">/gem_sw/epics/R3.14.12.4/exte
nsions/src/tdct/sym:/gem_sw/prod/R3.14.12.4/support/geminiRec/4-0/db</p>
</td>
</tr>
</tbody>
</table>
<p>and use the tdct like this:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>[vmi5588App/Db]&gt;tdct -cfg ./tdct.cfg -i vmi5588Test.sch</td>
</tr>
</tbody>
</table>
<p>The test harness records to verify are the reflective memory status
registers defined in the</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="28%" />
<col width="15%" />
<col width="21%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Description</th>
<th class="head">Signal</th>
<th class="head">SCAN</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>vmi5588:ring</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-odd"><td>vmi5588:txfifo</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-even"><td>vmi5588:input</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-odd"><td>vmi5588:pll</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-even"><td>vmi5588:int3</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-odd"><td>vmi5588:int2</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-even"><td>vmi5588:int1</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-odd"><td>vmi5588:sync</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-even"><td>vmi5588:crc</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
<tr class="row-odd"><td>vmi5588:rxfifo</td>
<td>&#160;</td>
<td>&#160;</td>
<td>1 second</td>
</tr>
</tbody>
</table>
<div class="section" id="add-the-vmi5588test-db">
<h4>3.21.2.1 Add the vmi5588Test.db<a class="headerlink" href="#add-the-vmi5588test-db" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li>If you need to, create a test ioc in the ADE environment, Eg.,</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>$gem-start-new-module.p￼￼y -i gemtest1/MK</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><dl class="first docutils">
<dt>The XYCOM module provides drivers and device support for both the 240</dt>
<dd>and 566. Edit your configure/RELEASE to include the XYCOM module
from either WORK or PROD:</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">…</p>
<p class="last">VMI5588=/gem_sw/work/R3.14.12.4/support/vmi5588</p>
</td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="3">
<li><dl class="first docutils">
<dt>Find your gemtest1-MKApp/Db/Makefile and edit your Makefile to</dt>
<dd>include the test harness as described in <a class="reference external" href="#epics-test-harness-10">3.2.1 EPICS Test
Harness</a>.</dd>
</dl>
</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>DB += vmi5588Test.db</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-the-vmi5588-dbd-file-and-library">
<h4>3.21.2.2 Add the Vmi5588 DBD file and library<a class="headerlink" href="#add-the-vmi5588-dbd-file-and-library" title="Permalink to this headline">¶</a></h4>
<p>Include the following dbd and libraries in your
gemtest1-MKApp/src/Makefile:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">gemtest1-MK_DBD += vmi5588.dbd</p>
<p>gemtest1-MK_DBD += pingpong.dbd</p>
<p>…</p>
<p>gemtest1-MK_LIBS += vmi5588</p>
<p class="last">gemtest1-MK_LIBS += pingpong</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tartup-script">
<h4>3.21.2.3 tartup Script<a class="headerlink" href="#tartup-script" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><ol class="first last arabic simple">
<li>The IOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will be running and will have initialized the</dt>
<dd>Xycom-566 driver as a result.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The driver configures all the boards’ internal registers during</dt>
<dd>the INIT process, and as a final step sets the front-Panel LED
from RED to GREEN upon successful initialization.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="build-and-install-8">
<span id="id403"></span><h4>3.21.2.4 Build and install<a class="headerlink" href="#build-and-install-8" title="Permalink to this headline">¶</a></h4>
<p>Build the test ioc:</p>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first">$ cd gemtest1-MK/hbf</p>
<p class="last">$ make distclean uninstall; make</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="req-119-01-initialize">
<h3>3.21.3 REQ-119-01 Initialize<a class="headerlink" href="#req-119-01-initialize" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Ensure that your IOC and CPU board are setup</dt>
<dd>as described in <a class="reference external" href="#cpu-board-setup">3.2 CPU Board
Setup</a>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>For this series of tests you will need either</dt>
<dd>two VME crates or 1 VME crate and 1 CEM.
Each physical system must be configured
with a Vmi5588.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Configure the board ID’s for the Vmi5588 to</dt>
<dd>be VME_0=0, VME_1=1, and CEM=1. In this
configuration you can test VME_0 as the
initiator and VME_1 or the CEM as the
receiver of the Ping Pong tests in below.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Connect the fiber appropriately between</dt>
<dd>systems.</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt>Boot <strong>both</strong> prepared systems and confirm</dt>
<dd>the startup scripts fully executes.</dd>
</dl>
</li>
</ol>
</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td><ol class="first last arabic simple">
<li>The IOC must show no errors on startup.</li>
<li><dl class="first docutils">
<dt>The EPICS iocInit() will be running and will</dt>
<dd>have initialized the Xycom-566 driver as a
result.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The driver configures all the boards’</dt>
<dd>internal registers during the INIT
process, and as a final step sets the
front-Panel LED from RED to GREEN upon
successful initialization.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-119-02-epics-report">
<h3>3.21.4 REQ-119-02 EPICS Report<a class="headerlink" href="#req-119-02-epics-report" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li><dl class="first docutils">
<dt><a href="#id404"><span class="problematic" id="id405">`</span></a>3.21.3 REQ-119-01</dt>
<dd>Initialize &lt;#req-119-01-initialize&gt;`__</dd>
</dl>
</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>After the board successfully initializes, run</dt>
<dd>the report for the Xycom 566.</dd>
</dl>
</li>
</ol>
<table border="1" class="last docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>10.1.2.171&gt; dbior drvVmi5588 2</td>
</tr>
</tbody>
</table>
</td>
</tr>
<tr class="row-even"><td>Success Criteria</td>
<td><ol class="first arabic simple">
<li><dl class="first docutils">
<dt>The console will report the full status of</dt>
<dd>the board.</dd>
</dl>
</li>
<li></li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>10.1.2.172&gt; dbior drvVmi5588 2
Driver: drvVmi5588
vmi5588: RM node 0x00, status 0x40, max 0
retries
pad1:0xff
BID:0x4b
IRS:0x40
pad2:0xff
NID:0x00
CSR:0x65
CMD:0xff01
pad3:0x0xdfa00008
interrupt control registers at 0xdfa00020
vector registers at 0xdfa00030
test address = 0xdfa00040
pad6 address = 0xdfa00044
page flags at 0xdfa00100
pad7 address = 0xdfa002fe
pad8 address = 0xdfa00300
mem starts at 0xdfa00400
Receiver: Input signal good, PLL Locked,
Recent Sync loss
Jumpers: Fast mode, Transfer Error
Interrupt Enabled
Status: Fibre ring Intact, Fail LED Off
FIFOs: Transmitter Empty, Receiver &lt;50%
Full
Int’s: (irs=0x40)
Int 00: Not in use, Level 0 disabled,
vector 0xb0 (icr=0x00); routine = 0x0
Int 01: Not in use, Level 0 disabled,
vector 0xb1 (icr=0x00); routine = 0x0
Int 02: Not in use, Level 6 enabled, Auto
clear, vector 0xb2 (icr=0x1e); routine =
0x0
Int 03: Not in use, Level 0 disabled,
vector 0xb3 (icr=0x00); routine = 0x0</td>
</tr>
</tbody>
</table>
<ol class="last arabic simple" start="3">
<li><dl class="first docutils">
<dt>The interrupt “Int 02” is enabled and</dt>
<dd>icr=0x1e on this IOC. This can be manually
set by running the command “prep (2)”. Run
that command and check the report again.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Ensure both physical systems are setup,</dt>
<dd>initialized and show a successful report.</dd>
</dl>
</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-119-03-binary-input-device-support-1">
<span id="id406"></span><h3>3.21.5 REQ-119-03 Binary Input Device Support<a class="headerlink" href="#req-119-03-binary-input-device-support-1" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Prerequisites</th>
<th class="head"><ol class="first last arabic simple">
<li>Run the Vmi5588</li>
</ol>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Procedure</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>Success Criteria</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="req-119-04-reflected-memory-status-1">
<span id="id407"></span><h3>3.21.6 REQ-119-04 Reflected Memory Status<a class="headerlink" href="#req-119-04-reflected-memory-status-1" title="Permalink to this headline">¶</a></h3>
<p>Procedure
Success Criteria
================</p>
</div>
<div class="section" id="req-119-05-vme-node-to-pci-msdos-node-data-integrity-1">
<span id="id408"></span><h3>3.21.7 REQ-119-05 VME Node to PCI (MSDOS) Node Data Integrity<a class="headerlink" href="#req-119-05-vme-node-to-pci-msdos-node-data-integrity-1" title="Permalink to this headline">¶</a></h3>
<p>Procedure
Success Criteria
================</p>
</div>
<div class="section" id="req-119-06-vme-node-to-vme-node-data-integrity-1">
<span id="id409"></span><h3>3.21.8 REQ-119-06 VME Node to VME Node Data Integrity<a class="headerlink" href="#req-119-06-vme-node-to-vme-node-data-integrity-1" title="Permalink to this headline">¶</a></h3>
<p>Procedure
Success Criteria
================</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../code/code-index.html" class="btn btn-neutral float-right" title="Code Tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../HelloWorld.html" class="btn btn-neutral float-left" title="Hello, world." accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Gemini Controls

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>